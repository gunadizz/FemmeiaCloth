<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Survey Berhadiah - Femmeia Cloth - Batch 1</title>
  <meta name="description" content="Isi survey dan dapatkan hadiah!">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-card: rgba(255, 255, 255, 0.05);
      --bg-card-hover: rgba(255, 255, 255, 0.08);
      --border: rgba(255, 255, 255, 0.1);
      --border-focus: rgba(255, 255, 255, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent: #ec4899;
      --accent-secondary: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --glass-bg: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Background Effects */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1rem;
      position: relative;
    }

    /* Auth Header */
    .auth-header {
      position: fixed;
      top: 0;
      right: 0;
      padding: 1rem 2rem;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 2rem;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .logout-btn {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--error);
      padding: 0.5rem 1rem;
      border-radius: 1.5rem;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 3rem;
      margin-top: 2rem;
    }

    .header h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .header .subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
      margin-bottom: 2rem;
    }

    /* Login Gate */
    .login-gate {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      text-align: center;
    }

    .login-gate h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .login-gate p {
      color: var(--text-secondary);
      margin-bottom: 2rem;
      max-width: 500px;
      line-height: 1.6;
    }

    .login-gate-btn {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Quicksand', sans-serif;
      font-size: 1rem;
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);
    }

    .login-gate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(236, 72, 153, 0.4);
    }

    /* Bento Grid Layout */
    .bento-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .bento-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      padding: 2rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .bento-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-focus), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .bento-card:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-focus);
      transform: translateY(-2px);
    }

    .bento-card:hover::before {
      opacity: 1;
    }

    /* Alert Cards */
    .alert-card {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .alert-card .icon {
      display: inline-block;
      margin-right: 0.5rem;
      font-size: 1.2rem;
    }

    /* Progress Card */
    .progress-card {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, var(--glass-bg), rgba(16, 185, 129, 0.05));
    }

    .progress-bar-container {
      background: rgba(255, 255, 255, 0.1);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
      border-radius: 4px;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .step-indicator {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .step-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .step-dot.active {
      background: var(--accent);
      transform: scale(1.2);
    }

    .step-dot.completed {
      background: var(--success);
    }

    /* Form Styles */
    .form-step {
      display: none;
      grid-column: 1 / -1;
      min-height: 400px;
    }

    .form-step.active {
      display: block;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.9rem;
    }

    .required {
      color: var(--accent);
    }

    input, select, textarea {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      padding: 0.875rem 1rem;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }

    input::placeholder, textarea::placeholder {
      color: var(--text-muted);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Checkbox Styles */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .checkbox-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: var(--border-focus);
    }

    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      accent-color: var(--accent);
    }

    .checkbox-item label {
      margin: 0;
      cursor: pointer;
      line-height: 1.5;
    }

    /* Button Styles */
    .button-group {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 2rem;
    }

    button {
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      font-family: "Quicksand";
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.15);
      border-color: var(--border-focus);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);
      border: 1px solid transparent;
      font-family: "Quicksand";
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 40px rgba(236, 72, 153, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /* Error Styles */
    .error {
      color: var(--error);
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }

    .error-border {
      border-color: var(--error) !important;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-focus);
      border-radius: 1.5rem;
      padding: 2rem;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
      opacity: 1;
    }

    .modal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
    }

    /* Auth Modal Specific Styles */
    .auth-modal {
      max-width: 450px;
      text-align: left;
    }

    .auth-modal h3 {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .auth-form input {
      padding: 0.875rem 1rem;
      border-radius: 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      color: var(--text-primary);
      font-family: inherit;
    }

    .auth-form input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }

    .auth-form button {
      padding: 0.875rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      border-radius: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 0.5rem;
    }

    .auth-form button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);
    }

    .auth-form button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .auth-switch {
      text-align: center;
      margin-top: 1.5rem;
      color: var(--text-secondary);
    }

    .auth-switch button {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      text-decoration: underline;
      font-family: inherit;
      padding: 0;
      margin: 0;
    }

    .modal-spinner {
      margin: 0 auto 1.5rem;
      width: 60px;
      height: 60px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: modal-spin 1s ease-in-out infinite;
    }

    @keyframes modal-spin {
      to { transform: rotate(360deg); }
    }

    .modal-content {
      margin-bottom: 1rem;
    }

    .modal h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .modal-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      margin-bottom: 1rem;
    }

    .modal-status.success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .modal-status.error {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error);
    }

    .modal-btn {
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Quota Info */
    .quota-info {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--success);
      padding: 1rem;
      border-radius: 0.75rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .quota-info.empty {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
      border-color: rgba(239, 68, 68, 0.2);
      color: var(--error);
    }

    /* Hide form when quota is empty */
    .form-hidden {
      display: none !important;
    }

    /* Pulse animation for loading text */
    .pulse {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    /* Auto-save indicator */
    .auto-save-indicator {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 2rem;
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 50;
    }

    .auto-save-indicator.show {
      opacity: 1;
    }

    .auto-save-indicator.success {
      color: var(--success);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .auth-header {
        position: relative;
        padding: 1rem 0;
        justify-content: center;
      }

      .bento-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .bento-card {
        padding: 1.5rem;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }

      .auto-save-indicator {
        bottom: 1rem;
        right: 1rem;
      }
    }

    @media (max-width: 480px) {
      .bento-card {
        padding: 1rem;
      }

      .header h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- Auto-save indicator -->
  <div class="auto-save-indicator" id="autoSaveIndicator">
    💾 Data tersimpan otomatis
  </div>

  <!-- Auth Header -->
  <div class="auth-header" id="authHeader" style="display: none;">
    <div class="user-info" id="userInfo"></div>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </div>

  <div class="container">
    <div class="header">
      <h1>Survey Berhadiah</h1>
      <p class="subtitle">Femmeia Cloth - Batch 1</p>
    </div>

    <!-- Login Gate -->
    <div class="login-gate" id="loginGate">
      <h2>Selamat Datang!</h2>
      <p>Untuk mengikuti survey berhadiah ini, Anda perlu login terlebih dahulu. Hal ini untuk memastikan setiap orang hanya dapat mengisi survey satu kali dan menerima hadiah yang sesuai.</p>
      <button class="login-gate-btn" id="showAuthModal">Login / Daftar</button>
    </div>

    <!-- Survey Content -->
    <div class="survey-content" id="surveyContent" style="display: none;">
      <div class="bento-grid">
        <!-- Alert Card -->
        <div class="bento-card alert-card">
          <span class="icon">🎁</span>
          <strong>Hadiah Rp1.000 – Rp5.000</strong> berdasarkan kualitas jawaban Anda.<br>
          Hadiah hanya dapat dikirim melalui <strong>e-wallet (OVO, DANA, GoPay, dll)</strong>.<br>
          <span class="icon">🧾</span> <strong>Syarat:</strong> Wajib follow Instagram 
          <a href="https://instagram.com/femmeia.cloth" target="_blank" style="color: var(--accent);">@femmeia.cloth</a> 
          dan isi username IG Anda.
        </div>

        <!-- Privacy Notice -->
        <div class="bento-card alert-card">
          <strong>Perhatian:</strong><br>
          Data yang Anda berikan akan digunakan untuk pengembangan produk dan layanan FemmeiaCloth. 
          Kami menjamin kerahasiaan data Anda dan tidak akan disebarkan kepada pihak ketiga.<br><br>
          Mohon lengkapi data dengan jujur untuk mendapatkan hadiah menarik. 
          Kami akan merespon dalam 1x24 jam.
        </div>

        <!-- Quota Info -->
        <div id="quotaInfo" class="quota-info" style="display: none;"></div>

        <!-- Already Submitted Notice -->
        <div id="alreadySubmittedInfo" class="quota-info empty" style="display: none;">
          ✅ Anda sudah pernah mengisi survey ini. Terima kasih atas partisipasi Anda!
        </div>

        <!-- Progress Card -->
        <div class="bento-card progress-card" id="progressCard">
          <div class="progress-info">
            <span id="stepTitle">Data Diri</span>
            <span id="progressText">1 / 8</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 12.5%"></div>
          </div>
          <div class="step-indicator" id="stepIndicator">
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
          </div>
        </div>

        <!-- Form Steps -->
        <form id="surveyForm" novalidate>
          <!-- Step 1: Informasi Pribadi -->
          <div class="form-step active bento-card">
            <div class="form-grid">
              <div class="form-group">
                <label for="name">Nama lengkap <span class="required">*</span></label>
                <input type="text" id="name" name="name" required />
                <div class="error" id="nameError"></div>
              </div>
              <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" name="email" required />
                <div class="error" id="emailError"></div>
              </div>
              <div class="form-group">
                <label for="gender">Jenis kelamin <span class="required">*</span></label>
                <select id="gender" name="gender" required>
                  <option value="">-- Pilih --</option>
                  <option value="Pria">Pria</option>
                  <option value="Wanita">Wanita</option>
                </select>
                <div class="error" id="genderError"></div>
              </div>
              <div class="form-group">
                <label for="age">Usia <span class="required">*</span></label>
                <input type="number" id="age" name="age" min="1" required />
                <div class="error" id="ageError"></div>
              </div>
              <div class="form-group">
                <label for="city">Kota domisili <span class="required">*</span></label>
                <input type="text" id="city" name="city" required />
                <div class="error" id="cityError"></div>
              </div>
              <div class="form-group">
                <label for="job">Status pekerjaan <span class="required">*</span></label>
                <select id="job" name="job" required>
                  <option value="">-- Pilih --</option>
                  <option value="Pelajar">Pelajar</option>
                  <option value="Mahasiswa">Mahasiswa</option>
                  <option value="Bekerja">Bekerja</option>
                  <option value="Tidak bekerja">Tidak bekerja</option>
                </select>
                <div class="error" id="jobError"></div>
              </div>
              <div class="form-group">
                <label for="income">Penghasilan bulanan <span class="required">*</span></label>
                <select id="income" name="income" required>
                  <option value="">-- Pilih --</option>
                  <option value="<1jt">&lt; 1jt</option>
                  <option value="1-3jt">1-3jt</option>
                  <option value=">3jt">&gt; 3jt</option>
                  <option value="(Memilih Untuk Tidak Menjawab)">Memilih Untuk Tidak Menjawab</option>
                </select>
                <div class="error" id="incomeError"></div>
              </div>
              <div class="form-group">
                <label for="marital">Status pernikahan <span class="required">*</span></label>
                <select id="marital" name="marital" required>
                  <option value="">-- Pilih --</option>
                  <option value="Belum menikah">Belum menikah</option>
                  <option value="Menikah">Menikah</option>
                  <option value="(Memilih Untuk Tidak Menjawab)">Memilih Untuk Tidak Menjawab</option>
                </select>
                <div class="error" id="maritalError"></div>
              </div>
              <div class="form-group">
                <label for="whatsapp">Nomor WhatsApp <span class="required">*</span></label>
                <input type="tel" id="whatsapp" name="whatsapp" placeholder="Contoh: 08123456789" required />
                <div class="error" id="whatsappError"></div>
              </div>
              <div class="form-group">
                <label for="ewallet">Nomor E-Wallet <span class="required">*</span></label>
                <input type="tel" id="ewallet" name="ewallet" placeholder="Contoh: 08123456789" required />
                <div class="error" id="ewalletError"></div>
              </div>
              <div class="form-group">
                <label for="jenisewallet">Jenis E-Wallet <span class="required">*</span></label>
                <select id="jenisewallet" name="jenisewallet" required>
                  <option value="">-- Pilih --</option>
                  <option value="Dana">Dana</option>
                  <option value="OVO">OVO</option>
                  <option value="Gopay">Gopay</option>
                  <option value="Shopeepay">ShopeePay</option>
                </select>
                <div class="error" id="jenisewalletError"></div>
              </div>
              <div class="form-group full-width">
                <label for="instagram">Username Instagram <span class="required">*</span></label>
                <input type="text" id="instagram" name="instagram" placeholder="@username" required />
                <div class="error" id="instagramError"></div>
              </div>
            </div>
          </div>

          <!-- Step 2: Preferensi Produk Hijab -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group">
                <label for="productType">Jenis hijab favorit <span class="required">*</span></label>
                <select id="productType" name="productType" required>
                  <option value="">-- Pilih --</option>
                  <option value="Paris">Paris</option>
                  <option value="Pashmina">Pashmina</option>
                  <option value="Inner">Inner</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
                <div class="error" id="productTypeError"></div>
              </div>
              <div class="form-group">
                <label for="favoriteColor">Warna favorit hijab <span class="required">*</span></label>
                <input type="text" id="favoriteColor" name="favoriteColor" required />
                <div class="error" id="favoriteColorError"></div>
              </div>
              <div class="form-group">
                <label for="size">Ukuran hijab biasa dipakai <span class="required">*</span></label>
                <select id="size" name="size" required>
                  <option value="">-- Pilih --</option>
                  <option value="110x110">110x110</option>
                  <option value="115x115">115x115</option>
                  <option value="165x55">165x55</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
                <div class="error" id="sizeError"></div>
              </div>
              <div class="form-group full-width">
                <label for="priceRange">Kisaran harga nyaman <span class="required">*</span></label>
                <select id="priceRange" name="priceRange" required>
                  <option value="">-- Pilih --</option>
                  <option value="30rb-50rb">30rb-50rb</option>
                  <option value="50rb-100rb">50rb-100rb</option>
                  <option value=">100rb">&gt; 100rb</option>
                </select>
                <div class="error" id="priceRangeError"></div>
              </div>
            </div>
          </div>

          <!-- Step 3: Perilaku Belanja Hijab -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group">
                <label for="shoppingPlace">Sering beli hijab di <span class="required">*</span></label>
                <select id="shoppingPlace" name="shoppingPlace" required>
                  <option value="">-- Pilih --</option>
                  <option value="Online">Online (Misal. Tokopedia, Shopee, Tiktok, dan lainnya)</option>
                  <option value="Offline">Offline</option>
                  <option value="Keduanya">Keduanya</option>
                </select>
                <div class="error" id="shoppingPlaceError"></div>
              </div>
              <div class="form-group">
                <label for="favoriteBrand">Brand hijab favorit <span class="required">*</span></label>
                <input type="text" id="favoriteBrand" name="favoriteBrand" required />
                <div class="error" id="favoriteBrandError"></div>
              </div>
              <div class="form-group">
                <label for="shopFrequency">Frekuensi beli hijab per tahun <span class="required">*</span></label>
                <select id="shopFrequency" name="shopFrequency" required>
                  <option value="">-- Pilih --</option>
                  <option value="1-2x">1-2x</option>
                  <option value="3-5x">3-5x</option>
                  <option value=">6x">&gt; 6x</option>
                  <option value="jarang">jarang</option>
                </select>
                <div class="error" id="shopFrequencyError"></div>
              </div>
              <div class="form-group">
                <label for="reasonBuy">Alasan utama membeli hijab <span class="required">*</span></label>
                <select id="reasonBuy" name="reasonBuy" required>
                  <option value="">-- Pilih --</option>
                  <option value="Fashion">Fashion</option>
                  <option value="Fungsional">Fungsional</option>
                  <option value="Agama">Agama</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
                <div class="error" id="reasonBuyError"></div>
              </div>
              <div class="form-group full-width">
                <label for="buyMoment">Momen biasa membeli hijab</label>
                <div class="checkbox-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="moment1" value="Ramadan" class="buyMoment" />
                    <label for="moment1">Ramadan</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="moment2" value="Lebaran" class="buyMoment" />
                    <label for="moment2">Lebaran</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="moment3" value="Harian" class="buyMoment" />
                    <label for="moment3">Harian</label>
                  </div>
                </div>
              </div>
              <div class="form-group full-width">
                <label for="infoSource">Sumber info produk hijab</label>
                <div class="checkbox-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="source1" value="Instagram" class="infoSource" />
                    <label for="source1">Instagram</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="source2" value="TikTok" class="infoSource" />
                    <label for="source2">TikTok</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="source3" value="Teman" class="infoSource" />
                    <label for="source3">Teman</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="limitedEdition">Tertarik produk limited edition? <span class="required">*</span></label>
                <div style="margin-top: 0.5rem;">
                  <label style="display: inline-flex; align-items: center; margin-right: 1rem;">
                    <input type="radio" id="limitedYes" name="limitedEdition" value="Ya" style="margin-right: 0.5rem;" required />
                    Ya
                  </label>
                  <label style="display: inline-flex; align-items: center;">
                    <input type="radio" id="limitedNo" name="limitedEdition" value="Tidak" style="margin-right: 0.5rem;" required />
                    Tidak
                  </label>
                </div>
                <div class="error" id="limitedEditionError"></div>
              </div>
              <div class="form-group">
                <label for="favPayment">Metode pembayaran favorit <span class="required">*</span></label>
                <select id="favPayment" name="favPayment" required>
                  <option value="">-- Pilih --</option>
                  <option value="Transfer Bank">Transfer Bank</option>
                  <option value="E-Wallet">E-Wallet</option>
                  <option value="COD">COD</option>
                  <option value="Ambil Langsung/Diantarkan Langsung">Ambil Langsung/Diantarkan Langsung</option>
                  <option value="Qris">Qris</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
                <div class="error" id="favPaymentError"></div>
              </div>
            </div>
          </div>

          <!-- Step 4: Kepuasan Pelanggan -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="hasPurchased">Pernah beli di Femmeia? <span class="required">*</span></label>
                <div style="margin-top: 0.5rem;">
                  <label style="display: inline-flex; align-items: center; margin-right: 1rem;">
                    <input type="radio" id="purchasedYes" name="hasPurchased" value="Ya" style="margin-right: 0.5rem;" />
                    Ya
                  </label>
                  <label style="display: inline-flex; align-items: center;">
                    <input type="radio" id="purchasedNo" name="hasPurchased" value="Tidak" style="margin-right: 0.5rem;" />
                    Tidak
                  </label>
                </div>
                <div class="error" id="hasPurchasedError"></div>
              </div>
              <div class="form-group" id="ratingGroup" style="display: none;">
                <label for="rating">Rating pengalaman belanja (1–5)</label>
                <select id="rating" name="rating">
                  <option value="">-- Pilih Rating --</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                </select>
              </div>
              <div class="form-group" id="qualityGroup" style="display: none;">
                <label for="quality">Kualitas hijab Femmeia</label>
                <select id="quality" name="quality">
                  <option value="">-- Pilih --</option>
                  <option value="Sangat menarik">Sangat menarik</option>
                  <option value="Menarik">Menarik</option>
                  <option value="Biasa saja">Biasa saja</option>
                  <option value="Kurang menarik">Kurang menarik</option>
                </select>
              </div>
              <div class="form-group" id="materialQualityGroup" style="display: none;">
                <label for="materialQuality">Kualitas bahan</label>
                <select id="materialQuality" name="materialQuality">
                  <option value="">-- Pilih --</option>
                  <option value="Sangat menarik">Sangat menarik</option>
                  <option value="Menarik">Menarik</option>
                  <option value="Biasa saja">Biasa saja</option>
                  <option value="Kurang menarik">Kurang menarik</option>
                </select>
              </div>
              <div class="form-group" id="serviceQualityGroup" style="display: none;">
                <label for="serviceQuality">Kualitas pelayanan</label>
                <select id="serviceQuality" name="serviceQuality">
                  <option value="">-- Pilih --</option>
                  <option value="Sangat menarik">Sangat menarik</option>
                  <option value="Menarik">Menarik</option>
                  <option value="Biasa saja">Biasa saja</option>
                  <option value="Kurang menarik">Kurang menarik</option>
                </select>
              </div>
              <div class="form-group full-width">
                <label for="shopExp">Pengalaman belanja online umum <span class="required">*</span></label>
                <textarea id="shopExp" name="shopExp" placeholder="Ceritakan pengalaman belanja online Anda secara umum..." required></textarea>
                <div class="error" id="shopExpError"></div>
              </div>
              <div class="form-group full-width" id="feedbackGroup" style="display: none;">
                <label for="feedback">Komentar tentang layanan kami</label>
                <textarea id="feedback" name="feedback" placeholder="Berikan komentar tentang layanan Femmeia..."></textarea>
              </div>
            </div>
          </div>

          <!-- Step 5: Branding & Visual -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group">
                <label for="logoImpression">Penilaian terhadap logo <span class="required">*</span></label>
                <select id="logoImpression" name="logoImpression" required>
                  <option value="">-- Pilih --</option>
                  <option value="Sangat menarik">Sangat menarik</option>
                  <option value="Menarik">Menarik</option>
                  <option value="Biasa saja">Biasa saja</option>
                  <option value="Kurang menarik">Kurang menarik</option>
                </select>
                <div class="error" id="logoImpressionError"></div>
              </div>
              <div class="form-group">
                <label for="designAesthetic">Kesan desain produk & identitas visual <span class="required">*</span></label>
                <select id="designAesthetic" name="designAesthetic" required>
                  <option value="">-- Pilih --</option>
                  <option value="Sangat menarik">Sangat menarik</option>
                  <option value="Menarik">Menarik</option>
                  <option value="Biasa saja">Biasa saja</option>
                  <option value="Kurang menarik">Kurang menarik</option>
                </select>
                <div class="error" id="designAestheticError"></div>
              </div>
              <div class="form-group">
                <label for="instagramQuality">Kualitas feed Instagram <span class="required">*</span></label>
                <select id="instagramQuality" name="instagramQuality" required>
                  <option value="">-- Pilih --</option>
                  <option value="Sangat baik">Sangat baik</option>
                  <option value="Baik">Baik</option>
                  <option value="Biasa saja">Biasa saja</option>
                  <option value="Kurang baik">Kurang baik</option>
                </select>
                <div class="error" id="instagramQualityError"></div>
              </div>
              <div class="form-group full-width">
                <label for="brandingSuggestion">Saran terkait logo/sosmed <span class="required">*</span></label>
                <textarea id="brandingSuggestion" name="brandingSuggestion" placeholder="Berikan saran untuk perbaikan logo atau media sosial..." required></textarea>
                <div class="error" id="brandingSuggestionError"></div>
              </div>
            </div>
          </div>

          <!-- Step 6: Ide Produk & Layanan -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group full-width">
                <label>Ide produk baru yang diminati</label>
                <div class="checkbox-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="idea1" value="Hijab Motif" class="productIdeas" />
                    <label for="idea1">Hijab Motif</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="idea2" value="Inner Instan" class="productIdeas" />
                    <label for="idea2">Inner Instan</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="idea3" value="Aksesoris Hijab" class="productIdeas" />
                    <label for="idea3">Aksesoris Hijab</label>
                  </div>
                </div>
              </div>
              <div class="form-group full-width">
                <label for="otherIdea">Ide lainnya (jika ada) <span class="required">*</span></label>
                <textarea id="otherIdea" name="otherIdea" placeholder="Tuliskan ide produk lainnya..." required></textarea>
                <div class="error" id="otherIdeaError"></div>
              </div>
              <div class="form-group full-width">
                <label for="serviceIdea">Saran layanan selain produk <span class="required">*</span></label>
                <textarea id="serviceIdea" name="serviceIdea" placeholder="Berikan saran layanan yang diinginkan selain produk hijab..." required></textarea>
                <div class="error" id="serviceIdeaError"></div>
              </div>
            </div>
          </div>

          <!-- Step 7: Masukan Umum & Testimoni -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="suggestion">Testimoni atau saran umum <span class="required">*</span></label>
                <textarea id="suggestion" name="suggestion" placeholder="Bagikan testimoni, saran, atau masukan Anda untuk Femmeia Cloth..." required></textarea>
                <div class="error" id="suggestionError"></div>
              </div>
              <div class="form-group full-width">
                <label for="mainProblem">Masalah utama saat beli hijab online <span class="required">*</span></label>
                <textarea id="mainProblem" name="mainProblem" placeholder="Ceritakan masalah yang sering Anda hadapi saat berbelanja hijab online..." required></textarea>
                <div class="error" id="mainProblemError"></div>
              </div>
            </div>
          </div>

          <!-- Step 8: Persetujuan -->
          <div class="form-step bento-card">
            <div class="form-grid">
              <div class="form-group full-width">
                <div class="checkbox-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="agreeFollow" required />
                    <label for="agreeFollow">Follow Instagram Femmeia <span class="required">*</span><br>
                      <small>Saya sudah follow Instagram 
                      <a href="https://instagram.com/femmeia.cloth" target="_blank" style="color: var(--accent);">@femmeia.cloth</a></small>
                    </label>
                  </div>
                  <div class="error" id="agreeFollowError"></div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="agree1" required />
                    <label for="agree1">Bersedia datanya digunakan <span class="required">*</span><br>
                      <small>Saya bersedia data yang saya berikan digunakan untuk pengembangan Femmeia Cloth</small>
                    </label>
                  </div>
                  <div class="error" id="agree1Error"></div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="agree2" required />
                    <label for="agree2">Setuju ikut undian reward <span class="required">*</span><br>
                      <small>Saya setuju mengikuti undian berhadiah dari Femmeia Cloth</small>
                    </label>
                  </div>
                  <div class="error" id="agree2Error"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="button-group">
            <button type="button" id="prevBtn" class="btn-secondary" disabled>
              ← Sebelumnya
            </button>
            <button type="button" id="nextBtn" class="btn-primary">
              Selanjutnya →
            </button>
            <button type="submit" id="submitBtn" class="btn-primary" style="display: none;">
              <span id="submitText">Kirim Survey</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
      <div id="modalContent">
        <!-- Content will be dynamically inserted here -->
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal-overlay" id="authModalOverlay">
    <div class="modal auth-modal" id="authModal">
      <h3 id="authTitle">Login</h3>
      <form class="auth-form" id="authForm">
        <input type="email" id="authEmail" placeholder="Email" required />
        <div class="error" id="authEmailError"></div>
        <input type="password" id="authPassword" placeholder="Password" required />
        <div class="error" id="authPasswordError"></div>
        <input type="password" id="authConfirmPassword" placeholder="Konfirmasi Password" style="display: none;" />
        <div class="error" id="authConfirmPasswordError"></div>
        <button type="submit" id="authSubmitBtn">
          <span id="authSubmitText">Login</span>
        </button>
      </form>
      <div class="auth-switch">
        <span id="authSwitchText">Belum punya akun?</span>
        <button type="button" id="authSwitchBtn">Daftar</button>
      </div>
    </div>
  </div>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getFirestore, doc, getDoc, runTransaction, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    
    // EmailJS
    emailjs.init('EgQN926d2p5Tl7keS');

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAxMT-bM6FEPrD-o3I2G-VHdZP7hxhj0uo",
      authDomain: "femmeiacloth-finance.firebaseapp.com",
      projectId: "femmeiacloth-finance",
      storageBucket: "femmeiacloth-finance.appspot.com",
      messagingSenderId: "517478386163",
      appId: "1:517478386163:web:51028f5841baa311126a86",
      measurementId: "G-K4L516Q54R"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Survey Manager Class
    class SurveyManager {
      constructor() {
        this.currentStep = 0;
        this.totalSteps = 8;
        this.currentUser = null;
        this.hasSubmitted = false;
        this.quotaCount = null;
        this.isLoginMode = true;
        this.autoSaveTimeout = null;
        
        this.stepTitles = [
          'Informasi Pribadi',
          'Preferensi Produk Hijab',
          'Perilaku Belanja Hijab', 
          'Kepuasan Pelanggan',
          'Branding & Visual',
          'Ide Produk & Layanan',
          'Masukan Umum & Testimoni',
          'Persetujuan'
        ];

        this.initializeElements();
        this.bindEvents();
        this.initializeAuth();
      }

      initializeElements() {
        // DOM Elements
        this.elements = {
          loginGate: document.getElementById('loginGate'),
          surveyContent: document.getElementById('surveyContent'),
          authHeader: document.getElementById('authHeader'),
          userInfo: document.getElementById('userInfo'),
          logoutBtn: document.getElementById('logoutBtn'),
          showAuthModalBtn: document.getElementById('showAuthModal'),
          authModalOverlay: document.getElementById('authModalOverlay'),
          authModal: document.getElementById('authModal'),
          authForm: document.getElementById('authForm'),
          authTitle: document.getElementById('authTitle'),
          authEmail: document.getElementById('authEmail'),
          authPassword: document.getElementById('authPassword'),
          authConfirmPassword: document.getElementById('authConfirmPassword'),
          authSubmitBtn: document.getElementById('authSubmitBtn'),
          authSubmitText: document.getElementById('authSubmitText'),
          authSwitchText: document.getElementById('authSwitchText'),
          authSwitchBtn: document.getElementById('authSwitchBtn'),
          alreadySubmittedInfo: document.getElementById('alreadySubmittedInfo'),
          progressCard: document.getElementById('progressCard'),
          steps: document.querySelectorAll('.form-step'),
          nextBtn: document.getElementById('nextBtn'),
          prevBtn: document.getElementById('prevBtn'),
          submitBtn: document.getElementById('submitBtn'),
          progressBar: document.getElementById('progressBar'),
          stepIndicator: document.getElementById('stepIndicator'),
          stepTitle: document.getElementById('stepTitle'),
          progressText: document.getElementById('progressText'),
          quotaInfo: document.getElementById('quotaInfo'),
          surveyForm: document.getElementById('surveyForm'),
          modalOverlay: document.getElementById('modalOverlay'),
          modalContent: document.getElementById('modalContent'),
          autoSaveIndicator: document.getElementById('autoSaveIndicator')
        };
      }

      bindEvents() {
        // Auth events
        this.elements.showAuthModalBtn.addEventListener('click', () => this.show
        // Auth events
        this.elements.showAuthModalBtn.addEventListener('click', () => this.showAuthModal());
        this.elements.authSwitchBtn.addEventListener('click', () => this.toggleAuthMode());
        this.elements.logoutBtn.addEventListener('click', () => signOut(auth));

        // Modal events
        this.elements.authModalOverlay.addEventListener('click', (e) => {
          if (e.target === this.elements.authModalOverlay) {
            this.hideAuthModal();
          }
        });

        this.elements.modalOverlay.addEventListener('click', (e) => {
          if (e.target === this.elements.modalOverlay) {
            if (!this.elements.modalContent.querySelector('.modal-spinner')) {
              this.hideModal();
            }
          }
        });

        // Form events
        this.elements.authForm.addEventListener('submit', (e) => this.handleAuthSubmit(e));
        this.elements.surveyForm.addEventListener('submit', (e) => this.handleSurveySubmit(e));
        
        // Navigation events
        this.elements.nextBtn.addEventListener('click', () => this.nextStep());
        this.elements.prevBtn.addEventListener('click', () => this.prevStep());

        // Auto-save events
        this.elements.surveyForm.addEventListener('input', () => this.scheduleAutoSave());
        this.elements.surveyForm.addEventListener('change', () => this.scheduleAutoSave());

        // Prevent Enter key submission except in textareas
        this.elements.surveyForm.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
            e.preventDefault();
          }
        });

        // Show/hide customer satisfaction fields
        document.addEventListener('change', (e) => {
          if (e.target.name === 'hasPurchased') {
            this.toggleCustomerSatisfactionFields(e.target.value);
          }
        });
      }

      initializeAuth() {
        onAuthStateChanged(auth, async (user) => {
          if (user) {
            this.currentUser = user;
            await this.checkUserSubmissionStatus();
            this.showSurveyContent();
            this.updateUserInfo();
          } else {
            this.currentUser = null;
            this.hasSubmitted = false;
            this.showLoginGate();
          }
        });
      }

      showLoginGate() {
        this.elements.loginGate.style.display = 'flex';
        this.elements.surveyContent.style.display = 'none';
        this.elements.authHeader.style.display = 'none';
      }

      showSurveyContent() {
        this.elements.loginGate.style.display = 'none';
        this.elements.surveyContent.style.display = 'block';
        this.elements.authHeader.style.display = 'flex';
      }

      updateUserInfo() {
        if (this.currentUser) {
          this.elements.userInfo.innerHTML = `
            <span>👤</span>
            <span>${this.currentUser.email}</span>
          `;
        }
      }

      async checkUserSubmissionStatus() {
        if (!this.currentUser) return;
        
        try {
          const surveysRef = collection(db, "surveys");
          const q = query(surveysRef, where("userId", "==", this.currentUser.uid));
          const querySnapshot = await getDocs(q);
          
          this.hasSubmitted = !querySnapshot.empty;
          
          if (this.hasSubmitted) {
            this.elements.alreadySubmittedInfo.style.display = 'block';
            this.elements.progressCard.style.display = 'none';
            this.elements.surveyForm.style.display = 'none';
          } else {
            this.elements.alreadySubmittedInfo.style.display = 'none';
            this.elements.progressCard.style.display = 'block';
            this.elements.surveyForm.style.display = 'block';
            this.checkQuotaAndToggleForm();
            this.loadAutoSavedData();
          }
        } catch (error) {
          console.error("Error checking submission status:", error);
        }
      }

      // Auth Modal Methods
      showAuthModal() {
        this.elements.authModalOverlay.classList.add('active');
        this.clearAuthErrors();
      }

      hideAuthModal() {
        this.elements.authModalOverlay.classList.remove('active');
        this.elements.authForm.reset();
        this.clearAuthErrors();
      }

      toggleAuthMode() {
        this.isLoginMode = !this.isLoginMode;
        
        if (this.isLoginMode) {
          this.elements.authTitle.textContent = 'Login';
          this.elements.authSubmitText.textContent = 'Login';
          this.elements.authSwitchText.textContent = 'Belum punya akun?';
          this.elements.authSwitchBtn.textContent = 'Daftar';
          this.elements.authConfirmPassword.style.display = 'none';
          this.elements.authConfirmPassword.required = false;
        } else {
          this.elements.authTitle.textContent = 'Daftar';
          this.elements.authSubmitText.textContent = 'Daftar';
          this.elements.authSwitchText.textContent = 'Sudah punya akun?';
          this.elements.authSwitchBtn.textContent = 'Login';
          this.elements.authConfirmPassword.style.display = 'block';
          this.elements.authConfirmPassword.required = true;
        }
        
        this.clearAuthErrors();
      }

      clearAuthErrors() {
        document.querySelectorAll('#authModal .error').forEach(error => error.textContent = '');
        document.querySelectorAll('#authModal input').forEach(input => {
          input.classList.remove('error-border');
        });
      }

      showAuthError(fieldId, message) {
        const errorElement = document.getElementById(fieldId + 'Error');
        const inputElement = document.getElementById(fieldId);
        if (errorElement) errorElement.textContent = message;
        if (inputElement) inputElement.classList.add('error-border');
      }

      async handleAuthSubmit(e) {
        e.preventDefault();
        this.clearAuthErrors();

        const email = this.elements.authEmail.value.trim();
        const password = this.elements.authPassword.value;
        const confirmPassword = this.elements.authConfirmPassword.value;

        // Validation
        if (!email) {
          this.showAuthError('authEmail', 'Email wajib diisi');
          return;
        }

        if (!password) {
          this.showAuthError('authPassword', 'Password wajib diisi');
          return;
        }

        if (!this.isLoginMode) {
          if (!confirmPassword) {
            this.showAuthError('authConfirmPassword', 'Konfirmasi password wajib diisi');
            return;
          }
          if (password !== confirmPassword) {
            this.showAuthError('authConfirmPassword', 'Password tidak cocok');
            return;
          }
          if (password.length < 6) {
            this.showAuthError('authPassword', 'Password minimal 6 karakter');
            return;
          }
        }

        // Disable submit button
        this.elements.authSubmitBtn.disabled = true;
        this.elements.authSubmitText.innerHTML = '<div class="loading"></div>Memproses...';

        try {
          if (this.isLoginMode) {
            await signInWithEmailAndPassword(auth, email, password);
          } else {
            await createUserWithEmailAndPassword(auth, email, password);
          }
          this.hideAuthModal();
        } catch (error) {
          console.error('Auth error:', error);
          
          let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
          
          switch (error.code) {
            case 'auth/user-not-found':
            case 'auth/wrong-password':
            case 'auth/invalid-credential':
              errorMessage = 'Email atau password salah';
              break;
            case 'auth/email-already-in-use':
              errorMessage = 'Email sudah terdaftar';
              break;
            case 'auth/weak-password':
              errorMessage = 'Password terlalu lemah';
              break;
            case 'auth/invalid-email':
              errorMessage = 'Format email tidak valid';
              break;
            case 'auth/too-many-requests':
              errorMessage = 'Terlalu banyak percobaan. Coba lagi nanti.';
              break;
          }
          
          this.showAuthError('authEmail', errorMessage);
        } finally {
          this.elements.authSubmitBtn.disabled = false;
          this.elements.authSubmitText.textContent = this.isLoginMode ? 'Login' : 'Daftar';
        }
      }

      // Survey Navigation Methods
      nextStep() {
        if (this.validateStep(this.currentStep)) {
          if (this.currentStep < this.totalSteps - 1) {
            this.currentStep++;
            this.showStep(this.currentStep);
            this.saveAutoSaveData();
          }
        }
      }

      prevStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
        }
      }

      showStep(n) {
        this.elements.steps.forEach((step, i) => {
          step.classList.toggle('active', i === n);
        });

        this.elements.prevBtn.disabled = n === 0;
        
        if (n === this.totalSteps - 1) {
          this.elements.nextBtn.style.display = 'none';
          this.elements.submitBtn.style.display = 'inline-block';
        } else {
          this.elements.nextBtn.style.display = 'inline-block';
          this.elements.submitBtn.style.display = 'none';
        }

        this.updateProgress();
      }

      updateProgress() {
        const progress = ((this.currentStep + 1) / this.totalSteps) * 100;
        this.elements.progressBar.style.width = progress + '%';
        this.elements.stepTitle.textContent = this.stepTitles[this.currentStep];
        this.elements.progressText.textContent = `${this.currentStep + 1} / 8`;

        // Update step indicators
        const dots = this.elements.stepIndicator.querySelectorAll('.step-dot');
        dots.forEach((dot, index) => {
          dot.classList.remove('active', 'completed');
          if (index < this.currentStep) {
            dot.classList.add('completed');
          } else if (index === this.currentStep) {
            dot.classList.add('active');
          }
        });
      }

      // Validation Methods
      clearErrors() {
        document.querySelectorAll('.error').forEach(error => error.textContent = '');
        document.querySelectorAll('input, select, textarea').forEach(input => {
          input.classList.remove('error-border');
        });
      }

      showError(fieldId, message) {
        const errorElement = document.getElementById(fieldId + 'Error');
        const inputElement = document.getElementById(fieldId);
        if (errorElement) errorElement.textContent = message;
        if (inputElement) inputElement.classList.add('error-border');
      }

      validateStep(n) {
        this.clearErrors();
        let isValid = true;

        switch (n) {
          case 0:
            const step0Fields = ['name', 'email', 'gender', 'age', 'city', 'job', 'income', 'marital', 'whatsapp', 'ewallet', 'jenisewallet', 'instagram'];
            step0Fields.forEach(field => {
              const input = document.getElementById(field);
              if (!input.value.trim()) {
                this.showError(field, 'Field ini wajib diisi');
                isValid = false;
              }
            });
            
            // Phone validation
            if (document.getElementById('whatsapp').value && !/^[0-9+\-\s()]+$/.test(document.getElementById('whatsapp').value)) {
              this.showError('whatsapp', 'Format nomor WhatsApp tidak valid');
              isValid = false;
            }
            if (document.getElementById('ewallet').value && !/^[0-9+\-\s()]+$/.test(document.getElementById('ewallet').value)) {
              this.showError('ewallet', 'Format nomor E-Wallet tidak valid');
              isValid = false;
            }
            break;

          case 1:
            const step1Fields = ['productType', 'favoriteColor', 'size', 'priceRange'];
            step1Fields.forEach(field => {
              const input = document.getElementById(field);
              if (!input.value.trim()) {
                this.showError(field, 'Field ini wajib diisi');
                isValid = false;
              }
            });
            break;

          case 2:
            const step2Fields = ['shoppingPlace', 'favoriteBrand', 'shopFrequency', 'reasonBuy', 'favPayment'];
            step2Fields.forEach(field => {
              const input = document.getElementById(field);
              if (!input.value.trim()) {
                this.showError(field, 'Field ini wajib diisi');
                isValid = false;
              }
            });
            
            if (!document.querySelector('input[name="limitedEdition"]:checked')) {
              this.showError('limitedEdition', 'Pilihan wajib dipilih');
              isValid = false;
            }
            break;

          case 3:
            if (!document.querySelector('input[name="hasPurchased"]:checked')) {
              this.showError('hasPurchased', 'Pilihan wajib dipilih');
              isValid = false;
            }
            if (!document.getElementById('shopExp').value.trim()) {
              this.showError('shopExp', 'Field ini wajib diisi');
              isValid = false;
            }
            break;

          case 4:
            const step4Fields = ['logoImpression', 'designAesthetic', 'instagramQuality', 'brandingSuggestion'];
            step4Fields.forEach(field => {
              const input = document.getElementById(field);
              if (!input.value.trim()) {
                this.showError(field, 'Field ini wajib diisi');
                isValid = false;
              }
            });
            break;

          case 5:
            const step5Fields = ['otherIdea', 'serviceIdea'];
            step5Fields.forEach(field => {
              const input = document.getElementById(field);
              if (!input.value.trim()) {
                this.showError(field, 'Field ini wajib diisi');
                isValid = false;
              }
            });
            break;

          case 6:
            const step6Fields = ['suggestion', 'mainProblem'];
            step6Fields.forEach(field => {
              const input = document.getElementById(field);
              if (!input.value.trim()) {
                this.showError(field, 'Field ini wajib diisi');
                isValid = false;
              }
            });
            break;

          case 7:
            if (!document.getElementById('agreeFollow').checked) {
              this.showError('agreeFollow', 'Wajib follow Instagram @femmeia.cloth');
              isValid = false;
            }
            if (!document.getElementById('agree1').checked) {
              this.showError('agree1', 'Persetujuan penggunaan data wajib dicentang');
              isValid = false;
            }
            if (!document.getElementById('agree2').checked) {
              this.showError('agree2', 'Persetujuan undian berhadiah wajib dicentang');
              isValid = false;
            }
            break;
        }

        return isValid;
      }

      // Auto-save functionality
      scheduleAutoSave() {
        if (this.autoSaveTimeout) {
          clearTimeout(this.autoSaveTimeout);
        }
        
        this.autoSaveTimeout = setTimeout(() => {
          this.saveAutoSaveData();
        }, 2000); // Save after 2 seconds of inactivity
      }

      saveAutoSaveData() {
        if (!this.currentUser) return;
        
        const formData = new FormData(this.elements.surveyForm);
        const data = {};
        
        for (let [key, value] of formData.entries()) {
          data[key] = value;
        }
        
        // Add checkbox data
        data.buyMoment = Array.from(document.querySelectorAll('.buyMoment:checked')).map(cb => cb.value).join(', ');
        data.infoSource = Array.from(document.querySelectorAll('.infoSource:checked')).map(cb => cb.value).join(', ');
        data.productIdeas = Array.from(document.querySelectorAll('.productIdeas:checked')).map(cb => cb.value).join(', ');
        data.limitedEdition = document.querySelector('input[name="limitedEdition"]:checked')?.value || '';
        data.hasPurchased = document.querySelector('input[name="hasPurchased"]:checked')?.value || '';
        
        data.currentStep = this.currentStep;
        data.timestamp = new Date().toISOString();
        
        localStorage.setItem(`survey_autosave_${this.currentUser.uid}`, JSON.stringify(data));
        
        this.showAutoSaveIndicator();
      }

      loadAutoSavedData() {
        if (!this.currentUser) return;
        
        const savedData = localStorage.getItem(`survey_autosave_${this.currentUser.uid}`);
        if (!savedData) return;
        
        try {
          const data = JSON.parse(savedData);
          
          // Restore form fields
          Object.keys(data).forEach(key => {
            const element = document.getElementById(key);
            if (element && data[key]) {
              if (element.type === 'checkbox' || element.type === 'radio') {
                element.checked = true;
              } else {
                element.value = data[key];
              }
            }
          });
          
          // Restore checkboxes
          if (data.buyMoment) {
            data.buyMoment.split(', ').forEach(value => {
              const checkbox = document.querySelector(`.buyMoment[value="${value}"]`);
              if (checkbox) checkbox.checked = true;
            });
          }
          
          if (data.infoSource) {
            data.infoSource.split(', ').forEach(value => {
              const checkbox = document.querySelector(`.infoSource[value="${value}"]`);
              if (checkbox) checkbox.checked = true;
            });
          }
          
          if (data.productIdeas) {
            data.productIdeas.split(', ').forEach(value => {
              const checkbox = document.querySelector(`.productIdeas[value="${value}"]`);
              if (checkbox) checkbox.checked = true;
            });
          }
          
          // Restore radio buttons
          if (data.limitedEdition) {
            const radio = document.querySelector(`input[name="limitedEdition"][value="${data.limitedEdition}"]`);
            if (radio) radio.checked = true;
          }
          
          if (data.hasPurchased) {
            const radio = document.querySelector(`input[name="hasPurchased"][value="${data.hasPurchased}"]`);
            if (radio) {
              radio.checked = true;
              this.toggleCustomerSatisfactionFields(data.hasPurchased);
            }
          }
          
          // Restore current step
          if (data.currentStep && data.currentStep < this.totalSteps) {
            this.currentStep = data.currentStep;
            this.showStep(this.currentStep);
          }
          
        } catch (error) {
          console.error('Error loading auto-saved data:', error);
        }
      }

      showAutoSaveIndicator() {
        this.elements.autoSaveIndicator.classList.add('show', 'success');
        setTimeout(() => {
          this.elements.autoSaveIndicator.classList.remove('show');
        }, 2000);
      }

      // Customer satisfaction fields toggle
      toggleCustomerSatisfactionFields(value) {
        const groups = ['ratingGroup', 'qualityGroup', 'materialQualityGroup', 'serviceQualityGroup', 'feedbackGroup'];
        
        groups.forEach(groupId => {
          const group = document.getElementById(groupId);
          if (group) {
            if (value === 'Ya') {
              group.style.display = 'block';
            } else {
              group.style.display = 'none';
              // Clear values
              const inputs = group.querySelectorAll('input, select, textarea');
              inputs.forEach(input => input.value = '');
            }
          }
        });
      }

      // Modal Methods
      showModal(type, title, message) {
        let content = '';
        
        if (type === 'loading') {
          content = `
            <div class="modal-spinner"></div>
            <h3>${title}</h3>
            <p class="pulse">${message}</p>
          `;
        } else if (type === 'success') {
          content = `
            <div class="modal-status success">✅ Berhasil</div>
            <h3>${title}</h3>
            <p>${message}</p>
            <button class="modal-btn" onclick="surveyManager.hideModal()">
              Tutup
            </button>
          `;
        } else if (type === 'error') {
          content = `
            <div class="modal-status error">❌ Gagal</div>
            <h3>${title}</h3>
            <p>${message}</p>
            <button class="modal-btn" onclick="surveyManager.hideModal()">
              Tutup
            </button>
          `;
        }
        
        this.elements.modalContent.innerHTML = content;
        this.elements.modalOverlay.classList.add('active');
      }

      hideModal() {
        this.elements.modalOverlay.classList.remove('active');
      }

      // Quota Management
      async checkQuotaAndToggleForm() {
        if (this.hasSubmitted) return;
        
        try {
          const quotaDocRef = doc(db, "survey_control", "quota");
          const docSnap = await getDoc(quotaDocRef);
          
          if (docSnap.exists()) {
            this.quotaCount = docSnap.data().count;
            if (this.quotaCount <= 0) {
              this.elements.quotaInfo.innerHTML = "🚫 Stok survey sudah habis. Terima kasih atas antusiasmenya!";
              this.elements.quotaInfo.className = "quota-info empty";
              this.elements.quotaInfo.style.display = "block";
              this.elements.surveyForm.classList.add('form-hidden');
            } else {
              this.elements.quotaInfo.innerHTML = `✅ Sisa kuota survey: <strong>${this.quotaCount}</strong>`;
              this.elements.quotaInfo.className = "quota-info";
              this.elements.quotaInfo.style.display = "block";
              this.elements.surveyForm.classList.remove('form-hidden');
            }
          } else {
            this.elements.quotaInfo.innerHTML = "⚠️ Quota belum diinisialisasi di Firestore!";
            this.elements.quotaInfo.className = "quota-info empty";
            this.elements.quotaInfo.style.display = "block";
            this.elements.surveyForm.classList.add('form-hidden');
          }
        } catch (err) {
          this.elements.quotaInfo.innerHTML = "❌ Gagal memuat quota survey.";
          this.elements.quotaInfo.className = "quota-info empty";
          this.elements.quotaInfo.style.display = "block";
          this.elements.surveyForm.classList.add('form-hidden');
        }
      }

      // Survey Submission
      async handleSurveySubmit(event) {
        event.preventDefault();

        if (!this.validateStep(this.currentStep) || !this.currentUser || this.hasSubmitted) {
          return;
        }

        // Show loading modal
        this.showModal('loading', 'Mengirim Survey', 'Mohon tunggu sebentar, survey Anda sedang diproses...');

        // Collect form data
        const surveyData = this.collectSurveyData();
        
        // Calculate prize and conclusion
        const { prizeAmount, conclusion } = this.calculatePrizeAndConclusion(surveyData);
        surveyData.prizeAmount = prizeAmount;
        surveyData.conclusion = conclusion;

        try {
          const quotaDocRef = doc(db, "survey_control", "quota");
          
          await runTransaction(db, async (transaction) => {
            const quotaDoc = await transaction.get(quotaDocRef);
            if (!quotaDoc.exists()) throw "Quota tidak ditemukan!";
            let count = quotaDoc.data().count;
            if (count <= 0) throw "Stok survey sudah habis!";
            
            // Check if user already submitted
            const surveysRef = collection(db, "surveys");
            const q = query(surveysRef, where("userId", "==", this.currentUser.uid));
            const existingSubmissions = await getDocs(q);
            if (!existingSubmissions.empty) throw "Anda sudah pernah mengisi survey!";
            
            // Save survey
            const surveysCol = collection(db, "surveys");
            await addDoc(surveysCol, surveyData);
            
            // Update quota
            transaction.update(quotaDocRef, { count: count - 1 });
          });

          // Send email
          emailjs.send('service_00xj2ta', 'template_4i1ue1g', surveyData)
            .then(() => {
              this.showModal(
                'success', 
                'Survey Berhasil Dikirim', 
                `Terima kasih atas partisipasi Anda! Hadiah Rp${prizeAmount} akan dikirimkan dalam 1x24 jam ke e-wallet yang telah Anda cantumkan.`
              );
              this.clearFormAndAutoSave();
            }, (error) => {
              this.showModal(
                'success', 
                'Survey Berhasil Disimpan', 
                `Survey Anda telah berhasil disimpan dengan hadiah Rp${prizeAmount}, namun pengiriman email notifikasi gagal. Kami tetap akan memproses hadiah Anda.`
              );
              console.error(error);
              this.clearFormAndAutoSave();
            });

        } catch (e) {
          this.handleSubmissionError(e);
        }
      }

      collectSurveyData() {
        return {
          // User identification
          userId: this.currentUser.uid,
          userEmail: this.currentUser.email,
          
          // Step 1: Informasi Pribadi
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          gender: document.getElementById('gender').value,
          age: document.getElementById('age').value,
          city: document.getElementById('city').value,
          job: document.getElementById('job').value,
          income: document.getElementById('income')?.value || '',
          marital: document.getElementById('marital')?.value || '',
          whatsapp: document.getElementById('whatsapp').value,
          ewallet: document.getElementById('ewallet').value,
          jenisewallet: document.getElementById('jenisewallet').value,
          instagram: document.getElementById('instagram').value,

          // Step 2: Preferensi Produk Hijab
          productType: document.getElementById('productType').value,
          favoriteColor: document.getElementById('favoriteColor').value,
          size: document.getElementById('size').value,
          priceRange: document.getElementById('priceRange').value,

          // Step 3: Perilaku Belanja Hijab
          shoppingPlace: document.getElementById('shoppingPlace').value,
          favoriteBrand: document.getElementById('favoriteBrand').value,
          shopFrequency: document.getElementById('shopFrequency').value,
          reasonBuy: document.getElementById('reasonBuy').value,
          buyMoment: Array.from(document.querySelectorAll('.buyMoment:checked')).map(cb => cb.value).join(', '),
          infoSource: Array.from(document.querySelectorAll('.infoSource:checked')).map(cb => cb.value).join(', '),
          limitedEdition: document.querySelector('input[name="limitedEdition"]:checked')?.value || '',
          favPayment: document.getElementById('favPayment').value,

          // Step 4: Kepuasan Pelanggan
          hasPurchased: document.querySelector('input[name="hasPurchased"]:checked')?.value || '',
          rating: document.getElementById('rating').value,
          quality: document.getElementById('quality').value,
          materialQuality: document.getElementById('materialQuality').value,
          serviceQuality: document.getElementById('serviceQuality').value,
          shopExp: document.getElementById('shopExp').value,
          feedback: document.getElementById('feedback').value,

          // Step 5: Branding & Visual
          logoImpression: document.getElementById('logoImpression').value,
          designAesthetic: document.getElementById('designAesthetic').value,
          instagramQuality: document.getElementById('instagramQuality').value,
          brandingSuggestion: document.getElementById('brandingSuggestion').value,

          // Step 6: Ide Produk & Layanan
          productIdeas: Array.from(document.querySelectorAll('.productIdeas:checked')).map(cb => cb.value).join(', '),
          otherIdea: document.getElementById('otherIdea').value,
          serviceIdea: document.getElementById('serviceIdea').value,

          // Step 7: Masukan Umum & Testimoni
          suggestion: document.getElementById('suggestion').value,
          mainProblem: document.getElementById('mainProblem').value,

          // Step 8: Timestamp
          timestamp: new Date()
        };
      }

      handleSubmissionError(e) {
        if (e === "Stok survey sudah habis!") {
          this.showModal(
            'error', 
            'Kuota Survey Habis', 
            'Mohon maaf, kuota survey sudah habis. Terima kasih atas antusiasme Anda!'
          );
        } else if (e === "Anda sudah pernah mengisi survey!") {
          this.showModal(
            'error', 
            'Survey Sudah Pernah Diisi', 
            'Anda sudah pernah mengisi survey ini sebelumnya. Setiap akun hanya dapat mengisi survey satu kali.'
          );
          this.hasSubmitted = true;
          this.checkUserSubmissionStatus();
        } else {
          this.showModal(
            'error', 
            'Gagal Mengirim Survey', 
            'Terjadi kesalahan saat mengirim survey. Silakan coba lagi dalam beberapa saat.'
          );
        }
        console.error(e);
        this.checkQuotaAndToggleForm();
      }

      clearFormAndAutoSave() {
        this.elements.surveyForm.reset();
        this.currentStep = 0;
        this.showStep(this.currentStep);
        this.hasSubmitted = true;
        
        // Clear auto-saved data
        if (this.currentUser) {
          localStorage.removeItem(`survey_autosave_${this.currentUser.uid}`);
        }
        
        this.checkUserSubmissionStatus();
      }

      // Prize calculation with improved accuracy
      calculatePrizeAndConclusion(surveyData) {
        let prize = 1000;
        let profileScore = 0;
        let engagementScore = 0;
        let qualityScore = 0;
        let brandLoyaltyScore = 0;
        let innovationScore = 0;

        // 1. Profile Completeness Score (max 300 points)
        const requiredFields = ['name', 'email', 'whatsapp', 'instagram', 'city', 'gender', 'age'];
        const optionalFields = ['job', 'income', 'marital'];
        
        const completedRequired = requiredFields.filter(field => surveyData[field] && surveyData[field].trim()).length;
        profileScore += (completedRequired / requiredFields.length) * 200;
        
        const completedOptional = optionalFields.filter(field => 
          surveyData[field] && surveyData[field].trim() && 
          !surveyData[field].includes('Tidak Menjawab')
        ).length;
        profileScore += (completedOptional / optionalFields.length) * 100;

        // 2. Engagement Quality Score (max 600 points)
        const textFields = [
          { field: "shopExp", weight: 1.2, minLength: 50 },
          { field: "brandingSuggestion", weight: 1.5, minLength: 30 },
          { field: "otherIdea", weight: 1.3, minLength: 20 },
          { field: "serviceIdea", weight: 1.3, minLength: 20 },
          { field: "suggestion", weight: 1.4, minLength: 30 },
          { field: "mainProblem", weight: 1.2, minLength: 30 },
          { field: "feedback", weight: 1.1, minLength: 20 }
        ];

        textFields.forEach(({ field, weight, minLength }) => {
          if (surveyData[field] && surveyData[field].trim()) {
            const text = surveyData[field].trim();
            let fieldScore = 0;
            
            if (text.length >= minLength) {
              fieldScore = 30;
              if (text.length > 100) fieldScore += 40;
              else if (text.length > 50) fieldScore += 20;
              
              const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10).length;
              if (sentences >= 3) fieldScore += 20;
              
              const valuableKeywords = ['saran', 'sebaiknya', 'bisa', 'perlu', 'harap', 'mungkin', 'lebih baik', 'kualitas', 'pelayanan'];
              const keywordCount = valuableKeywords.filter(keyword => 
                text.toLowerCase().includes(keyword)
              ).length;
              fieldScore += Math.min(keywordCount * 5, 20);
            }
            
            engagementScore += fieldScore * weight;
          }
        });

        // 3. Brand Loyalty & Experience Score (max 400 points)
        if (surveyData.hasPurchased === 'Ya') {
          brandLoyaltyScore += 150;
          
          if (surveyData.rating) {
            const rating = parseInt(surveyData.rating);
            if (rating >= 4) brandLoyaltyScore += 100;
            else if (rating >= 3) brandLoyaltyScore += 50;
            else brandLoyaltyScore += 25;
          }
          
          if (surveyData.quality && surveyData.materialQuality && surveyData.serviceQuality) {
            brandLoyaltyScore += 75;
          }
          
          if (surveyData.feedback && surveyData.feedback.length > 30) {
            brandLoyaltyScore += 75;
          }
        } else {
          brandLoyaltyScore += 50;
        }

        // 4. Market Research Value Score (max 300 points)
        let marketResearchScore = 0;
        
        const behaviorFields = ['shoppingPlace', 'favoriteBrand', 'shopFrequency', 'reasonBuy', 'favPayment'];
        const completedBehavior = behaviorFields.filter(field => surveyData[field] && surveyData[field].trim()).length;
        marketResearchScore += (completedBehavior / behaviorFields.length) * 100;
        
        const preferenceFields = ['productType', 'favoriteColor', 'size', 'priceRange'];
        const completedPreferences = preferenceFields.filter(field => surveyData[field] && surveyData[field].trim()).length;
        marketResearchScore += (completedPreferences / preferenceFields.length) * 100;
        
        if (surveyData.buyMoment && surveyData.buyMoment.length > 0) marketResearchScore += 25;
        if (surveyData.infoSource && surveyData.infoSource.length > 0) marketResearchScore += 25;
        if (surveyData.productIdeas && surveyData.productIdeas.length > 0) marketResearchScore += 25;
        if (surveyData.limitedEdition) marketResearchScore += 25;

        // 5. Innovation & Branding Feedback Score (max 400 points)
        const brandingFields = ['logoImpression', 'designAesthetic', 'instagramQuality'];
        const completedBranding = brandingFields.filter(field => surveyData[field] && surveyData[field].trim()).length;
        innovationScore += (completedBranding / brandingFields.length) * 150;
        
        if (surveyData.brandingSuggestion && surveyData.brandingSuggestion.length > 50) {
          innovationScore += 100;
        }
        
        if (surveyData.otherIdea && surveyData.otherIdea.length > 30) {
          innovationScore += 75;
        }
        
        if (surveyData.serviceIdea && surveyData.serviceIdea.length > 30) {
          innovationScore += 75;
        }

        // Calculate total score and final prize
        const totalScore = profileScore + engagementScore + brandLoyaltyScore + marketResearchScore + innovationScore;
        
        if (totalScore >= 1500) prize = 5000;
        else if (totalScore >= 1200) prize = 4000;
        else if (totalScore >= 1000) prize = 3000;
        else if (totalScore >= 800) prize = 2500;
        else if (totalScore >= 600) prize = 2000;
        else if (totalScore >= 400) prize = 1500;
        else if (totalScore >= 250) prize = 1000;
        else if (totalScore >= 150) prize = 500;
        else prize = 1000;

        const conclusion = this.generateImprovedConclusion(surveyData, {
          profileScore,
          engagementScore,
          brandLoyaltyScore,
          marketResearchScore,
          innovationScore,
          totalScore
        });

        return {
          prizeAmount: prize,
          conclusion: conclusion
        };
      }

      generateImprovedConclusion(data, scores) {
        const conclusions = [];

        // Demographic Profile
        let profileConclusion = `Responden ${data.name} (${data.gender.toLowerCase()}, ${data.age} tahun) dari ${data.city}`;
        
        if (data.job && !data.job.includes('Tidak Menjawab')) {
          profileConclusion += ` dengan status ${data.job.toLowerCase()}`;
        }
        
        if (data.income && !data.income.includes('Tidak Menjawab')) {
          const incomeText = data.income === '<1jt' ? 'di bawah 1 juta' : 
                            data.income === '1-3jt' ? 'antara 1-3 juta' : 'di atas 3 juta';
          profileConclusion += ` dan penghasilan bulanan ${incomeText}`;
        }
        
        profileConclusion += '.';
        conclusions.push(profileConclusion);

        // Product Preferences & Shopping Behavior
        if (data.productType && data.favoriteColor) {
          let preferenceConclusion = `Memiliki preferensi hijab jenis ${data.productType.toLowerCase()}`;
          if (data.favoriteColor) preferenceConclusion += ` dengan warna ${data.favoriteColor.toLowerCase()}`;
          if (data.size) preferenceConclusion += `, ukuran ${data.size}`;
          if (data.priceRange) {
            const priceText = data.priceRange === '<50rb' ? 'ekonomis (di bawah 50rb)' :
                             data.priceRange === '50rb-100rb' ? 'menengah (50-100rb)' : 'premium (di atas 100rb)';
            preferenceConclusion += ` dengan budget ${priceText}`;
          }
          preferenceConclusion += '.';
          conclusions.push(preferenceConclusion);
        }

        // Shopping Behavior Analysis
        if (data.shoppingPlace && data.shopFrequency) {
          let behaviorConclusion = `Berbelanja hijab secara ${data.shoppingPlace.toLowerCase()}`;
          
          const frequencyText = data.shopFrequency === '1-2x' ? 'jarang (1-2x/tahun)' :
                               data.shopFrequency === '3-5x' ? 'sedang (3-5x/tahun)' :
                               data.shopFrequency === '>6x' ? 'sering (>6x/tahun)' : 'tidak teratur';
          behaviorConclusion += ` dengan frekuensi ${frequencyText}`;
          
          if (data.favPayment) {
            behaviorConclusion += ` dan lebih suka pembayaran ${data.favPayment.toLowerCase()}`;
          }
          
          if (data.reasonBuy) {
            behaviorConclusion += `. Motivasi utama pembelian adalah ${data.reasonBuy.toLowerCase()}`;
          }
          
          behaviorConclusion += '.';
          conclusions.push(behaviorConclusion);
        }

        // Brand Relationship
        if (data.hasPurchased === 'Ya') {
          let brandConclusion = 'Merupakan pelanggan existing Femmeia';
          if (data.rating) {
            const ratingText = parseInt(data.rating) >= 4 ? 'sangat puas' :
                              parseInt(data.rating) >= 3 ? 'cukup puas' : 'kurang puas';
            brandConclusion += ` dengan tingkat kepuasan ${ratingText} (${data.rating}/5)`;
          }
          
          if (data.quality && data.materialQuality && data.serviceQuality) {
            brandConclusion += `. Menilai kualitas produk ${data.quality.toLowerCase()}, bahan ${data.materialQuality.toLowerCase()}, dan pelayanan ${data.serviceQuality.toLowerCase()}`;
          }
          
          brandConclusion += '.';
          conclusions.push(brandConclusion);
        } else {
          conclusions.push('Merupakan calon pelanggan potensial yang belum pernah berbelanja di Femmeia.');
        }

        // Brand Perception
        if (data.logoImpression && data.designAesthetic) {
          const logoText = data.logoImpression.toLowerCase();
          const designText = data.designAesthetic.toLowerCase();
          conclusions.push(`Persepsi terhadap brand: logo dinilai ${logoText} dan desain produk ${designText}.`);
        }

        // Engagement Quality Assessment
        let engagementConclusion = '';
        if (scores.totalScore >= 1200) {
          engagementConclusion = 'Memberikan feedback yang sangat komprehensif dan detail, menunjukkan engagement tinggi terhadap brand.';
        } else if (scores.totalScore >= 800) {
          engagementConclusion = 'Memberikan feedback yang baik dan konstruktif dengan insight yang berharga.';
        } else if (scores.totalScore >= 400) {
          engagementConclusion = 'Memberikan feedback dasar yang cukup membantu untuk pengembangan brand.';
        } else {
          engagementConclusion = 'Memberikan feedback minimal namun tetap berkontribusi pada riset pasar.';
        }
        conclusions.push(engagementConclusion);

        // Market Segment Classification
        let segmentConclusion = 'Termasuk dalam segmen ';
        if (data.shopFrequency === '>6x' && data.priceRange === '>100rb') {
          segmentConclusion += 'premium loyal customer dengan daya beli tinggi.';
        } else if (data.shopFrequency === '3-5x' || data.shopFrequency === '>6x') {
          segmentConclusion += 'active customer dengan potensi repeat purchase yang baik.';
        } else if (data.reasonBuy === 'Fashion' && data.limitedEdition === 'Ya') {
          segmentConclusion += 'fashion-conscious customer yang tertarik produk eksklusif.';
        } else if (data.priceRange === '30rb-50rb') {
          segmentConclusion += 'price-sensitive customer yang mengutamakan value for money.';
        } else {
          segmentConclusion += 'mainstream customer dengan perilaku belanja standar.';
        }
        conclusions.push(segmentConclusion);

        return conclusions.join(' ');
      }
    }

    // Initialize the survey manager
    const surveyManager = new SurveyManager();
    
    // Make it globally accessible for modal buttons
    window.surveyManager = surveyManager;
    
    // Initialize the first step
    surveyManager.showStep(0);
  </script>
  
  <script>
    document.getElementById('surveyForm').addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        if (event.target.tagName !== 'TEXTAREA') {
          event.preventDefault();
        }
      }
    });
  </script>

</body>
</html>
