<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FemmeiaCloth - Hijab & Aksesoris Fashion Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff6b9d;
            --primary-dark: #c44569;
            --background: #0f0f23;
            --background-light: #1a1a2e;
            --background-lighter: #16213e;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --blur-strength: 20px;
            --transition-speed: 0.3s;
            
            /* Checkout form colors - now dark theme */
            --bento-bg: #0f0f23;
            --bento-blur: rgba(15, 15, 35, 0.85);
            --soft-pink: #1a1a2e;
            --soft-purple: #16213e;
            --checkout-border: rgba(255, 255, 255, 0.1);
            --accent: #ff6b9d;
            --main-text: #e2e8f0;
            --secondary-text: #94a3b8;
            --button: #1a1a2e;
            --shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.3), 0 1px 8px 0 rgba(0, 0, 0, 0.2);
            --profile-shadow: 0 6px 26px 0 rgba(0, 0, 0, 0.2), 0 1.5px 8px 0 rgba(0, 0, 0, 0.15);
            --header-grad: linear-gradient(90deg, #1a1a2e 0%, #16213e 100%);
            --card-shadow: 0 10px 70px 0 rgba(0, 0, 0, 0.2), 0 1px 4px 0 rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, var(--background-light) 50%, var(--background-lighter) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navigation */
        .navbar {
            background: rgba(15, 15, 35, 0.8);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border-bottom: 1px solid var(--border);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 1rem 0;
            transition: all var(--transition-speed) ease;
        }

        .navbar:hover {
            background: rgba(15, 15, 35, 0.9);
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: transform var(--transition-speed) ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .nav-links a:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: all var(--transition-speed) ease;
            transform: translateX(-50%);
        }

        .nav-links a:hover:before {
            width: 80%;
        }

        .nav-links a:hover {
            background: rgba(255, 107, 157, 0.1);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .cart-badge {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            padding: 0.2rem 0.5rem;
            font-size: 0.8rem;
            margin-left: 0.5rem;
            transition: all var(--transition-speed) ease;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .mobile-menu-btn:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        /* Page Sections */
        .page-section {
            display: none;
            padding-top: 100px;
            min-height: 100vh;
            animation: fadeIn 0.6s ease-out;
        }

        .page-section.active {
            display: block;
        }

        /* Auth Forms */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            background: radial-gradient(circle at center, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }

        .auth-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 107, 157, 0.3);
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        .auth-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at bottom right, rgba(255, 107, 157, 0.1), transparent 70%);
            z-index: -1;
        }

        .auth-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #cbd5e1;
            transition: all var(--transition-speed) ease;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-family: 'Quicksand', sans-serif;
            transition: all var(--transition-speed) ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-group input:focus + label {
            color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 12px;
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 157, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .auth-switch {
            text-align: center;
            color: var(--text-muted);
            margin-top: 1rem;
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
            position: relative;
        }

        .auth-switch a::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 1px;
            bottom: -2px;
            left: 0;
            background-color: var(--primary);
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease-out;
        }

        .auth-switch a:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }

        .forgot-password {
            text-align: right;
            margin-bottom: 1rem;
        }

        .forgot-password a {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all var(--transition-speed) ease;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .error {
            color: #ef4444;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        /* Bento Grid Layout */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 2rem 0;
        }

        .bento-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }

        .bento-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 107, 157, 0.3);
        }

        .bento-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        .bento-card h3 {
            margin-bottom: 1rem;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .bento-card h3::after {
            content: '';
            position: absolute;
            width: 30%;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: var(--primary);
            transition: width var(--transition-speed) ease;
        }

        .bento-card:hover h3::after {
            width: 50%;
        }

        /* Promo Card */
        .promo-card {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.15), rgba(196, 69, 105, 0.15));
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .promo-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        .promo-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .promo-card .promo-code {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            color: var(--primary);
            display: inline-block;
            margin: 0.5rem 0;
            letter-spacing: 1px;
        }

        /* Product Cards */
        .product-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            transition: all var(--transition-speed) ease;
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 107, 157, 0.3);
        }

        .product-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }

        .product-card:hover::after {
            opacity: 1;
        }

        .product-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            transition: all var(--transition-speed) ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
            transition: all var(--transition-speed) ease;
        }

        .product-card:hover .product-name {
            color: var(--primary);
        }

        .product-price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            transition: all var(--transition-speed) ease;
        }

        .product-card:hover .product-price {
            transform: scale(1.05);
        }

        .product-colors {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .color-option:hover {
            transform: scale(1.2);
            border-color: var(--primary);
        }

        .color-option.selected {
            border-color: var(--primary);
            transform: scale(1.2);
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.3);
        }

        /* Cart */
        .cart-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all var(--transition-speed) ease;
            border: 1px solid var(--border);
        }

        .cart-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 107, 157, 0.2);
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            transition: all var(--transition-speed) ease;
        }

        .cart-item:hover .cart-item-image {
            transform: scale(1.05);
        }

        .cart-item-info {
            flex: 1;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quantity-btn {
            background: var(--primary);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all var(--transition-speed) ease;
        }

        .quantity-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 10px rgba(255, 107, 157, 0.3);
        }

        .cart-total {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 2rem 0;
            text-shadow: 0 2px 10px rgba(255, 107, 157, 0.3);
            animation: pulse 2s infinite;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }

        .filter-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
            z-index: -1;
        }

        .filter-btn:hover::before,
        .filter-btn.active::before {
            opacity: 1;
        }

        .filter-btn.active,
        .filter-btn:hover {
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Checkout Section Styles */
        .checkout-container {
            background: var(--bento-bg);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .checkout-wrapper {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .checkout-auth-warning {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid var(--primary);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .checkout-auth-warning h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .checkout-auth-warning p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .cart-summary {
            background: var(--bento-blur);
            border-radius: 24px;
            box-shadow: var(--card-shadow);
            border: 1.5px solid var(--checkout-border);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .cart-summary h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .cart-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--checkout-border);
        }

        .cart-summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
            color: var(--primary);
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--checkout-border);
        }

        .checkout-form {
            background: var(--bento-blur);
            border-radius: 24px;
            box-shadow: var(--card-shadow);
            border: 1.5px solid var(--checkout-border);
            padding: 2rem;
        }

        .checkout-form h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .checkout-form label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--text);
            font-size: 0.9rem;
        }

        .checkout-form input,
        .checkout-form textarea,
        .checkout-form select {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            border: 1.5px solid var(--checkout-border);
            background: rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
            color: var(--text);
            font-family: 'Quicksand', sans-serif;
        }

        .checkout-form input:focus,
        .checkout-form select:focus,
        .checkout-form textarea:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 8px 0 rgba(255, 107, 157, 0.2);
        }

        .checkout-form textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .promo-input {
            position: relative;
        }

        .promo-input input {
            padding-right: 100px;
        }

        .promo-input .promo-status {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .promo-input .promo-status.valid {
            color: #10b981;
        }

        .promo-input .promo-status.invalid {
            color: #ef4444;
        }

        .whatsapp-btn {
            background: #25D366;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            width: 100%;
            margin-top: 1rem;
        }

        .whatsapp-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Profile Section */
        .profile-header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary);
            margin-bottom: 1rem;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .profile-upload {
            display: none;
        }

        .upload-btn {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            margin-bottom: 1rem;
            transition: all var(--transition-speed) ease;
        }

        .upload-btn:hover {
            background: rgba(255, 107, 157, 0.2);
            transform: translateY(-2px);
        }

        .profile-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .profile-tab {
            padding: 0.5rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .profile-tab.active {
            background: rgba(255, 107, 157, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }

        .profile-tab:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .profile-content {
            display: none;
            max-width: 500px;
            margin: 0 auto;
        }

        .profile-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* Product Detail Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem;
            animation: fadeIn 0.3s ease;
        }

        .modal-content-product {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border: 1px solid var(--border);
            border-radius: 20px;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            position: relative;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .close-modal:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        .product-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .product-detail-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 12px;
            transition: all var(--transition-speed) ease;
            border: 1px solid var(--border);
        }

        .product-detail-image:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .product-detail-info h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .product-detail-price {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary);
            text-shadow: 0 2px 10px rgba(255, 107, 157, 0.3);
        }

        .color-select {
            margin-bottom: 1.5rem;
        }

        .color-select label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .color-options {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            z-index: 1001;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* About Section */
        .about-section {
            padding: 2rem 0;
        }

        .about-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .about-header h2 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .about-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .about-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 20px;
            transition: all var(--transition-speed) ease;
        }

        .about-image:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .about-text {
            line-height: 1.8;
        }

        .about-text p {
            margin-bottom: 1rem;
        }

        /* Sticky Cart Button */
        .sticky-cart {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all var(--transition-speed) ease;
            z-index: 999;
        }

        .sticky-cart:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 107, 157, 0.4);
        }

        .sticky-cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: white;
            color: var(--primary);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            border: 2px solid var(--primary);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .nav-links {
                gap: 1rem;
            }
            
            .nav-links a {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                background: rgba(15, 15, 35, 0.95);
                backdrop-filter: blur(var(--blur-strength));
                -webkit-backdrop-filter: blur(var(--blur-strength));
                flex-direction: column;
                padding: 1rem;
                gap: 0.5rem;
                transform: translateY(-150%);
                transition: transform var(--transition-speed) ease;
                z-index: 999;
                border-bottom: 1px solid var(--border);
            }
            
            .nav-links.active {
                transform: translateY(0);
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .bento-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .auth-card {
                padding: 2rem;
            }
            
            .filters {
                justify-content: center;
            }

            .cart-item {
                flex-direction: column;
                text-align: center;
            }

            .quantity-controls {
                justify-content: center;
                margin-top: 1rem;
            }

            .product-detail {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .checkout-wrapper {
                padding: 0 1rem;
            }

            .sticky-cart {
                bottom: 1rem;
                right: 1rem;
                width: 50px;
                height: 50px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { text-shadow: 0 0 5px rgba(255, 107, 157, 0.3); }
            50% { text-shadow: 0 0 20px rgba(255, 107, 157, 0.5); }
            100% { text-shadow: 0 0 5px rgba(255, 107, 157, 0.3); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .float {
            animation: float 6s ease-in-out infinite;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 0;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(196, 69, 105, 0.1));
            border-radius: 20px;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .hero p {
            font-size: 1.2rem;
            color: #cbd5e1;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">FemmeiaCloth</div>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
                <ul class="nav-links" id="navLinks">
                    <!-- Navigation links will be loaded dynamically based on auth state -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- Sticky Cart Button -->
    <div class="sticky-cart" onclick="showSection('cart')">
        <span class="sticky-cart-badge" id="stickyCartBadge">0</span>
        ðŸ›’
    </div>

    <!-- Auth Section -->
    <section id="authSection" class="page-section active">
        <div class="auth-container">
            <div class="auth-card">
                <div id="loginForm">
                    <h2 class="auth-title">Selamat Datang Kembali</h2>
                    <form onsubmit="login(event)">
                        <div class="form-group">
                            <label>Email atau Username</label>
                            <input type="text" id="loginEmail" required>
                            <div class="error" id="loginEmailError"></div>
                        </div>
                        <div class="form-group">
                            <label>Kata Sandi</label>
                            <input type="password" id="loginPassword" required>
                            <div class="error" id="loginPasswordError"></div>
                        </div>
                        <div class="forgot-password">
                            <a href="#" onclick="showForgotPassword()">Lupa kata sandi?</a>
                        </div>
                        <button type="submit" class="btn" id="loginBtn">
                            <span id="loginBtnText">Masuk</span>
                        </button>
                    </form>
                    <div class="auth-switch">
                        Belum punya akun? <a href="#" onclick="showRegister()">Daftar</a>
                    </div>
                </div>

                <div id="registerForm" style="display: none;">
                    <h2 class="auth-title">Bergabung dengan FemmeiaCloth</h2>
                    <form onsubmit="register(event)">
                        <div class="form-group">
                            <label>Nama Pengguna</label>
                            <input type="text" id="registerUsername" required>
                            <div class="error" id="registerUsernameError"></div>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="registerEmail" required>
                            <div class="error" id="registerEmailError"></div>
                        </div>
                        <div class="form-group">
                            <label>Kata Sandi</label>
                            <input type="password" id="registerPassword" required>
                            <div class="error" id="registerPasswordError"></div>
                        </div>
                        <button type="submit" class="btn" id="registerBtn">
                            <span id="registerBtnText">Daftar</span>
                        </button>
                    </form>
                    <div class="auth-switch">
                        Sudah punya akun? <a href="#" onclick="showLogin()">Masuk</a>
                    </div>
                </div>

                <div id="forgotPasswordForm" style="display: none;">
                    <h2 class="auth-title">Lupa Kata Sandi</h2>
                    <form onsubmit="resetPassword(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="resetEmail" required>
                            <div class="error" id="resetEmailError"></div>
                        </div>
                        <button type="submit" class="btn" id="resetBtn">
                            <span id="resetBtnText">Kirim Link Reset</span>
                        </button>
                    </form>
                    <div class="auth-switch">
                        Ingat kata sandi? <a href="#" onclick="showLogin()">Masuk</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Home Section -->
    <section id="homeSection" class="page-section">
        <div class="container">
            <div class="hero fade-in">
                <h1 class="float">Hijab & Fashion Premium</h1>
                <p>Temukan koleksi hijab dan aksesoris cantik berkualitas tinggi yang dirancang untuk wanita modern. Kualitas, variasi, dan harga terjangkau.</p>
            </div>

            <!-- Promo Card -->
            <div class="promo-card fade-in">
                <h3>Promo Spesial 10% OFF</h3>
                <p>Gunakan kode promo berikut saat checkout untuk mendapatkan diskon 10%</p>
                <div class="promo-code">FEMMEIA10</div>
                <p>Berlaku untuk semua produk. Periode terbatas!</p>
            </div>

            <div class="bento-grid">
                <div class="bento-card float">
                    <h3>Koleksi Unggulan</h3>
                    <p>Jelajahi desain hijab terbaru kami yang dibuat dengan bahan premium dan perhatian terhadap detail.</p>
                </div>
                <div class="bento-card float" style="animation-delay: 0.2s">
                    <h3>Jaminan Kualitas</h3>
                    <p>Setiap produk dipilih dengan hati-hati untuk memastikan kenyamanan, daya tahan, dan gaya yang bertahan lama.</p>
                </div>
                <div class="bento-card float" style="animation-delay: 0.4s">
                    <h3>Kemewahan Terjangkau</h3>
                    <p>Fashion yang indah tidak harus mahal. Temukan harga kompetitif kami.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="productsSection" class="page-section">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2.5rem; color: var(--primary);">Produk Kami</h2>
            
            <div class="filters">
                <button class="filter-btn active" onclick="filterProducts('all')">Semua</button>
                <button class="filter-btn" onclick="filterProducts('hijab')">Hijab</button>
                <button class="filter-btn" onclick="filterProducts('inner')">Inner</button>
                <button class="filter-btn" onclick="filterProducts('pashmina')">Pashmina</button>
            </div>

            <div class="bento-grid" id="productsGrid">
                <!-- Products will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section id="cartSection" class="page-section">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2.5rem; color: var(--primary);">Keranjang Belanja</h2>
            <div id="cartItems"></div>
            <div class="cart-total" id="cartTotal">Total: Rp 0</div>
            <div style="text-align: center;">
                <button class="btn" onclick="showSection('checkout')" style="max-width: 300px;">Lanjut ke Checkout</button>
            </div>
        </div>
    </section>

    <!-- Checkout Section -->
    <section id="checkoutSection" class="page-section">
        <div class="checkout-container">
            <div class="checkout-wrapper">
                <!-- Auth Warning for Non-logged Users -->
                <div id="checkoutAuthWarning" class="checkout-auth-warning" style="display: none;">
                    <h3>Silakan Masuk Terlebih Dahulu</h3>
                    <p>Untuk melakukan pemesanan, Anda perlu masuk ke akun terlebih dahulu.</p>
                    <button class="btn" onclick="showSection('auth')">Masuk Sekarang</button>
                </div>

                <!-- Checkout Form -->
                <div id="checkoutForm" style="display: none;">
                    <!-- Cart Summary -->
                    <div class="cart-summary">
                        <h3>Ringkasan Pesanan</h3>
                        <div id="checkoutCartItems"></div>
                    </div>

                    <!-- Customer Information Form -->
                    <div class="checkout-form">
                        <h3>Informasi Pembeli</h3>
                        <form id="orderForm">
                            <label>Nama Lengkap</label>
                            <input type="text" name="nama" id="customerName" required placeholder="Masukkan nama lengkap">

                            <label>Nomor WhatsApp</label>
                            <input type="tel" name="whatsapp" id="customerWhatsapp" required placeholder="08xxxxxxxxxx">

                            <label>Alamat Lengkap</label>
                            <textarea name="alamat" id="customerAddress" required placeholder="Masukkan alamat lengkap untuk pengiriman"></textarea>

                            <div class="form-row">
                                <div>
                                    <label>Metode Pengiriman</label>
                                    <select name="pengiriman" required>
                                        <option value="">-- Pilih Pengiriman --</option>
                                        <option value="JNE">JNE</option>
                                        <option value="J&T">J&T</option>
                                        <option value="SiCepat">SiCepat</option>
                                        <option value="Gosend">Gosend</option>
                                        <option value="Antar Langsung">Antar Langsung (Makassar)</option>
                                        <option value="Ambil Langsung">Ambil Langsung</option>
                                    </select>
                                </div>
                                <div>
                                    <label>Metode Pembayaran</label>
                                    <select name="pembayaran" required>
                                        <option value="">-- Pilih Pembayaran --</option>
                                        <option value="Transfer Bank">Transfer Bank</option>
                                        <option value="COD">COD</option>
                                        <option value="QRIS">QRIS</option>
                                        <option value="E-Wallet">E-Wallet (Dana/OVO/GoPay)</option>
                                    </select>
                                </div>
                            </div>

                            <label>Kode Promo (Opsional)</label>
                            <div class="promo-input">
                                <input type="text" name="promo" id="promoCode" placeholder="Masukkan kode promo" oninput="validatePromoCode()">
                                <span class="promo-status" id="promoStatus"></span>
                            </div>

                            <label>Catatan Tambahan (Opsional)</label>
                            <textarea name="catatan" placeholder="Catatan khusus untuk pesanan Anda"></textarea>

                            <button type="submit" class="whatsapp-btn" id="orderBtn">
                                <span id="orderBtnText">ðŸ“± Pesan via WhatsApp</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section id="profileSection" class="page-section">
        <div class="container">
            <div class="profile-header">
                <img src="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg" alt="Profile" class="profile-avatar" id="profileAvatar">
                <input type="file" class="profile-upload" id="profileUpload" accept="image/*" onchange="uploadProfilePhoto(event)">
                <br>
                <button class="upload-btn" onclick="document.getElementById('profileUpload').click()">Ganti Foto</button>
                <h2 id="profileUsername">Nama Pengguna</h2>
                <p id="profileEmail">email@example.com</p>
            </div>

            <div class="profile-tabs">
                <div class="profile-tab active" onclick="showProfileTab('profile-info')">Informasi Profil</div>
                <div class="profile-tab" onclick="showProfileTab('change-password')">Ganti Password</div>
                <div class="profile-tab" onclick="showProfileTab('address-info')">Alamat & Kontak</div>
            </div>

            <div class="profile-content active" id="profile-info">
                <div class="bento-card">
                    <h3>Edit Profil</h3>
                    <form onsubmit="updateProfile(event)">
                        <div class="form-group">
                            <label>Nama Pengguna</label>
                            <input type="text" id="editUsername" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="editEmail" required>
                        </div>
                        <button type="submit" class="btn">Perbarui Profil</button>
                    </form>
                </div>
            </div>

            <div class="profile-content" id="change-password">
                <div class="bento-card">
                    <h3>Ganti Password</h3>
                    <form onsubmit="changePassword(event)">
                        <div class="form-group">
                            <label>Password Lama</label>
                            <input type="password" id="currentPassword" required>
                            <div class="error" id="currentPasswordError"></div>
                        </div>
                        <div class="form-group">
                            <label>Password Baru</label>
                            <input type="password" id="newPassword" required>
                            <div class="error" id="newPasswordError"></div>
                        </div>
                        <div class="form-group">
                            <label>Konfirmasi Password Baru</label>
                            <input type="password" id="confirmNewPassword" required>
                            <div class="error" id="confirmNewPasswordError"></div>
                        </div>
                        <button type="submit" class="btn" id="changePasswordBtn">
                            <span id="changePasswordBtnText">Perbarui Password</span>
                        </button>
                    </form>
                </div>
            </div>

            <div class="profile-content" id="address-info">
                <div class="bento-card">
                    <h3>Alamat & Kontak</h3>
                    <form onsubmit="updateAddressInfo(event)">
                        <div class="form-group">
                            <label>Nomor Telepon</label>
                            <input type="tel" id="phoneNumber" placeholder="08xxxxxxxxxx">
                            <div class="error" id="phoneNumberError"></div>
                        </div>
                        <div class="form-group">
                            <label>Alamat Lengkap</label>
                            <textarea id="address" placeholder="Masukkan alamat lengkap"></textarea>
                            <div class="error" id="addressError"></div>
                        </div>
                        <div class="form-group">
                            <label>Kota</label>
                            <input type="text" id="city" placeholder="Kota">
                        </div>
                        <div class="form-group">
                            <label>Kode Pos</label>
                            <input type="text" id="postalCode" placeholder="Kode Pos">
                        </div>
                        <button type="submit" class="btn" id="updateAddressBtn">
                            <span id="updateAddressBtnText">Simpan Informasi</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="aboutSection" class="page-section">
        <div class="container">
            <div class="about-header">
                <h2>Tentang FemmeiaCloth</h2>
                <p>Mengenal lebih dekat dengan brand fashion hijab premium kami</p>
            </div>

            <div class="about-content">
                <div>
                    <img src="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg" alt="About FemmeiaCloth" class="about-image">
                </div>
                <div class="about-text">
                    <p>FemmeiaCloth adalah brand fashion hijab premium yang didedikasikan untuk menyediakan produk berkualitas tinggi dengan harga terjangkau. Kami percaya bahwa setiap wanita berhak tampil cantik dan percaya diri dengan hijab yang nyaman dan stylish.</p>
                    
                    <p>Didirikan pada tahun 2020, FemmeiaCloth telah berkembang menjadi salah satu brand hijab terpercaya dengan ribuan pelanggan setia di seluruh Indonesia. Kami berkomitmen untuk terus berinovasi dan menghadirkan produk-produk terbaik untuk Anda.</p>
                    
                    <p>Visi kami adalah menjadi brand hijab terdepan yang menginspirasi wanita untuk tampil cantik dan percaya diri dengan hijab. Misi kami adalah menyediakan produk hijab berkualitas tinggi dengan harga terjangkau, serta memberikan pelayanan terbaik kepada pelanggan.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Detail Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content-product">
            <button class="close-modal" onclick="closeProductModal()">Ã—</button>
            <div class="product-detail" id="productDetail">
                <!-- Product detail will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Audio Element for Tickle Sound -->
    <audio id="tickleSound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3" type="audio/mpeg">
    </audio>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, query, where, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification, sendPasswordResetEmail, updatePassword, EmailAuthProvider, reauthenticateWithCredential, updateProfile } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-storage.js";

        // Firebase config (same as survey)
        const firebaseConfig = {
            apiKey: "AIzaSyAxMT-bM6FEPrD-o3I2G-VHdZP7hxhj0uo",
            authDomain: "femmeiacloth-finance.firebaseapp.com",
            projectId: "femmeiacloth-finance",
            storageBucket: "femmeiacloth-finance.appspot.com",
            messagingSenderId: "517478386163",
            appId: "1:517478386163:web:51028f5841baa311126a86",
            measurementId: "G-K4L516Q54R"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        // Updated products data with new images
        const products = [
            {
                id: 1,
                name: "Inner Earab",
                price: 25000,
                category: "inner",
                image: "https://www.femmeiacloth.me/app/store/assets/ciputall.jpg",
                colors: ["Hitam", "Putih", "Cream", "Mocha", "Abu-abu"],
                colorCodes: {
                    "Hitam": "#000000",
                    "Putih": "#FFFFFF",
                    "Cream": "#FFFDD0",
                    "Mocha": "#A38068",
                    "Abu-abu": "#808080"
                },
                description: "Inner Ninja premium, adem, nyaman dipakai seharian."
            },
            {
                id: 2,
                name: "Pashmina",
                price: 55000,
                category: "pashmina",
                image: "https://www.femmeiacloth.me/app/store/assets/IMG-20250512-WA0017.jpg",
                colors: ["Hitam", "Coklat", "Beige", "Mauve", "Lilac", "Hijau", "Olive"],
                colorCodes: {
                    "Hitam": "#000000",
                    "Coklat": "#964B00",
                    "Beige": "#F5F5DC",
                    "Mauve": "#E0B0FF",
                    "Lilac": "#C8A2C8",
                    "Hijau": "#00FF00",
                    "Olive": "#808000"
                },
                description: "Pashmina bahan kaos premium, nyaman dipakai."
            },
            {
                id: 3,
                name: "Paris Jadul",
                price: 35000,
                category: "hijab",
                image: "https://www.femmeiacloth.me/app/store/assets/all.jpg",
                colors: ["Hitam", "Putih", "Abu-abu", "Navy", "Pink", "Cream"],
                colorCodes: {
                    "Hitam": "#000000",
                    "Putih": "#FFFFFF",
                    "Abu-abu": "#808080",
                    "Navy": "#000080",
                    "Pink": "#FFC0CB",
                    "Cream": "#FFFDD0"
                },
                description: "Hijab ringan, mudah dibentuk, cocok untuk sehari-hari."
            }
        ];

        // Global state
        let currentUser = null;
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentFilter = 'all';
        let selectedProduct = null;
        let selectedColor = null;
        let promoApplied = false;
        let promoDiscount = 0;

        // Make functions globally available
        window.toggleMobileMenu = toggleMobileMenu;
        window.showLogin = showLogin;
        window.showRegister = showRegister;
        window.showForgotPassword = showForgotPassword;
        window.login = login;
        window.register = register;
        window.resetPassword = resetPassword;
        window.logout = logout;
        window.showSection = showSection;
        window.filterProducts = filterProducts;
        window.showProductDetail = showProductDetail;
        window.closeProductModal = closeProductModal;
        window.updateSelectedColor = updateSelectedColor;
        window.selectColor = selectColor;
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;
        window.uploadProfilePhoto = uploadProfilePhoto;
        window.updateProfile = updateProfile;
        window.showProfileTab = showProfileTab;
        window.changePassword = changePassword;
        window.updateAddressInfo = updateAddressInfo;
        window.validatePromoCode = validatePromoCode;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            updateCartBadge();
            
            // Play tickle sound when page loads
            const tickleSound = document.getElementById('tickleSound');
            if (tickleSound) {
                // Add event listener for user interaction to enable audio
                document.addEventListener('click', function() {
                    tickleSound.play().catch(e => console.log("Audio play failed:", e));
                }, { once: true });
            }
        });

        // Auth state management
        onAuthStateChanged(auth, async (user) => {
            if (user && user.emailVerified) {
                currentUser = user;
                showMainApp();
                updateNavLinks();
                loadProfile();
            } else if (user && !user.emailVerified) {
                showNotification('Silakan verifikasi email Anda terlebih dahulu', true);
                signOut(auth);
            } else {
                currentUser = null;
                showAuthSection();
                updateNavLinks();
            }
        });

        function showAuthSection() {
            document.getElementById('authSection').classList.add('active');
            document.querySelectorAll('.page-section:not(#authSection)').forEach(section => {
                section.classList.remove('active');
            });
        }

        function showMainApp() {
            document.getElementById('authSection').classList.remove('active');
            if (!document.querySelector('.page-section.active:not(#authSection)')) {
                showSection('home');
            }
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        // Authentication functions
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            clearAuthErrors();
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            clearAuthErrors();
        }

        function showForgotPassword() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'block';
            clearAuthErrors();
        }

        function clearAuthErrors() {
            document.querySelectorAll('.error').forEach(error => error.textContent = '');
        }

        function showAuthError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            if (errorElement) errorElement.textContent = message;
        }

        async function login(event) {
            event.preventDefault();
            clearAuthErrors();

            const emailOrUsername = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!emailOrUsername || !password) {
                showAuthError('loginEmail', 'Email/username dan password wajib diisi');
                return;
            }

            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            
            loginBtn.disabled = true;
            loginBtnText.innerHTML = '<div class="loading"></div>Memproses...';

            try {
                // Check if input is email or username
                const isEmail = emailOrUsername.includes('@');
                
                if (isEmail) {
                    // Login with email directly
                    await signInWithEmailAndPassword(auth, emailOrUsername, password);
                } else {
                    // Find user by username in Firestore
                    const usersRef = collection(db, "users");
                    const q = query(usersRef, where("username", "==", emailOrUsername));
                    const querySnapshot = await getDocs(q);
                    
                    if (querySnapshot.empty) {
                        throw { code: 'auth/user-not-found' };
                    }
                    
                    // Get the email from the found user document
                    const userEmail = querySnapshot.docs[0].data().email;
                    
                    // Login with the found email
                    await signInWithEmailAndPassword(auth, userEmail, password);
                }
                
                showNotification('Berhasil masuk! Selamat datang kembali.');
            } catch (error) {
                console.error('Login error:', error);
                
                let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
                let errorField = 'loginEmail';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Email/username tidak terdaftar. Silakan daftar terlebih dahulu.';
                        break;
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential':
                        errorMessage = 'Password salah. Silakan periksa kembali password Anda.';
                        errorField = 'loginPassword';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Format email tidak valid.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Terlalu banyak percobaan. Coba lagi dalam beberapa menit.';
                        break;
                }
                
                showAuthError(errorField, errorMessage);
            } finally {
                loginBtn.disabled = false;
                loginBtnText.textContent = 'Masuk';
            }
        }

        async function register(event) {
            event.preventDefault();
            clearAuthErrors();

            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;

            // Validation
            if (!username) {
                showAuthError('registerUsername', 'Nama pengguna wajib diisi');
                return;
            }

            if (!email) {
                showAuthError('registerEmail', 'Email wajib diisi');
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showAuthError('registerEmail', 'Format email tidak valid');
                return;
            }

            if (!password) {
                showAuthError('registerPassword', 'Password wajib diisi');
                return;
            }

            if (password.length < 6) {
                showAuthError('registerPassword', 'Password minimal 6 karakter');
                return;
            }

            const registerBtn = document.getElementById('registerBtn');
            const registerBtnText = document.getElementById('registerBtnText');
            
            registerBtn.disabled = true;
            registerBtnText.innerHTML = '<div class="loading"></div>Memproses...';

            try {
                // Check if username already exists
                const usersRef = collection(db, "users");
                const usernameQuery = query(usersRef, where("username", "==", username));
                const usernameSnapshot = await getDocs(usernameQuery);
                
                if (!usernameSnapshot.empty) {
                    showAuthError('registerUsername', 'Username sudah digunakan. Silakan pilih username lain.');
                    registerBtn.disabled = false;
                    registerBtnText.textContent = 'Daftar';
                    return;
                }
                
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Save user profile to Firestore
                await setDoc(doc(db, 'users', userCredential.user.uid), {
                    uid: userCredential.user.uid,
                    username: username,
                    email: email,
                    createdAt: new Date()
                });

                // Send email verification
                await sendEmailVerification(userCredential.user);
                
                showNotification('Akun berhasil dibuat! Silakan periksa email untuk verifikasi.');
                
                // Sign out until email is verified
                await signOut(auth);
                
                showLogin();
            } catch (error) {
                console.error('Register error:', error);
                
                let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
                let errorField = 'registerEmail';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Email sudah terdaftar. Silakan gunakan email lain atau login.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password terlalu lemah. Gunakan minimal 6 karakter.';
                        errorField = 'registerPassword';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Format email tidak valid.';
                        break;
                }
                
                showAuthError(errorField, errorMessage);
            } finally {
                registerBtn.disabled = false;
                registerBtnText.textContent = 'Daftar';
            }
        }

        async function resetPassword(event) {
            event.preventDefault();
            clearAuthErrors();

            const email = document.getElementById('resetEmail').value.trim();

            if (!email) {
                showAuthError('resetEmail', 'Email wajib diisi');
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showAuthError('resetEmail', 'Format email tidak valid');
                return;
            }

            const resetBtn = document.getElementById('resetBtn');
            const resetBtnText = document.getElementById('resetBtnText');
            
            resetBtn.disabled = true;
            resetBtnText.innerHTML = '<div class="loading"></div>Memproses...';

            try {
                await sendPasswordResetEmail(auth, email);
                showNotification('Link reset password telah dikirim ke email Anda');
                showLogin();
            } catch (error) {
                console.error('Reset password error:', error);
                
                let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Email tidak terdaftar.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Format email tidak valid.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Terlalu banyak percobaan. Coba lagi dalam beberapa menit.';
                        break;
                }
                
                showAuthError('resetEmail', errorMessage);
            } finally {
                resetBtn.disabled = false;
                resetBtnText.textContent = 'Kirim Link Reset';
            }
        }

        function logout() {
            signOut(auth).then(() => {
                cart = [];
                localStorage.removeItem('cart');
                updateCartBadge();
                showNotification('Anda telah keluar dari akun');
            });
        }

        // Update navigation links based on authentication state
        function updateNavLinks() {
            const navLinks = document.getElementById('navLinks');
            
            if (currentUser) {
                // User is logged in
                navLinks.innerHTML = `
                    <li><a href="#" onclick="showSection('home')">Beranda</a></li>
                    <li><a href="#" onclick="showSection('products')">Produk</a></li>
                    <li><a href="#" onclick="showSection('about')">Tentang</a></li>
                    <li><a href="#" onclick="showSection('cart')">Keranjang <span class="cart-badge" id="cartBadge">0</span></a></li>
                    <li><a href="#" onclick="showSection('profile')">Profil</a></li>
                    <li><a href="#" onclick="logout()">Keluar</a></li>
                `;
            } else {
                // User is not logged in
                navLinks.innerHTML = `
                    <li><a href="#" onclick="showSection('home')">Beranda</a></li>
                    <li><a href="#" onclick="showSection('products')">Produk</a></li>
                    <li><a href="#" onclick="showSection('about')">Tentang</a></li>
                    <li><a href="#" onclick="showSection('cart')">Keranjang <span class="cart-badge" id="cartBadge">0</span></a></li>
                    <li><a href="#" onclick="showSection('auth')">Masuk</a></li>
                `;
            }
            
            updateCartBadge();
        }

        // Navigation
        function showSection(sectionName) {
            // Check if user is trying to access profile or checkout without being logged in
            if ((sectionName === 'profile' || sectionName === 'checkout') && !currentUser) {
                showSection('auth');
                showNotification('Silakan masuk terlebih dahulu', true);
                return;
            }
            
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName + 'Section').classList.add('active');

            // Close mobile menu when navigating
            document.getElementById('navLinks').classList.remove('active');

            if (sectionName === 'cart') {
                loadCart();
            } else if (sectionName === 'checkout') {
                loadCheckout();
            }
        }

        // Products
        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            const filteredProducts = currentFilter === 'all' 
                ? products 
                : products.filter(p => p.category === currentFilter);

            grid.innerHTML = filteredProducts.map((product, index) => `
                <div class="product-card fade-in" 
                     onclick="showProductDetail(${product.id})"
                     style="animation-delay: ${index * 0.1}s">
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">Rp ${formatPrice(product.price)}</div>
                        <div class="product-colors">
                            ${product.colors.map(color => `
                                <div class="color-option" 
                                    style="background-color: ${product.colorCodes[color]}" 
                                    title="${color}">
                                </div>
                            `).join('')}
                        </div>
                        <p style="color: #94a3b8; font-size: 0.9rem;">${product.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function filterProducts(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadProducts();
        }

        // Format price with thousand separator
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Product Detail Modal
        function showProductDetail(productId) {
            selectedProduct = products.find(p => p.id === productId);
            selectedColor = selectedProduct.colors[0];
            
            const modal = document.getElementById('productModal');
            const productDetail = document.getElementById('productDetail');
            
            productDetail.innerHTML = `
                <div>
                    <img src="${selectedProduct.image}" alt="${selectedProduct.name}" class="product-detail-image">
                </div>
                <div class="product-detail-info">
                    <h2>${selectedProduct.name}</h2>
                    <div class="product-detail-price">Rp ${formatPrice(selectedProduct.price)}</div>
                    <p>${selectedProduct.description}</p>
                    <div class="color-select">
                        <label>Pilih Warna:</label>
                        <div class="color-options">
                            ${selectedProduct.colors.map(color => `
                                <div class="color-option ${color === selectedColor ? 'selected' : ''}" 
                                    style="background-color: ${selectedProduct.colorCodes[color]}" 
                                    title="${color}"
                                    onclick="selectColor('${color}')">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <button class="btn" onclick="addToCart(${selectedProduct.id})">
                        Tambahkan ke Keranjang
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function updateSelectedColor() {
            selectedColor = document.getElementById('colorSelect').value;
        }

        function selectColor(color) {
            selectedColor = color;
            
            // Update UI to show selected color
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
                if (option.title === color) {
                    option.classList.add('selected');
                }
            });
        }

        // Cart functions
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const color = selectedColor || product.colors[0];
            
            const existingItemIndex = cart.findIndex(item => 
                item.id === productId && item.selectedColor === color
            );

            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({ 
                    ...product, 
                    quantity: 1,
                    selectedColor: color
                });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            
            // Show feedback
            showNotification(`${product.name} (${color}) ditambahkan ke keranjang!`);
            
            // Close modal if open
            closeProductModal();
        }

        function updateCartBadge() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartBadge = document.getElementById('cartBadge');
            const stickyCartBadge = document.getElementById('stickyCartBadge');
            
            if (cartBadge) {
                cartBadge.textContent = totalItems;
            }
            
            if (stickyCartBadge) {
                stickyCartBadge.textContent = totalItems;
            }
        }

        function loadCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');

            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: #94a3b8;">Keranjang belanja Anda kosong</p>';
                cartTotal.textContent = 'Total: Rp 0';
                return;
            }

            cartItems.innerHTML = cart.map((item, index) => `
                <div class="cart-item fade-in" style="animation-delay: ${index * 0.1}s">
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <p>Rp ${formatPrice(item.price)}</p>
                        <p>Warna: ${item.selectedColor}</p>
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateQuantity(${item.id}, '${item.selectedColor}', -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity(${item.id}, '${item.selectedColor}', 1)">+</button>
                    </div>
                    <button class="quantity-btn" onclick="removeFromCart(${item.id}, '${item.selectedColor}')" style="background: #e74c3c;">Ã—</button>
                </div>
            `).join('');

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartTotal.textContent = `Total: Rp ${formatPrice(total)}`;
        }

        function updateQuantity(productId, color, change) {
            const itemIndex = cart.findIndex(item => item.id === productId && item.selectedColor === color);
            
            if (itemIndex !== -1) {
                cart[itemIndex].quantity += change;
                if (cart[itemIndex].quantity <= 0) {
                    removeFromCart(productId, color);
                } else {
                    localStorage.setItem('cart', JSON.stringify(cart));
                    loadCart();
                    updateCartBadge();
                }
            }
        }

        function removeFromCart(productId, color) {
            const itemToRemove = cart.find(item => item.id === productId && item.selectedColor === color);
            const itemName = itemToRemove ? `${itemToRemove.name} (${itemToRemove.selectedColor})` : '';
            
            cart = cart.filter(item => !(item.id === productId && item.selectedColor === color));
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            updateCartBadge();
            
            showNotification(`${itemName} dihapus dari keranjang`);
        }

        // Checkout functions
        function loadCheckout() {
            const authWarning = document.getElementById('checkoutAuthWarning');
            const checkoutForm = document.getElementById('checkoutForm');
            
            if (!currentUser) {
                authWarning.style.display = 'block';
                checkoutForm.style.display = 'none';
            } else {
                authWarning.style.display = 'none';
                checkoutForm.style.display = 'block';
                
                // Reset promo status
                promoApplied = false;
                promoDiscount = 0;
                document.getElementById('promoStatus').textContent = '';
                document.getElementById('promoStatus').className = 'promo-status';
                
                // Load cart summary
                loadCheckoutCartSummary();
                
                // Pre-fill user data if available
                if (currentUser) {
                    getUserProfile().then(profile => {
                        if (profile) {
                            const nameInput = document.getElementById('customerName');
                            const whatsappInput = document.getElementById('customerWhatsapp');
                            const addressInput = document.getElementById('customerAddress');
                            
                            if (nameInput && !nameInput.value && profile.username) {
                                nameInput.value = profile.username;
                            }
                            
                            if (whatsappInput && !whatsappInput.value && profile.phoneNumber) {
                                whatsappInput.value = profile.phoneNumber;
                            }
                            
                            if (addressInput && !addressInput.value && profile.address) {
                                addressInput.value = profile.address;
                            }
                        }
                    });
                }
            }
        }

        async function getUserProfile() {
            if (!currentUser) return null;
            
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                
                if (userDoc.exists()) {
                    return userDoc.data();
                }
                
                // If no document exists, try to find by query (for backward compatibility)
                const q = query(collection(db, 'users'), where('uid', '==', currentUser.uid));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    return querySnapshot.docs[0].data();
                }
            } catch (error) {
                console.error('Error getting user profile:', error);
            }
            
            return null;
        }

        function loadCheckoutCartSummary() {
            const checkoutCartItems = document.getElementById('checkoutCartItems');
            
            if (cart.length === 0) {
                checkoutCartItems.innerHTML = '<p style="color: var(--text-muted);">Keranjang kosong</p>';
                return;
            }

            let subtotal = 0;
            let summaryHTML = '';

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                summaryHTML += `
                    <div class="cart-summary-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>Warna: ${item.selectedColor} | Qty: ${item.quantity}</small>
                        </div>
                        <div>Rp ${formatPrice(itemTotal)}</div>
                    </div>
                `;
            });

            // Add promo discount if applied
            if (promoApplied) {
                promoDiscount = Math.round(subtotal * 0.1); // 10% discount
                
                summaryHTML += `
                    <div class="cart-summary-item">
                        <div>Subtotal</div>
                        <div>Rp ${formatPrice(subtotal)}</div>
                    </div>
                    <div class="cart-summary-item">
                        <div>Diskon (10%)</div>
                        <div>- Rp ${formatPrice(promoDiscount)}</div>
                    </div>
                `;
            }

            const total = subtotal - promoDiscount;
            
            summaryHTML += `
                <div class="cart-summary-item">
                    <div><strong>Total</strong></div>
                    <div><strong>Rp ${formatPrice(total)}</strong></div>
                </div>
            `;

            checkoutCartItems.innerHTML = summaryHTML;
        }

        function validatePromoCode() {
            const promoCode = document.getElementById('promoCode').value.trim().toUpperCase();
            const promoStatus = document.getElementById('promoStatus');
            
            if (promoCode === 'FEMMEIA10') {
                promoStatus.textContent = 'âœ“ Promo valid';
                promoStatus.className = 'promo-status valid';
                promoApplied = true;
                loadCheckoutCartSummary();
            } else if (promoCode === '') {
                promoStatus.textContent = '';
                promoStatus.className = 'promo-status';
                promoApplied = false;
                loadCheckoutCartSummary();
            } else {
                promoStatus.textContent = 'âœ— Kode tidak valid';
                promoStatus.className = 'promo-status invalid';
                promoApplied = false;
                loadCheckoutCartSummary();
            }
        }

        // Order form submission
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('Silakan masuk terlebih dahulu', true);
                return;
            }

            if (cart.length === 0) {
                showNotification('Keranjang belanja kosong', true);
                return;
            }

            const orderBtn = document.getElementById('orderBtn');
            const orderBtnText = document.getElementById('orderBtnText');
            
            orderBtn.disabled = true;
            orderBtnText.innerHTML = '<div class="loading"></div>Memproses...';

            try {
                const formData = new FormData(this);
                
                // Validate WhatsApp number
                const whatsapp = formData.get('whatsapp').trim();
                if (!/^[0-9]{10,15}$/.test(whatsapp)) {
                    showNotification('Nomor WhatsApp tidak valid', true);
                    orderBtn.disabled = false;
                    orderBtnText.textContent = 'ðŸ“± Pesan via WhatsApp';
                    return;
                }

                // Calculate total
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const discount = promoApplied ? Math.round(subtotal * 0.1) : 0;
                const total = subtotal - discount;

                // Create order data
                const orderData = {
                    userId: currentUser.uid,
                    customerName: formData.get('nama'),
                    whatsapp: whatsapp,
                    address: formData.get('alamat'),
                    shipping: formData.get('pengiriman'),
                    payment: formData.get('pembayaran'),
                    promoCode: formData.get('promo') || '',
                    promoApplied: promoApplied,
                    discount: discount,
                    notes: formData.get('catatan') || '',
                    items: cart,
                    subtotal: subtotal,
                    total: total,
                    createdAt: new Date(),
                    status: 'pending'
                };

                // Save order to Firebase
                await addDoc(collection(db, 'orders'), orderData);

                // Save address info to user profile
                try {
                    const userRef = doc(db, 'users', currentUser.uid);
                    await updateDoc(userRef, {
                        phoneNumber: whatsapp,
                        address: formData.get('alamat'),
                        updatedAt: new Date()
                    });
                } catch (error) {
                    console.error('Error updating user profile:', error);
                }

                // Generate WhatsApp message
                let message = `*Pesanan Baru - FemmeiaCloth*\n\n`;
                message += `ðŸ‘¤ *Nama:* ${orderData.customerName}\n`;
                message += `ðŸ“± *WhatsApp:* ${orderData.whatsapp}\n`;
                message += `ðŸ“ *Alamat:* ${orderData.address}\n\n`;
                
                message += `ðŸ›ï¸ *Detail Pesanan:*\n`;
                cart.forEach((item, index) => {
                    message += `${index + 1}. ${item.name}\n`;
                    message += `   Warna: ${item.selectedColor}\n`;
                    message += `   Qty: ${item.quantity}\n`;
                    message += `   Harga: Rp ${formatPrice(item.price * item.quantity)}\n\n`;
                });
                
                message += `ðŸ’° *Subtotal: Rp ${formatPrice(subtotal)}*\n`;
                
                if (promoApplied) {
                    message += `ðŸ·ï¸ *Kode Promo:* ${formData.get('promo')}\n`;
                    message += `ðŸ’¸ *Diskon (10%): - Rp ${formatPrice(discount)}*\n`;
                }
                
                message += `ðŸ’° *Total: Rp ${formatPrice(total)}*\n\n`;
                message += `ðŸšš *Pengiriman:* ${orderData.shipping}\n`;
                message += `ðŸ’³ *Pembayaran:* ${orderData.payment}\n`;
                
                if (orderData.notes) {
                    message += `ðŸ“ *Catatan:* ${orderData.notes}\n`;
                }

                // Open WhatsApp
                const whatsappNumber = "6285341899229";
                const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
                window.open(whatsappURL, '_blank');

                // Clear cart and show success
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartBadge();
                
                showNotification('Pesanan berhasil dikirim ke WhatsApp!');
                
                // Reset form and redirect to home
                this.reset();
                setTimeout(() => {
                    showSection('home');
                }, 2000);

            } catch (error) {
                console.error('Order submission error:', error);
                showNotification('Terjadi kesalahan saat memproses pesanan', true);
            } finally {
                orderBtn.disabled = false;
                orderBtnText.textContent = 'ðŸ“± Pesan via WhatsApp';
            }
        });

        // Profile functions
        function loadProfile() {
            if (currentUser) {
                document.getElementById('profileEmail').textContent = currentUser.email;
                document.getElementById('editEmail').value = currentUser.email;
                
                // Load additional profile data from Firestore
                getUserProfile().then(profile => {
                    if (profile) {
                        document.getElementById('profileUsername').textContent = profile.username || 'Pengguna';
                        document.getElementById('editUsername').value = profile.username || '';
                        
                        if (profile.avatar) {
                            document.getElementById('profileAvatar').src = profile.avatar;
                        }
                        
                        // Load address info
                        if (profile.phoneNumber) {
                            document.getElementById('phoneNumber').value = profile.phoneNumber;
                        }
                        
                        if (profile.address) {
                            document.getElementById('address').value = profile.address;
                        }
                        
                        if (profile.city) {
                            document.getElementById('city').value = profile.city;
                        }
                        
                        if (profile.postalCode) {
                            document.getElementById('postalCode').value = profile.postalCode;
                        }
                    }
                });
            }
        }

        function showProfileTab(tabId) {
            document.querySelectorAll('.profile-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.profile-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.profile-tab[onclick="showProfileTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        async function uploadProfilePhoto(event) {
            if (!currentUser) {
                showNotification('Silakan masuk terlebih dahulu', true);
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                // Show loading notification
                showNotification('Mengunggah foto profil...');
                
                // Upload to Firebase Storage
                const storageRef = ref(storage, `profile_photos/${currentUser.uid}`);
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                // Update profile photo in UI
                document.getElementById('profileAvatar').src = downloadURL;
                
                // Update user profile in Firestore
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    avatar: downloadURL,
                    updatedAt: new Date()
                });
                
                showNotification('Foto profil berhasil diperbarui');
            } catch (error) {
                console.error('Error uploading profile photo:', error);
                showNotification('Gagal mengunggah foto profil', true);
            }
        }

        async function updateProfile(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showNotification('Silakan masuk terlebih dahulu', true);
                return;
            }
            
            const username = document.getElementById('editUsername').value.trim();
            
            if (!username) {
                showNotification('Nama pengguna wajib diisi', true);
                return;
            }

            try {
                // Update profile in Firestore
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    username: username,
                    updatedAt: new Date()
                });
                
                // Update UI
                document.getElementById('profileUsername').textContent = username;
                
                showNotification('Profil berhasil diperbarui!');
            } catch (error) {
                console.error('Profile update error:', error);
                showNotification('Gagal memperbarui profil', true);
            }
        }

        async function changePassword(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showNotification('Silakan masuk terlebih dahulu', true);
                return;
            }
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            // Clear previous errors
            document.getElementById('currentPasswordError').textContent = '';
            document.getElementById('newPasswordError').textContent = '';
            document.getElementById('confirmNewPasswordError').textContent = '';
            
            // Validation
            if (!currentPassword) {
                document.getElementById('currentPasswordError').textContent = 'Password lama wajib diisi';
                return;
            }
            
            if (!newPassword) {
                document.getElementById('newPasswordError').textContent = 'Password baru wajib diisi';
                return;
            }
            
            if (newPassword.length < 6) {
                document.getElementById('newPasswordError').textContent = 'Password minimal 6 karakter';
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                document.getElementById('confirmNewPasswordError').textContent = 'Password tidak cocok';
                return;
            }
            
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            const changePasswordBtnText = document.getElementById('changePasswordBtnText');
            
            changePasswordBtn.disabled = true;
            changePasswordBtnText.innerHTML = '<div class="loading"></div>Memproses...';
            
            try {
                // Re-authenticate user
                const credential = EmailAuthProvider.credential(currentUser.email, currentPassword);
                await reauthenticateWithCredential(currentUser, credential);
                
                // Update password
                await updatePassword(currentUser, newPassword);
                
                // Clear form
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmNewPassword').value = '';
                
                showNotification('Password berhasil diperbarui!');
            } catch (error) {
                console.error('Change password error:', error);
                
                if (error.code === 'auth/wrong-password') {
                    document.getElementById('currentPasswordError').textContent = 'Password lama salah';
                } else {
                    showNotification('Gagal memperbarui password', true);
                }
            } finally {
                changePasswordBtn.disabled = false;
                changePasswordBtnText.textContent = 'Perbarui Password';
            }
        }

        async function updateAddressInfo(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showNotification('Silakan masuk terlebih dahulu', true);
                return;
            }
            
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const postalCode = document.getElementById('postalCode').value.trim();
            
            // Clear previous errors
            document.getElementById('phoneNumberError').textContent = '';
            document.getElementById('addressError').textContent = '';
            
            // Validation
            if (phoneNumber && !/^[0-9]{10,15}$/.test(phoneNumber)) {
                document.getElementById('phoneNumberError').textContent = 'Format nomor telepon tidak valid';
                return;
            }
            
            const updateAddressBtn = document.getElementById('updateAddressBtn');
            const updateAddressBtnText = document.getElementById('updateAddressBtnText');
            
            updateAddressBtn.disabled = true;
            updateAddressBtnText.innerHTML = '<div class="loading"></div>Memproses...';
            
            try {
                // Update address info in Firestore
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    phoneNumber: phoneNumber,
                    address: address,
                    city: city,
                    postalCode: postalCode,
                    updatedAt: new Date()
                });
                
                showNotification('Informasi alamat berhasil diperbarui!');
            } catch (error) {
                console.error('Update address info error:', error);
                showNotification('Gagal memperbarui informasi alamat', true);
            } finally {
                updateAddressBtn.disabled = false;
                updateAddressBtnText.textContent = 'Simpan Informasi';
            }
        }

        // Notification system
        function showNotification(message, isError = false) {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            if (isError) {
                notification.style.background = '#e74c3c';
            }
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target == modal) {
                closeProductModal();
            }
        }
    </script>
</body>
</html>
