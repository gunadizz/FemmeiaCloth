<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FemmeiaCloth - Hijab & Aksesoris Fashion Premium</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      :root {
          --primary: #ff6b9d;
          --primary-dark: #c44569;
          --background: #0f0f23;
          --background-light: #1a1a2e;
          --background-lighter: #16213e;
          --text: #e2e8f0;
          --text-muted: #94a3b8;
          --border: rgba(255, 255, 255, 0.1);
          --blur-strength: 20px;
          --transition-speed: 0.3s;
          --success: #10b981;
          --error: #ef4444;
          --warning: #f59e0b;
      }

      body {
          font-family: 'Quicksand', sans-serif;
          background: linear-gradient(135deg, var(--background) 0%, var(--background-light) 50%, var(--background-lighter) 100%);
          color: var(--text);
          min-height: 100vh;
          overflow-x: hidden;
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 20px;
      }

      /* Navigation */
      .navbar {
          background: rgba(15, 15, 35, 0.95);
          backdrop-filter: blur(var(--blur-strength));
          -webkit-backdrop-filter: blur(var(--blur-strength));
          border-bottom: 1px solid var(--border);
          position: fixed;
          top: 0;
          width: 100%;
          z-index: 1000;
          padding: 1rem 0;
          transition: all var(--transition-speed) ease;
      }

      .navbar:hover {
          background: rgba(15, 15, 35, 0.98);
      }

      .nav-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .logo {
          font-size: 1.8rem;
          font-weight: 700;
          background: linear-gradient(45deg, var(--primary), var(--primary-dark));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          transition: transform var(--transition-speed) ease;
      }

      .logo:hover {
          transform: scale(1.05);
      }

      .nav-links {
          display: flex;
          gap: 2rem;
          list-style: none;
          align-items: center;
      }

      .nav-links a {
          color: var(--text);
          text-decoration: none;
          font-weight: 500;
          transition: all var(--transition-speed) ease;
          padding: 0.5rem 1rem;
          border-radius: 8px;
          position: relative;
          overflow: hidden;
          white-space: nowrap;
      }

      .nav-links a:before {
          content: '';
          position: absolute;
          bottom: 0;
          left: 50%;
          width: 0;
          height: 2px;
          background: var(--primary);
          transition: all var(--transition-speed) ease;
          transform: translateX(-50%);
      }

      .nav-links a:hover:before {
          width: 80%;
      }

      .nav-links a:hover {
          background: rgba(255, 107, 157, 0.1);
          color: var(--primary);
          transform: translateY(-2px);
      }

      .cart-badge {
          background: var(--primary);
          color: white;
          border-radius: 50%;
          padding: 0.2rem 0.5rem;
          font-size: 0.8rem;
          margin-left: 0.5rem;
          transition: all var(--transition-speed) ease;
          min-width: 20px;
          text-align: center;
      }

      .mobile-menu-btn {
          display: none;
          background: none;
          border: none;
          color: var(--text);
          font-size: 1.5rem;
          cursor: pointer;
          transition: all var(--transition-speed) ease;
          padding: 0.5rem;
      }

      .mobile-menu-btn:hover {
          color: var(--primary);
          transform: rotate(90deg);
      }

      /* Sticky Cart Button */
      .sticky-cart {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: linear-gradient(45deg, var(--primary), var(--primary-dark));
          color: white;
          border: none;
          border-radius: 50%;
          width: 60px;
          height: 60px;
          font-size: 1.5rem;
          cursor: pointer;
          box-shadow: 0 10px 25px rgba(255, 107, 157, 0.3);
          transition: all var(--transition-speed) ease;
          z-index: 999;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .sticky-cart:hover {
          transform: scale(1.1) translateY(-2px);
          box-shadow: 0 15px 35px rgba(255, 107, 157, 0.4);
      }

      .sticky-cart .cart-count {
          position: absolute;
          top: -5px;
          right: -5px;
          background: var(--error);
          color: white;
          border-radius: 50%;
          width: 25px;
          height: 25px;
          font-size: 0.8rem;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
      }

      /* Promo Card */
      .promo-card {
          background: linear-gradient(135deg, var(--primary), var(--primary-dark));
          color: white;
          padding: 1.5rem;
          border-radius: 20px;
          text-align: center;
          margin-bottom: 2rem;
          position: relative;
          overflow: hidden;
          box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
      }

      .promo-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
          animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
      }

      .promo-code {
          background: rgba(255, 255, 255, 0.2);
          padding: 0.5rem 1rem;
          border-radius: 8px;
          font-weight: bold;
          display: inline-block;
          margin-top: 0.5rem;
          letter-spacing: 2px;
      }

      /* Page Sections */
      .page-section {
          display: none;
          padding-top: 100px;
          min-height: 100vh;
          animation: fadeIn 0.6s ease-out;
      }

      .page-section.active {
          display: block;
      }

      /* Auth Forms */
      .auth-container {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          padding: 2rem;
          background: radial-gradient(circle at center, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
      }

      .auth-card {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(var(--blur-strength));
          -webkit-backdrop-filter: blur(var(--blur-strength));
          border: 1px solid var(--border);
          border-radius: 20px;
          padding: 3rem;
          width: 100%;
          max-width: 400px;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
          transition: all var(--transition-speed) ease;
          position: relative;
          overflow: hidden;
      }

      .auth-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
          border-color: rgba(255, 107, 157, 0.3);
      }

      .auth-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 2px;
          background: linear-gradient(90deg, transparent, var(--primary), transparent);
      }

      .auth-title {
          text-align: center;
          font-size: 2rem;
          font-weight: 600;
          margin-bottom: 2rem;
          background: linear-gradient(45deg, var(--primary), var(--primary-dark));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: pulse 2s infinite;
      }

      .form-group {
          margin-bottom: 1.5rem;
          position: relative;
      }

      .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: #cbd5e1;
          transition: all var(--transition-speed) ease;
      }

      .form-group input, .form-group textarea, .form-group select {
          width: 100%;
          padding: 1rem;
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid var(--border);
          border-radius: 12px;
          color: var(--text);
          font-family: 'Quicksand', sans-serif;
          transition: all var(--transition-speed) ease;
      }

      .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
          background: rgba(255, 255, 255, 0.08);
      }

      .form-group input:focus + label {
          color: var(--primary);
      }

      .btn {
          width: 100%;
          padding: 1rem;
          background: linear-gradient(45deg, var(--primary), var(--primary-dark));
          border: none;
          border-radius: 12px;
          color: white;
          font-family: 'Quicksand', sans-serif;
          font-weight: 600;
          font-size: 1rem;
          cursor: pointer;
          transition: all var(--transition-speed) ease;
          margin-bottom: 1rem;
          position: relative;
          overflow: hidden;
      }

      .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 20px rgba(255, 107, 157, 0.3);
      }

      .btn:active {
          transform: translateY(0);
      }

      .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
      }

      .auth-switch {
          text-align: center;
          color: var(--text-muted);
          margin-top: 1rem;
      }

      .auth-switch a {
          color: var(--primary);
          text-decoration: none;
          font-weight: 500;
          transition: all var(--transition-speed) ease;
          position: relative;
      }

      .forgot-password {
          text-align: center;
          margin-top: 1rem;
      }

      .forgot-password a {
          color: var(--primary);
          text-decoration: none;
          font-size: 0.9rem;
          transition: all var(--transition-speed) ease;
      }

      .forgot-password a:hover {
          text-decoration: underline;
      }

      .error {
          color: var(--error);
          font-size: 0.8rem;
          margin-top: 0.25rem;
      }

      .success {
          color: var(--success);
          font-size: 0.8rem;
          margin-top: 0.25rem;
      }

      /* Bento Grid Layout */
      .bento-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 2rem;
          padding: 2rem 0;
      }

      .bento-card {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(var(--blur-strength));
          -webkit-backdrop-filter: blur(var(--blur-strength));
          border: 1px solid var(--border);
          border-radius: 20px;
          padding: 2rem;
          transition: all var(--transition-speed) ease;
          position: relative;
          overflow: hidden;
      }

      .bento-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
          border-color: rgba(255, 107, 157, 0.3);
      }

      .bento-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 1px;
          background: linear-gradient(90deg, transparent, var(--primary), transparent);
      }

      .bento-card h3 {
          margin-bottom: 1rem;
          color: var(--primary);
          position: relative;
          display: inline-block;
      }

      .bento-card h3::after {
          content: '';
          position: absolute;
          width: 30%;
          height: 2px;
          bottom: -5px;
          left: 0;
          background-color: var(--primary);
          transition: width var(--transition-speed) ease;
      }

      .bento-card:hover h3::after {
          width: 50%;
      }

      /* Product Cards */
      .product-card {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(var(--blur-strength));
          -webkit-backdrop-filter: blur(var(--blur-strength));
          border: 1px solid var(--border);
          border-radius: 20px;
          overflow: hidden;
          transition: all var(--transition-speed) ease;
          cursor: pointer;
          position: relative;
      }

      .product-card:hover {
          transform: translateY(-5px) scale(1.02);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
          border-color: rgba(255, 107, 157, 0.3);
      }

      .product-image {
          width: 100%;
          height: 250px;
          object-fit: cover;
          transition: all var(--transition-speed) ease;
      }

      .product-card:hover .product-image {
          transform: scale(1.05);
      }

      .product-info {
          padding: 1.5rem;
          position: relative;
          z-index: 1;
      }

      .product-name {
          font-size: 1.2rem;
          font-weight: 600;
          margin-bottom: 0.5rem;
          color: #f1f5f9;
          transition: all var(--transition-speed) ease;
      }

      .product-card:hover .product-name {
          color: var(--primary);
      }

      .product-price {
          font-size: 1.4rem;
          font-weight: 700;
          color: var(--primary);
          margin-bottom: 1rem;
          transition: all var(--transition-speed) ease;
      }

      .product-card:hover .product-price {
          transform: scale(1.05);
      }

      .product-colors {
          display: flex;
          gap: 0.5rem;
          margin-bottom: 1rem;
          flex-wrap: wrap;
      }

      .color-option {
          width: 25px;
          height: 25px;
          border-radius: 50%;
          border: 2px solid rgba(255, 255, 255, 0.3);
          cursor: pointer;
          transition: all var(--transition-speed) ease;
          position: relative;
      }

      .color-option:hover {
          transform: scale(1.2);
          border-color: var(--primary);
      }

      .color-option.selected {
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.3);
      }

      /* Cart */
      .cart-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: rgba(255, 255, 255, 0.05);
          border-radius: 12px;
          margin-bottom: 1rem;
          transition: all var(--transition-speed) ease;
          border: 1px solid var(--border);
      }

      .cart-item:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
          border-color: rgba(255, 107, 157, 0.2);
      }

      .cart-item-image {
          width: 80px;
          height: 80px;
          object-fit: cover;
          border-radius: 8px;
          transition: all var(--transition-speed) ease;
      }

      .cart-item:hover .cart-item-image {
          transform: scale(1.05);
      }

      .cart-item-info {
          flex: 1;
      }

      .quantity-controls {
          display: flex;
          align-items: center;
          gap: 1rem;
      }

      .quantity-btn {
          background: var(--primary);
          border: none;
          color: white;
          width: 30px;
          height: 30px;
          border-radius: 50%;
          cursor: pointer;
          font-weight: bold;
          transition: all var(--transition-speed) ease;
      }

      .quantity-btn:hover {
          transform: scale(1.1);
          box-shadow: 0 5px 10px rgba(255, 107, 157, 0.3);
      }

      .cart-total {
          text-align: center;
          font-size: 1.5rem;
          font-weight: 700;
          color: var(--primary);
          margin: 2rem 0;
          text-shadow: 0 2px 10px rgba(255, 107, 157, 0.3);
          animation: pulse 2s infinite;
      }

      /* Filters */
      .filters {
          display: flex;
          gap: 1rem;
          margin-bottom: 2rem;
          flex-wrap: wrap;
          justify-content: center;
      }

      .filter-btn {
          padding: 0.5rem 1rem;
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid var(--border);
          border-radius: 20px;
          color: var(--text);
          cursor: pointer;
          transition: all var(--transition-speed) ease;
          position: relative;
          overflow: hidden;
      }

      .filter-btn::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: linear-gradient(45deg, var(--primary), var(--primary-dark));
          opacity: 0;
          transition: opacity var(--transition-speed) ease;
          z-index: -1;
      }

      .filter-btn:hover::before,
      .filter-btn.active::before {
          opacity: 1;
      }

      .filter-btn.active,
      .filter-btn:hover {
          border-color: var(--primary);
          color: white;
          transform: translateY(-2px);
      }

      /* Dark Checkout Section Styles */
      .checkout-container {
          background: var(--background);
          min-height: 100vh;
          padding: 2rem 0;
      }

      .checkout-wrapper {
          max-width: 800px;
          margin: 0 auto;
          padding: 0 2rem;
      }

      .checkout-auth-warning {
          background: rgba(255, 107, 157, 0.1);
          border: 1px solid var(--primary);
          border-radius: 20px;
          padding: 2rem;
          text-align: center;
          margin-bottom: 2rem;
      }

      .checkout-auth-warning h3 {
          color: var(--primary);
          margin-bottom: 1rem;
          font-size: 1.5rem;
      }

      .checkout-auth-warning p {
          color: var(--text-muted);
          margin-bottom: 1.5rem;
      }

      .cart-summary {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(var(--blur-strength));
          border-radius: 20px;
          border: 1px solid var(--border);
          padding: 2rem;
          margin-bottom: 2rem;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .cart-summary h3 {
          color: var(--primary);
          margin-bottom: 1rem;
          font-size: 1.2rem;
      }

      .cart-summary-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 0;
          border-bottom: 1px solid var(--border);
          color: var(--text);
      }

      .cart-summary-item:last-child {
          border-bottom: none;
          font-weight: bold;
          color: var(--primary);
          margin-top: 1rem;
          padding-top: 1rem;
          border-top: 2px solid var(--border);
          font-size: 1.1rem;
      }

      .checkout-form {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(var(--blur-strength));
          border-radius: 20px;
          border: 1px solid var(--border);
          padding: 2rem;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .checkout-form h3 {
          color: var(--primary);
          margin-bottom: 1.5rem;
          font-size: 1.2rem;
      }

      .checkout-form label {
          font-weight: 600;
          margin-bottom: 0.5rem;
          display: block;
          color: var(--text);
          font-size: 0.9rem;
      }

      .checkout-form input,
      .checkout-form textarea,
      .checkout-form select {
          width: 100%;
          padding: 0.75rem;
          margin-bottom: 1rem;
          border-radius: 12px;
          border: 1px solid var(--border);
          background: rgba(255, 255, 255, 0.05);
          font-size: 0.9rem;
          outline: none;
          transition: all var(--transition-speed) ease;
          color: var(--text);
          font-family: 'Quicksand', sans-serif;
      }

      .checkout-form input:focus,
      .checkout-form select:focus,
      .checkout-form textarea:focus {
          border-color: var(--primary);
          background: rgba(255, 255, 255, 0.08);
          box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
      }

      .checkout-form textarea {
          min-height: 80px;
          resize: vertical;
      }

      .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
      }

      .promo-section {
          background: rgba(255, 107, 157, 0.1);
          border: 1px solid rgba(255, 107, 157, 0.3);
          border-radius: 12px;
          padding: 1rem;
          margin: 1rem 0;
      }

      .promo-input-group {
          display: flex;
          gap: 0.5rem;
          margin-top: 0.5rem;
      }

      .promo-input {
          flex: 1;
      }

      .apply-promo-btn {
          background: var(--primary);
          color: white;
          border: none;
          padding: 0.75rem 1rem;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          transition: all var(--transition-speed) ease;
      }

      .apply-promo-btn:hover {
          background: var(--primary-dark);
          transform: translateY(-1px);
      }

      .promo-status {
          margin-top: 0.5rem;
          font-size: 0.9rem;
          font-weight: 500;
      }

      .promo-status.valid {
          color: var(--success);
      }

      .promo-status.invalid {
          color: var(--error);
      }

      .whatsapp-btn {
          background: #25D366;
          color: white;
          border: none;
          border-radius: 12px;
          padding: 1rem;
          font-family: 'Quicksand', sans-serif;
          font-weight: 600;
          font-size: 1rem;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
          cursor: pointer;
          transition: all var(--transition-speed) ease;
          width: 100%;
          margin-top: 1rem;
      }

      .whatsapp-btn:hover {
          transform: translateY(-3px) scale(1.02);
          box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
      }

      .whatsapp-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
      }

      /* Profile Section */
      .profile-header {
          text-align: center;
          margin-bottom: 3rem;
          position: relative;
      }

      .profile-avatar {
          width: 120px;
          height: 120px;
          border-radius: 50%;
          object-fit: cover;
          border: 4px solid var(--primary);
          margin-bottom: 1rem;
          transition: all var(--transition-speed) ease;
          box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .profile-avatar:hover {
          transform: scale(1.05);
          box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }

      .profile-upload {
          display: none;
      }

      .upload-btn {
          background: rgba(255, 107, 157, 0.1);
          border: 1px solid var(--primary);
          color: var(--primary);
          padding: 0.5rem 1rem;
          border-radius: 8px;
          cursor: pointer;
          font-family: 'Quicksand', sans-serif;
          margin-bottom: 1rem;
          transition: all var(--transition-speed) ease;
      }

      .upload-btn:hover {
          background: rgba(255, 107, 157, 0.2);
          transform: translateY(-2px);
      }

      /* Product Detail Modal */
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.8);
          z-index: 2000;
          overflow-y: auto;
          padding: 2rem;
          animation: fadeIn 0.3s ease;
      }

      .modal-content-product {
          background: rgba(26, 26, 46, 0.95);
          backdrop-filter: blur(var(--blur-strength));
          -webkit-backdrop-filter: blur(var(--blur-strength));
          border: 1px solid var(--border);
          border-radius: 20px;
          max-width: 800px;
          margin: 2rem auto;
          padding: 2rem;
          position: relative;
          animation: scaleIn 0.3s ease;
      }

      @keyframes scaleIn {
          from { transform: scale(0.9); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
      }

      .close-modal {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          color: var(--text);
          font-size: 1.5rem;
          cursor: pointer;
          transition: all var(--transition-speed) ease;
      }

      .close-modal:hover {
          color: var(--primary);
          transform: rotate(90deg);
      }

      .product-detail {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 2rem;
      }

      .product-detail-image {
          width: 100%;
          height: 300px;
          object-fit: cover;
          border-radius: 12px;
          transition: all var(--transition-speed) ease;
          border: 1px solid var(--border);
      }

      .product-detail-image:hover {
          transform: scale(1.02);
          box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .product-detail-info h2 {
          font-size: 2rem;
          margin-bottom: 1rem;
          color: var(--primary);
      }

      .product-detail-price {
          font-size: 1.8rem;
          font-weight: 700;
          margin-bottom: 1rem;
          color: var(--primary);
          text-shadow: 0 2px 10px rgba(255, 107, 157, 0.3);
      }

      .color-select {
          margin-bottom: 1.5rem;
      }

      .color-select label {
          display: block;
          margin-bottom: 0.5rem;
          color: var(--text);
      }

      .color-options {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
          margin-top: 0.5rem;
      }

      /* About Section */
      .about-section {
          max-width: 800px;
          margin: 0 auto;
          text-align: center;
      }

      .about-section h2 {
          font-size: 2.5rem;
          color: var(--primary);
          margin-bottom: 2rem;
      }

      .about-section p {
          font-size: 1.1rem;
          line-height: 1.8;
          color: var(--text-muted);
          margin-bottom: 2rem;
      }

      .about-features {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 2rem;
          margin-top: 3rem;
      }

      .about-feature {
          background: rgba(255, 255, 255, 0.05);
          padding: 2rem;
          border-radius: 15px;
          border: 1px solid var(--border);
          transition: all var(--transition-speed) ease;
      }

      .about-feature:hover {
          transform: translateY(-5px);
          border-color: var(--primary);
      }

      .about-feature h4 {
          color: var(--primary);
          margin-bottom: 1rem;
          font-size: 1.2rem;
      }

      /* Notification */
      .notification {
          position: fixed;
          top: 100px;
          right: 20px;
          background: var(--primary);
          color: white;
          padding: 1rem 2rem;
          border-radius: 8px;
          z-index: 1001;
          animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
          box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
      }

      @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
      }

      /* Loading Animation */
      .loading {
          display: inline-block;
          width: 16px;
          height: 16px;
          border: 2px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          border-top-color: white;
          animation: spin 1s ease-in-out infinite;
          margin-right: 0.5rem;
      }

      @keyframes spin {
          to { transform: rotate(360deg); }
      }

      /* Responsive */
      @media (max-width: 768px) {
          .nav-links {
              position: fixed;
              top: 70px;
              left: 0;
              right: 0;
              background: rgba(15, 15, 35, 0.98);
              backdrop-filter: blur(var(--blur-strength));
              -webkit-backdrop-filter: blur(var(--blur-strength));
              flex-direction: column;
              padding: 1rem;
              gap: 0.5rem;
              transform: translateY(-100%);
              transition: transform var(--transition-speed) ease;
              z-index: 999;
              border-bottom: 1px solid var(--border);
              border-radius: 0 0 20px 20px;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
          }
          
          .nav-links.active {
              transform: translateY(0);
          }
          
          .nav-links li {
              width: 100%;
          }
          
          .nav-links a {
              display: block;
              text-align: center;
              padding: 1rem;
              border-radius: 12px;
          }
          
          .mobile-menu-btn {
              display: block;
          }
          
          .bento-grid {
              grid-template-columns: 1fr;
              gap: 1rem;
          }
          
          .auth-card {
              padding: 2rem;
              margin: 1rem;
          }
          
          .filters {
              justify-content: center;
          }

          .cart-item {
              flex-direction: column;
              text-align: center;
          }

          .quantity-controls {
              justify-content: center;
              margin-top: 1rem;
          }

          .product-detail {
              grid-template-columns: 1fr;
          }

          .form-row {
              grid-template-columns: 1fr;
          }

          .checkout-wrapper {
              padding: 0 1rem;
          }

          .sticky-cart {
              bottom: 10px;
              right: 10px;
              width: 50px;
              height: 50px;
              font-size: 1.2rem;
          }

          .about-features {
              grid-template-columns: 1fr;
          }
      }

      @media (max-width: 480px) {
          .logo {
              font-size: 1.4rem;
          }
          
          .nav-content {
              padding: 0 1rem;
          }
          
          .hero h1 {
              font-size: 2rem;
          }
      }

      /* Animations */
      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
      }

      @keyframes pulse {
          0% { text-shadow: 0 0 5px rgba(255, 107, 157, 0.3); }
          50% { text-shadow: 0 0 20px rgba(255, 107, 157, 0.5); }
          100% { text-shadow: 0 0 5px rgba(255, 107, 157, 0.3); }
      }

      @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-10px); }
          100% { transform: translateY(0px); }
      }

      .fade-in {
          animation: fadeIn 0.6s ease-out;
      }

      .float {
          animation: float 6s ease-in-out infinite;
      }

      /* Hero Section */
      .hero {
          text-align: center;
          padding: 4rem 0;
          background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(196, 69, 105, 0.1));
          border-radius: 20px;
          margin-bottom: 3rem;
          position: relative;
          overflow: hidden;
      }

      .hero::before {
          content: '';
          position: absolute;
          top: -50%;
          left: -50%;
          width: 200%;
          height: 200%;
          background: radial-gradient(circle, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
          animation: rotate 20s linear infinite;
      }

      @keyframes rotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
      }

      .hero h1 {
          font-size: 3rem;
          font-weight: 700;
          margin-bottom: 1rem;
          background: linear-gradient(45deg, var(--primary), var(--primary-dark));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          position: relative;
          z-index: 1;
      }

      .hero p {
          font-size: 1.2rem;
          color: #cbd5e1;
          max-width: 600px;
          margin: 0 auto;
          position: relative;
          z-index: 1;
      }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
      <div class="container">
          <div class="nav-content">
              <div class="logo">FemmeiaCloth</div>
              <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
              <ul class="nav-links" id="navLinks">
                  <!-- Navigation links will be loaded dynamically based on auth state -->
              </ul>
          </div>
      </div>
  </nav>

  <!-- Sticky Cart Button -->
  <button class="sticky-cart" onclick="showSection('cart')" id="stickyCart" style="display: none;">
      üõí
      <span class="cart-count" id="stickyCartCount">0</span>
  </button>

  <!-- Auth Section -->
  <section id="authSection" class="page-section active">
      <div class="auth-container">
          <div class="auth-card">
              <div id="loginForm">
                  <h2 class="auth-title">Selamat Datang Kembali</h2>
                  <form onsubmit="login(event)">
                      <div class="form-group">
                          <label>Email/Username</label>
                          <input type="text" id="loginEmail" required placeholder="Masukkan email atau username">
                          <div class="error" id="loginEmailError"></div>
                      </div>
                      <div class="form-group">
                          <label>Kata Sandi</label>
                          <input type="password" id="loginPassword" required>
                          <div class="error" id="loginPasswordError"></div>
                      </div>
                      <button type="submit" class="btn" id="loginBtn">
                          <span id="loginBtnText">Masuk</span>
                      </button>
                  </form>
                  <div class="forgot-password">
                      <a href="#" onclick="showForgotPassword()">Lupa kata sandi?</a>
                  </div>
                  <div class="auth-switch">
                      Belum punya akun? <a href="#" onclick="showRegister()">Daftar</a>
                  </div>
              </div>

              <div id="registerForm" style="display: none;">
                  <h2 class="auth-title">Bergabung dengan FemmeiaCloth</h2>
                  <form onsubmit="register(event)">
                      <div class="form-group">
                          <label>Nama Pengguna</label>
                          <input type="text" id="registerUsername" required>
                          <div class="error" id="registerUsernameError"></div>
                      </div>
                      <div class="form-group">
                          <label>Email</label>
                          <input type="email" id="registerEmail" required>
                          <div class="error" id="registerEmailError"></div>
                      </div>
                      <div class="form-group">
                          <label>Kata Sandi</label>
                          <input type="password" id="registerPassword" required>
                          <div class="error" id="registerPasswordError"></div>
                      </div>
                      <button type="submit" class="btn" id="registerBtn">
                          <span id="registerBtnText">Daftar</span>
                      </button>
                  </form>
                  <div class="auth-switch">
                      Sudah punya akun? <a href="#" onclick="showLogin()">Masuk</a>
                  </div>
              </div>

              <div id="forgotPasswordForm" style="display: none;">
                  <h2 class="auth-title">Reset Kata Sandi</h2>
                  <form onsubmit="sendPasswordReset(event)">
                      <div class="form-group">
                          <label>Email</label>
                          <input type="email" id="resetEmail" required placeholder="Masukkan email Anda">
                          <div class="error" id="resetEmailError"></div>
                          <div class="success" id="resetEmailSuccess"></div>
                      </div>
                      <button type="submit" class="btn" id="resetBtn">
                          <span id="resetBtnText">Kirim Link Reset</span>
                      </button>
                  </form>
                  <div class="auth-switch">
                      Ingat kata sandi? <a href="#" onclick="showLogin()">Masuk</a>
                  </div>
              </div>
          </div>
      </div>
  </section>

  <!-- Home Section -->
  <section id="homeSection" class="page-section">
      <div class="container">
          <div class="hero fade-in">
              <h1 class="float">Hijab & Fashion Premium</h1>
              <p>Temukan koleksi hijab dan aksesoris cantik berkualitas tinggi yang dirancang untuk wanita modern. Kualitas, variasi, dan harga terjangkau.</p>
          </div>

          <!-- Promo Card -->
          <div class="promo-card">
              <h3>üéâ Diskon 10% untuk Pembelian Pertama!</h3>
              <p>Gunakan kode promo untuk mendapatkan diskon 10%</p>
              <div class="promo-code">FEMMEIA10</div>
          </div>

          <div class="bento-grid">
              <div class="bento-card float">
                  <h3>Koleksi Unggulan</h3>
                  <p>Jelajahi desain hijab terbaru kami yang dibuat dengan bahan premium dan perhatian terhadap detail.</p>
              </div>
              <div class="bento-card float" style="animation-delay: 0.2s">
                  <h3>Jaminan Kualitas</h3>
                  <p>Setiap produk dipilih dengan hati-hati untuk memastikan kenyamanan, daya tahan, dan gaya yang bertahan lama.</p>
              </div>
              <div class="bento-card float" style="animation-delay: 0.4s">
                  <h3>Kemewahan Terjangkau</h3>
                  <p>Fashion yang indah tidak harus mahal. Temukan harga kompetitif kami.</p>
              </div>
          </div>
      </div>
  </section>

  <!-- Products Section -->
  <section id="productsSection" class="page-section">
      <div class="container">
          <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2.5rem; color: var(--primary);">Produk Kami</h2>
          
          <div class="filters">
              <button class="filter-btn active" onclick="filterProducts('all')">Semua</button>
              <button class="filter-btn" onclick="filterProducts('hijab')">Hijab</button>
              <button class="filter-btn" onclick="filterProducts('inner')">Inner</button>
              <button class="filter-btn" onclick="filterProducts('pashmina')">Pashmina</button>
          </div>

          <div class="bento-grid" id="productsGrid">
              <!-- Products will be loaded here -->
          </div>
      </div>
  </section>

  <!-- Cart Section -->
  <section id="cartSection" class="page-section">
      <div class="container">
          <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2.5rem; color: var(--primary);">Keranjang Belanja</h2>
          <div id="cartItems"></div>
          <div class="cart-total" id="cartTotal">Total: Rp 0</div>
          <div style="text-align: center;">
              <button class="btn" onclick="showSection('checkout')" style="max-width: 300px;">Lanjut ke Checkout</button>
          </div>
      </div>
  </section>

  <!-- Checkout Section -->
  <section id="checkoutSection" class="page-section">
      <div class="checkout-container">
          <div class="checkout-wrapper">
              <!-- Auth Warning for Non-logged Users -->
              <div id="checkoutAuthWarning" class="checkout-auth-warning" style="display: none;">
                  <h3>Silakan Masuk Terlebih Dahulu</h3>
                  <p>Untuk melakukan pemesanan, Anda perlu masuk ke akun terlebih dahulu.</p>
                  <button class="btn" onclick="showSection('auth')">Masuk Sekarang</button>
              </div>

              <!-- Checkout Form -->
              <div id="checkoutForm" style="display: none;">
                  <!-- Cart Summary -->
                  <div class="cart-summary">
                      <h3>Ringkasan Pesanan</h3>
                      <div id="checkoutCartItems"></div>
                  </div>

                  <!-- Customer Information Form -->
                  <div class="checkout-form">
                      <h3>Informasi Pembeli</h3>
                      <form id="orderForm">
                          <label>Nama Lengkap</label>
                          <input type="text" name="nama" id="customerName" required placeholder="Masukkan nama lengkap">

                          <label>Nomor WhatsApp</label>
                          <input type="tel" name="whatsapp" id="customerWhatsapp" required placeholder="08xxxxxxxxxx">

                          <label>Nomor Telepon</label>
                          <input type="tel" name="phone" id="customerPhone" placeholder="Nomor telepon alternatif">

                          <label>Alamat Lengkap</label>
                          <textarea name="alamat" id="customerAddress" required placeholder="Masukkan alamat lengkap untuk pengiriman"></textarea>

                          <div class="form-row">
                              <div>
                                  <label>Metode Pengiriman</label>
                                  <select name="pengiriman" required>
                                      <option value="">-- Pilih Pengiriman --</option>
                                      <option value="JNE">JNE</option>
                                      <option value="J&T">J&T</option>
                                      <option value="SiCepat">SiCepat</option>
                                      <option value="Gosend">Gosend</option>
                                      <option value="Antar Langsung">Antar Langsung (Makassar)</option>
                                      <option value="Ambil Langsung">Ambil Langsung</option>
                                  </select>
                              </div>
                              <div>
                                  <label>Metode Pembayaran</label>
                                  <select name="pembayaran" required>
                                      <option value="">-- Pilih Pembayaran --</option>
                                      <option value="Transfer Bank">Transfer Bank</option>
                                      <option value="COD">COD</option>
                                      <option value="QRIS">QRIS</option>
                                      <option value="E-Wallet">E-Wallet (Dana/OVO/GoPay)</option>
                                  </select>
                              </div>
                          </div>

                          <!-- Promo Code Section -->
                          <div class="promo-section">
                              <label>Kode Promo</label>
                              <div class="promo-input-group">
                                  <input type="text" id="promoCode" class="promo-input" placeholder="Masukkan kode promo">
                                  <button type="button" class="apply-promo-btn" onclick="applyPromoCode()">Terapkan</button>
                              </div>
                              <div class="promo-status" id="promoStatus"></div>
                          </div>

                          <label>Catatan Tambahan (Opsional)</label>
                          <textarea name="catatan" placeholder="Catatan khusus untuk pesanan Anda"></textarea>

                          <button type="submit" class="whatsapp-btn" id="orderBtn">
                              <span id="orderBtnText">üì± Pesan via WhatsApp</span>
                          </button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </section>

  <!-- Profile Section -->
  <section id="profileSection" class="page-section">
      <div class="container">
          <div class="profile-header">
              <img src="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg" alt="Profile" class="profile-avatar" id="profileAvatar">
              <input type="file" class="profile-upload" id="profileUpload" accept="image/*" onchange="uploadProfilePhoto(event)">
              <br>
              <button class="upload-btn" onclick="document.getElementById('profileUpload').click()">Ganti Foto</button>
              <h2 id="profileUsername">Nama Pengguna</h2>
              <p id="profileEmail">email@example.com</p>
          </div>

          <div class="bento-grid">
              <div class="bento-card">
                  <h3>Edit Profil</h3>
                  <form onsubmit="updateProfile(event)">
                      <div class="form-group">
                          <label>Nama Pengguna</label>
                          <input type="text" id="editUsername" required>
                      </div>
                      <div class="form-group">
                          <label>Email</label>
                          <input type="email" id="editEmail" required readonly>
                      </div>
                      <div class="form-group">
                          <label>Nomor Telepon</label>
                          <input type="tel" id="editPhone" placeholder="Masukkan nomor telepon">
                      </div>
                      <button type="submit" class="btn">Perbarui Profil</button>
                  </form>
              </div>

              <div class="bento-card">
                  <h3>Alamat</h3>
                  <form onsubmit="updateAddress(event)">
                      <div class="form-group">
                          <label>Alamat Lengkap</label>
                          <textarea id="editAddress" placeholder="Masukkan alamat lengkap" rows="4"></textarea>
                      </div>
                      <button type="submit" class="btn">Simpan Alamat</button>
                  </form>
              </div>

              <div class="bento-card">
                  <h3>Ubah Kata Sandi</h3>
                  <form onsubmit="changePassword(event)">
                      <div class="form-group">
                          <label>Kata Sandi Baru</label>
                          <input type="password" id="newPassword" required minlength="6">
                      </div>
                      <div class="form-group">
                          <label>Konfirmasi Kata Sandi</label>
                          <input type="password" id="confirmPassword" required minlength="6">
                          <div class="error" id="passwordError"></div>
                      </div>
                      <button type="submit" class="btn">Ubah Kata Sandi</button>
                  </form>
              </div>
          </div>
      </div>
  </section>

  <!-- About Section -->
  <section id="aboutSection" class="page-section">
      <div class="container">
          <div class="about-section">
              <h2>Tentang FemmeiaCloth</h2>
              <p>FemmeiaCloth adalah brand hijab premium yang didedikasikan untuk wanita modern yang mengutamakan gaya dan kenyamanan. Kami berkomitmen menyediakan produk berkualitas tinggi dengan desain yang trendy dan elegan.</p>
              
              <p>Dengan pengalaman bertahun-tahun di industri fashion muslim, kami memahami kebutuhan wanita Indonesia akan hijab yang tidak hanya indah dipandang, tetapi juga nyaman digunakan sehari-hari.</p>

              <div class="about-features">
                  <div class="about-feature">
                      <h4>üé® Desain Eksklusif</h4>
                      <p>Setiap produk dirancang dengan perhatian detail tinggi dan mengikuti tren fashion terkini</p>
                  </div>
                  <div class="about-feature">
                      <h4>üåü Kualitas Premium</h4>
                      <p>Menggunakan bahan-bahan pilihan yang nyaman, awet, dan mudah dirawat</p>
                  </div>
                  <div class="about-feature">
                      <h4>üíù Pelayanan Terbaik</h4>
                      <p>Tim customer service yang responsif dan siap membantu kebutuhan Anda</p>
                  </div>
                  <div class="about-feature">
                      <h4>üöö Pengiriman Cepat</h4>
                      <p>Pengiriman ke seluruh Indonesia dengan jaminan aman dan tepat waktu</p>
                  </div>
              </div>
          </div>
      </div>
  </section>

  <!-- Product Detail Modal -->
  <div id="productModal" class="modal">
      <div class="modal-content-product">
          <button class="close-modal" onclick="closeProductModal()">√ó</button>
          <div class="product-detail" id="productDetail">
              <!-- Product detail will be loaded here -->
          </div>
      </div>
  </div>

  <!-- Audio for tickle sound -->
  <audio id="tickleSound" preload="auto">
      <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
      <source src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-one/zapsplat_bell_small_hand_bell_ring_once_002_18631.mp3" type="audio/mpeg">
  </audio>

  <!-- Firebase SDK -->
  <script type="module">
      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
      import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification, sendPasswordResetEmail, updatePassword } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
      import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-storage.js";

      // Firebase config (same as survey)
      const firebaseConfig = {
          apiKey: "AIzaSyAxMT-bM6FEPrD-o3I2G-VHdZP7hxhj0uo",
          authDomain: "femmeiacloth-finance.firebaseapp.com",
          projectId: "femmeiacloth-finance",
          storageBucket: "femmeiacloth-finance.appspot.com",
          messagingSenderId: "517478386163",
          appId: "1:517478386163:web:51028f5841baa311126a86",
          measurementId: "G-K4L516Q54R"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      const storage = getStorage(app);

      // Updated products data with new images
      const products = [
          {
              id: 1,
              name: "Inner Earab",
              price: 25000,
              category: "inner",
              image: "https://www.femmeiacloth.me/app/store/assets/ciputall.jpg",
              colors: ["Hitam", "Putih", "Cream", "Mocha", "Abu-abu"],
              colorCodes: {
                  "Hitam": "#000000",
                  "Putih": "#FFFFFF",
                  "Cream": "#FFFDD0",
                  "Mocha": "#A38068",
                  "Abu-abu": "#808080"
              },
              description: "Inner Ninja premium, adem, nyaman dipakai seharian."
          },
          {
              id: 2,
              name: "Pashmina",
              price: 55000,
              category: "pashmina",
              image: "https://www.femmeiacloth.me/app/store/assets/IMG-20250512-WA0017.jpg",
              colors: ["Hitam", "Coklat", "Beige", "Mauve", "Lilac", "Hijau", "Olive"],
              colorCodes: {
                  "Coklat", "Beige", "Mauve", "Lilac", "Hijau", "Olive"],
              colorCodes: {
                  "Hitam": "#000000",
                  "Coklat": "#964B00",
                  "Beige": "#F5F5DC",
                  "Mauve": "#E0B0FF",
                  "Lilac": "#C8A2C8",
                  "Hijau": "#00FF00",
                  "Olive": "#808000"
              },
              description: "Pashmina bahan kaos premium, nyaman dipakai."
          },
          {
              id: 3,
              name: "Paris Jadul",
              price: 35000,
              category: "hijab",
              image: "https://www.femmeiacloth.me/app/store/assets/all.jpg",
              colors: ["Hitam", "Putih", "Abu-abu", "Navy", "Pink", "Cream"],
              colorCodes: {
                  "Hitam": "#000000",
                  "Putih": "#FFFFFF",
                  "Abu-abu": "#808080",
                  "Navy": "#000080",
                  "Pink": "#FFC0CB",
                  "Cream": "#FFFDD0"
              },
              description: "Hijab ringan, mudah dibentuk, cocok untuk sehari-hari."
          }
      ];

      // Global state
      let currentUser = null;
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let currentFilter = 'all';
      let selectedProduct = null;
      let selectedColor = null;
      let appliedPromo = null;
      let userProfiles = new Map();

      // Promo codes
      const promoCodes = {
          'FEMMEIA10': {
              discount: 0.1,
              description: 'Diskon 10%'
          }
      };

      // Make functions globally available
      window.toggleMobileMenu = toggleMobileMenu;
      window.showLogin = showLogin;
      window.showRegister = showRegister;
      window.showForgotPassword = showForgotPassword;
      window.login = login;
      window.register = register;
      window.sendPasswordReset = sendPasswordReset;
      window.logout = logout;
      window.showSection = showSection;
      window.filterProducts = filterProducts;
      window.showProductDetail = showProductDetail;
      window.closeProductModal = closeProductModal;
      window.updateSelectedColor = updateSelectedColor;
      window.selectColor = selectColor;
      window.addToCart = addToCart;
      window.updateQuantity = updateQuantity;
      window.removeFromCart = removeFromCart;
      window.uploadProfilePhoto = uploadProfilePhoto;
      window.updateProfile = updateProfile;
      window.updateAddress = updateAddress;
      window.changePassword = changePassword;
      window.applyPromoCode = applyPromoCode;

      // Play tickle sound on page load
      document.addEventListener('DOMContentLoaded', function() {
          // Try to play a subtle notification sound
          try {
              // Create a simple audio context for a gentle chime
              const audioContext = new (window.AudioContext || window.webkitAudioContext)();
              const oscillator = audioContext.createOscillator();
              const gainNode = audioContext.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(audioContext.destination);
              
              oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
              oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3);
              
              gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
              
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.3);
          } catch (error) {
              console.log('Audio not supported or blocked');
          }
          
          loadProducts();
          updateCartBadge();
          updateStickyCart();
      });

      // Auth state management
      onAuthStateChanged(auth, async (user) => {
          if (user && user.emailVerified) {
              currentUser = user;
              await loadUserProfile();
              showMainApp();
              updateNavLinks();
              loadProfile();
          } else if (user && !user.emailVerified) {
              showNotification('Silakan verifikasi email Anda terlebih dahulu', true);
              signOut(auth);
          } else {
              currentUser = null;
              showAuthSection();
              updateNavLinks();
          }
      });

      function showAuthSection() {
          document.getElementById('authSection').classList.add('active');
          document.querySelectorAll('.page-section:not(#authSection)').forEach(section => {
              section.classList.remove('active');
          });
      }

      function showMainApp() {
          document.getElementById('authSection').classList.remove('active');
          if (!document.querySelector('.page-section.active:not(#authSection)')) {
              showSection('home');
          }
      }

      // Mobile menu toggle
      function toggleMobileMenu() {
          const navLinks = document.getElementById('navLinks');
          navLinks.classList.toggle('active');
      }

      // Authentication functions
      function showLogin() {
          document.getElementById('loginForm').style.display = 'block';
          document.getElementById('registerForm').style.display = 'none';
          document.getElementById('forgotPasswordForm').style.display = 'none';
          clearAuthErrors();
      }

      function showRegister() {
          document.getElementById('loginForm').style.display = 'none';
          document.getElementById('registerForm').style.display = 'block';
          document.getElementById('forgotPasswordForm').style.display = 'none';
          clearAuthErrors();
      }

      function showForgotPassword() {
          document.getElementById('loginForm').style.display = 'none';
          document.getElementById('registerForm').style.display = 'none';
          document.getElementById('forgotPasswordForm').style.display = 'block';
          clearAuthErrors();
      }

      function clearAuthErrors() {
          document.querySelectorAll('.error').forEach(error => error.textContent = '');
          document.querySelectorAll('.success').forEach(success => success.textContent = '');
      }

      function showAuthError(fieldId, message) {
          const errorElement = document.getElementById(fieldId + 'Error');
          if (errorElement) errorElement.textContent = message;
      }

      function showAuthSuccess(fieldId, message) {
          const successElement = document.getElementById(fieldId + 'Success');
          if (successElement) {
              successElement.textContent = message;
              successElement.className = 'success';
          }
      }

      async function login(event) {
          event.preventDefault();
          clearAuthErrors();

          const emailOrUsername = document.getElementById('loginEmail').value.trim();
          const password = document.getElementById('loginPassword').value;

          if (!emailOrUsername || !password) {
              showAuthError('loginEmail', 'Email/username dan password wajib diisi');
              return;
          }

          const loginBtn = document.getElementById('loginBtn');
          const loginBtnText = document.getElementById('loginBtnText');
          
          loginBtn.disabled = true;
          loginBtnText.innerHTML = '<div class="loading"></div>Memproses...';

          try {
              let email = emailOrUsername;
              
              // Check if input is username (no @ symbol)
              if (!emailOrUsername.includes('@')) {
                  // Find email by username
                  const usersRef = collection(db, 'users');
                  const q = query(usersRef, where('username', '==', emailOrUsername));
                  const querySnapshot = await getDocs(q);
                  
                  if (querySnapshot.empty) {
                      showAuthError('loginEmail', 'Username tidak ditemukan');
                      return;
                  }
                  
                  email = querySnapshot.docs[0].data().email;
              }

              await signInWithEmailAndPassword(auth, email, password);
              showNotification('Berhasil masuk! Selamat datang kembali.');
          } catch (error) {
              console.error('Login error:', error);
              
              let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
              let errorField = 'loginEmail';
              
              switch (error.code) {
                  case 'auth/user-not-found':
                      errorMessage = 'Email tidak terdaftar. Silakan daftar terlebih dahulu.';
                      break;
                  case 'auth/wrong-password':
                  case 'auth/invalid-credential':
                      errorMessage = 'Password salah. Silakan periksa kembali password Anda.';
                      errorField = 'loginPassword';
                      break;
                  case 'auth/invalid-email':
                      errorMessage = 'Format email tidak valid.';
                      break;
                  case 'auth/too-many-requests':
                      errorMessage = 'Terlalu banyak percobaan. Coba lagi dalam beberapa menit.';
                      break;
              }
              
              showAuthError(errorField, errorMessage);
          } finally {
              loginBtn.disabled = false;
              loginBtnText.textContent = 'Masuk';
          }
      }

      async function register(event) {
          event.preventDefault();
          clearAuthErrors();

          const username = document.getElementById('registerUsername').value.trim();
          const email = document.getElementById('registerEmail').value.trim();
          const password = document.getElementById('registerPassword').value;

          // Validation
          if (!username) {
              showAuthError('registerUsername', 'Nama pengguna wajib diisi');
              return;
          }

          if (!email) {
              showAuthError('registerEmail', 'Email wajib diisi');
              return;
          }

          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
              showAuthError('registerEmail', 'Format email tidak valid');
              return;
          }

          if (!password) {
              showAuthError('registerPassword', 'Password wajib diisi');
              return;
          }

          if (password.length < 6) {
              showAuthError('registerPassword', 'Password minimal 6 karakter');
              return;
          }

          const registerBtn = document.getElementById('registerBtn');
          const registerBtnText = document.getElementById('registerBtnText');
          
          registerBtn.disabled = true;
          registerBtnText.innerHTML = '<div class="loading"></div>Memproses...';

          try {
              // Check if username already exists
              const usersRef = collection(db, 'users');
              const q = query(usersRef, where('username', '==', username));
              const querySnapshot = await getDocs(q);
              
              if (!querySnapshot.empty) {
                  showAuthError('registerUsername', 'Nama pengguna sudah digunakan');
                  return;
              }

              const userCredential = await createUserWithEmailAndPassword(auth, email, password);
              
              // Save user profile to Firestore
              await setDoc(doc(db, 'users', userCredential.user.uid), {
                  uid: userCredential.user.uid,
                  username: username,
                  email: email,
                  createdAt: new Date(),
                  phone: '',
                  address: ''
              });

              // Send email verification
              await sendEmailVerification(userCredential.user);
              
              showNotification('Akun berhasil dibuat! Silakan periksa email untuk verifikasi.');
              
              // Sign out until email is verified
              await signOut(auth);
              
              showLogin();
          } catch (error) {
              console.error('Register error:', error);
              
              let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
              let errorField = 'registerEmail';
              
              switch (error.code) {
                  case 'auth/email-already-in-use':
                      errorMessage = 'Email sudah terdaftar. Silakan gunakan email lain atau login.';
                      break;
                  case 'auth/weak-password':
                      errorMessage = 'Password terlalu lemah. Gunakan minimal 6 karakter.';
                      errorField = 'registerPassword';
                      break;
                  case 'auth/invalid-email':
                      errorMessage = 'Format email tidak valid.';
                      break;
              }
              
              showAuthError(errorField, errorMessage);
          } finally {
              registerBtn.disabled = false;
              registerBtnText.textContent = 'Daftar';
          }
      }

      async function sendPasswordReset(event) {
          event.preventDefault();
          clearAuthErrors();

          const email = document.getElementById('resetEmail').value.trim();

          if (!email) {
              showAuthError('resetEmail', 'Email wajib diisi');
              return;
          }

          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
              showAuthError('resetEmail', 'Format email tidak valid');
              return;
          }

          const resetBtn = document.getElementById('resetBtn');
          const resetBtnText = document.getElementById('resetBtnText');
          
          resetBtn.disabled = true;
          resetBtnText.innerHTML = '<div class="loading"></div>Mengirim...';

          try {
              await sendPasswordResetEmail(auth, email);
              showAuthSuccess('resetEmail', 'Link reset password telah dikirim ke email Anda');
              
              setTimeout(() => {
                  showLogin();
              }, 3000);
          } catch (error) {
              console.error('Password reset error:', error);
              
              let errorMessage = 'Terjadi kesalahan. Silakan coba lagi.';
              
              switch (error.code) {
                  case 'auth/user-not-found':
                      errorMessage = 'Email tidak terdaftar';
                      break;
                  case 'auth/invalid-email':
                      errorMessage = 'Format email tidak valid';
                      break;
                  case 'auth/too-many-requests':
                      errorMessage = 'Terlalu banyak permintaan. Coba lagi nanti';
                      break;
              }
              
              showAuthError('resetEmail', errorMessage);
          } finally {
              resetBtn.disabled = false;
              resetBtnText.textContent = 'Kirim Link Reset';
          }
      }

      function logout() {
          signOut(auth).then(() => {
              cart = [];
              localStorage.removeItem('cart');
              updateCartBadge();
              updateStickyCart();
              showNotification('Anda telah keluar dari akun');
          });
      }

      // Update navigation links based on authentication state
      function updateNavLinks() {
          const navLinks = document.getElementById('navLinks');
          
          if (currentUser) {
              // User is logged in
              navLinks.innerHTML = `
                  <li><a href="#" onclick="showSection('home')">Beranda</a></li>
                  <li><a href="#" onclick="showSection('products')">Produk</a></li>
                  <li><a href="#" onclick="showSection('cart')">Keranjang <span class="cart-badge" id="cartBadge">0</span></a></li>
                  <li><a href="#" onclick="showSection('about')">Tentang</a></li>
                  <li><a href="#" onclick="showSection('profile')">Profil</a></li>
                  <li><a href="#" onclick="logout()">Keluar</a></li>
              `;
          } else {
              // User is not logged in
              navLinks.innerHTML = `
                  <li><a href="#" onclick="showSection('home')">Beranda</a></li>
                  <li><a href="#" onclick="showSection('products')">Produk</a></li>
                  <li><a href="#" onclick="showSection('cart')">Keranjang <span class="cart-badge" id="cartBadge">0</span></a></li>
                  <li><a href="#" onclick="showSection('about')">Tentang</a></li>
                  <li><a href="#" onclick="showSection('auth')">Masuk</a></li>
              `;
          }
          
          updateCartBadge();
      }

      // Navigation
      function showSection(sectionName) {
          // Check if user is trying to access profile or checkout without being logged in
          if ((sectionName === 'profile' || sectionName === 'checkout') && !currentUser) {
              showSection('auth');
              showNotification('Silakan masuk terlebih dahulu', true);
              return;
          }
          
          document.querySelectorAll('.page-section').forEach(section => {
              section.classList.remove('active');
          });
          document.getElementById(sectionName + 'Section').classList.add('active');

          // Close mobile menu when navigating
          document.getElementById('navLinks').classList.remove('active');

          if (sectionName === 'cart') {
              loadCart();
          } else if (sectionName === 'checkout') {
              loadCheckout();
          }
      }

      // Products
      function loadProducts() {
          const grid = document.getElementById('productsGrid');
          const filteredProducts = currentFilter === 'all' 
              ? products 
              : products.filter(p => p.category === currentFilter);

          grid.innerHTML = filteredProducts.map((product, index) => `
              <div class="product-card fade-in" 
                   onclick="showProductDetail(${product.id})"
                   style="animation-delay: ${index * 0.1}s">
                  <img src="${product.image}" alt="${product.name}" class="product-image">
                  <div class="product-info">
                      <h3 class="product-name">${product.name}</h3>
                      <div class="product-price">Rp ${formatPrice(product.price)}</div>
                      <div class="product-colors">
                          ${product.colors.map(color => `
                              <div class="color-option" 
                                  style="background-color: ${product.colorCodes[color]}" 
                                  title="${color}">
                              </div>
                          `).join('')}
                      </div>
                      <p style="color: #94a3b8; font-size: 0.9rem;">${product.description}</p>
                  </div>
              </div>
          `).join('');
      }

      function filterProducts(filter) {
          currentFilter = filter;
          document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
          event.target.classList.add('active');
          loadProducts();
      }

      // Format price with thousand separator
      function formatPrice(price) {
          return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }

      // Product Detail Modal
      function showProductDetail(productId) {
          selectedProduct = products.find(p => p.id === productId);
          selectedColor = selectedProduct.colors[0];
          
          const modal = document.getElementById('productModal');
          const productDetail = document.getElementById('productDetail');
          
          productDetail.innerHTML = `
              <div>
                  <img src="${selectedProduct.image}" alt="${selectedProduct.name}" class="product-detail-image">
              </div>
              <div class="product-detail-info">
                  <h2>${selectedProduct.name}</h2>
                  <div class="product-detail-price">Rp ${formatPrice(selectedProduct.price)}</div>
                  <p style="color: #cbd5e1; margin-bottom: 1.5rem;">${selectedProduct.description}</p>
                  <div class="color-select">
                      <label>Pilih Warna:</label>
                      <div class="color-options">
                          ${selectedProduct.colors.map(color => `
                              <div class="color-option ${color === selectedColor ? 'selected' : ''}" 
                                  style="background-color: ${selectedProduct.colorCodes[color]}" 
                                  title="${color}"
                                  onclick="selectColor('${color}')">
                              </div>
                          `).join('')}
                      </div>
                      <p style="margin-top: 0.5rem; color: var(--text); font-weight: 500;">Warna: ${selectedColor}</p>
                  </div>
                  <button class="btn" onclick="addToCart(${selectedProduct.id})">
                      Tambahkan ke Keranjang
                  </button>
              </div>
          `;
          
          modal.style.display = 'block';
      }

      function closeProductModal() {
          document.getElementById('productModal').style.display = 'none';
      }

      function updateSelectedColor() {
          selectedColor = document.getElementById('colorSelect').value;
      }

      function selectColor(color) {
          selectedColor = color;
          // Update color options visual state
          document.querySelectorAll('.color-option').forEach(option => {
              option.classList.remove('selected');
          });
          event.target.classList.add('selected');
          
          // Update color text
          const colorText = document.querySelector('.color-select p');
          if (colorText) {
              colorText.textContent = `Warna: ${color}`;
          }
      }

      // Cart functions
      function addToCart(productId) {
          const product = products.find(p => p.id === productId);
          const color = selectedColor || product.colors[0];
          
          const existingItemIndex = cart.findIndex(item => 
              item.id === productId && item.selectedColor === color
          );

          if (existingItemIndex !== -1) {
              cart[existingItemIndex].quantity += 1;
          } else {
              cart.push({ 
                  ...product, 
                  quantity: 1,
                  selectedColor: color
              });
          }

          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartBadge();
          updateStickyCart();
          
          // Show feedback
          showNotification(`${product.name} (${color}) ditambahkan ke keranjang!`);
          
          // Close modal if open
          closeProductModal();
      }

      function updateCartBadge() {
          const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
          const cartBadge = document.getElementById('cartBadge');
          if (cartBadge) {
              cartBadge.textContent = totalItems;
          }
      }

      function updateStickyCart() {
          const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
          const stickyCart = document.getElementById('stickyCart');
          const stickyCartCount = document.getElementById('stickyCartCount');
          
          if (totalItems > 0) {
              stickyCart.style.display = 'flex';
              stickyCartCount.textContent = totalItems;
          } else {
              stickyCart.style.display = 'none';
          }
      }

      function loadCart() {
          const cartItems = document.getElementById('cartItems');
          const cartTotal = document.getElementById('cartTotal');

          if (cart.length === 0) {
              cartItems.innerHTML = '<p style="text-align: center; color: #94a3b8;">Keranjang belanja Anda kosong</p>';
              cartTotal.textContent = 'Total: Rp 0';
              return;
          }

          cartItems.innerHTML = cart.map((item, index) => `
              <div class="cart-item fade-in" style="animation-delay: ${index * 0.1}s">
                  <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                  <div class="cart-item-info">
                      <h4>${item.name}</h4>
                      <p>Rp ${formatPrice(item.price)}</p>
                      <p>Warna: ${item.selectedColor}</p>
                  </div>
                  <div class="quantity-controls">
                      <button class="quantity-btn" onclick="updateQuantity(${item.id}, '${item.selectedColor}', -1)">-</button>
                      <span>${item.quantity}</span>
                      <button class="quantity-btn" onclick="updateQuantity(${item.id}, '${item.selectedColor}', 1)">+</button>
                  </div>
                  <button class="quantity-btn" onclick="removeFromCart(${item.id}, '${item.selectedColor}')" style="background: #e74c3c;">√ó</button>
              </div>
          `).join('');

          const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
          cartTotal.textContent = `Total: Rp ${formatPrice(total)}`;
      }

      function updateQuantity(productId, color, change) {
          const itemIndex = cart.findIndex(item => item.id === productId && item.selectedColor === color);
          
          if (itemIndex !== -1) {
              cart[itemIndex].quantity += change;
              if (cart[itemIndex].quantity <= 0) {
                  removeFromCart(productId, color);
              } else {
                  localStorage.setItem('cart', JSON.stringify(cart));
                  loadCart();
                  updateCartBadge();
                  updateStickyCart();
              }
          }
      }

      function removeFromCart(productId, color) {
          const itemToRemove = cart.find(item => item.id === productId && item.selectedColor === color);
          const itemName = itemToRemove ? `${itemToRemove.name} (${itemToRemove.selectedColor})` : '';
          
          cart = cart.filter(item => !(item.id === productId && item.selectedColor === color));
          localStorage.setItem('cart', JSON.stringify(cart));
          loadCart();
          updateCartBadge();
          updateStickyCart();
          
          showNotification(`${itemName} dihapus dari keranjang`);
      }

      // Promo code functions
      function applyPromoCode() {
          const promoCodeInput = document.getElementById('promoCode');
          const promoStatus = document.getElementById('promoStatus');
          const code = promoCodeInput.value.trim().toUpperCase();

          if (!code) {
              promoStatus.textContent = 'Masukkan kode promo';
              promoStatus.className = 'promo-status invalid';
              return;
          }

          if (promoCodes[code]) {
              appliedPromo = promoCodes[code];
              promoStatus.textContent = `‚úì Kode promo valid! ${appliedPromo.description}`;
              promoStatus.className = 'promo-status valid';
              loadCheckoutCartSummary(); // Refresh cart summary with discount
              showNotification('Kode promo berhasil diterapkan!');
          } else {
              appliedPromo = null;
              promoStatus.textContent = '‚úó Kode promo tidak valid';
              promoStatus.className = 'promo-status invalid';
              loadCheckoutCartSummary(); // Refresh cart summary without discount
          }
      }

      // Checkout functions
      function loadCheckout() {
          const authWarning = document.getElementById('checkoutAuthWarning');
          const checkoutForm = document.getElementById('checkoutForm');
          
          if (!currentUser) {
              authWarning.style.display = 'block';
              checkoutForm.style.display = 'none';
          } else {
              authWarning.style.display = 'none';
              checkoutForm.style.display = 'block';
              
              // Load cart summary
              loadCheckoutCartSummary();
              
              // Pre-fill user data if available
              prefillUserData();
          }
      }

      async function prefillUserData() {
          if (!currentUser) return;
          
          const nameInput = document.getElementById('customerName');
          const whatsappInput = document.getElementById('customerWhatsapp');
          const phoneInput = document.getElementById('customerPhone');
          const addressInput = document.getElementById('customerAddress');
          
          try {
              const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
              if (userDoc.exists()) {
                  const userData = userDoc.data();
                  if (nameInput && !nameInput.value) nameInput.value = userData.username || '';
                  if (whatsappInput && !whatsappInput.value) whatsappInput.value = userData.phone || '';
                  if (phoneInput && !phoneInput.value) phoneInput.value = userData.phone || '';
                  if (addressInput && !addressInput.value) addressInput.value = userData.address || '';
              }
          } catch (error) {
              console.error('Error loading user data:', error);
          }
      }

      function loadCheckoutCartSummary() {
          const checkoutCartItems = document.getElementById('checkoutCartItems');
          
          if (cart.length === 0) {
              checkoutCartItems.innerHTML = '<p style="color: #8e88a7;">Keranjang kosong</p>';
              return;
          }

          let subtotal = 0;
          let summaryHTML = '';

          cart.forEach(item => {
              const itemTotal = item.price * item.quantity;
              subtotal += itemTotal;
              
              summaryHTML += `
                  <div class="cart-summary-item">
                      <div>
                          <strong>${item.name}</strong><br>
                          <small>Warna: ${item.selectedColor} | Qty: ${item.quantity}</small>
                      </div>
                      <div>Rp ${formatPrice(itemTotal)}</div>
                  </div>
              `;
          });

          // Add subtotal
          summaryHTML += `
              <div class="cart-summary-item">
                  <div>Subtotal</div>
                  <div>Rp ${formatPrice(subtotal)}</div>
              </div>
          `;

          // Add discount if applicable
          let total = subtotal;
          if (appliedPromo) {
              const discount = subtotal * appliedPromo.discount;
              total = subtotal - discount;
              summaryHTML += `
                  <div class="cart-summary-item">
                      <div>Diskon (${appliedPromo.description})</div>
                      <div style="color: var(--success);">- Rp ${formatPrice(discount)}</div>
                  </div>
              `;
          }

          summaryHTML += `
              <div class="cart-summary-item">
                  <div><strong>Total</strong></div>
                  <div><strong>Rp ${formatPrice(total)}</strong></div>
              </div>
          `;

          checkoutCartItems.innerHTML = summaryHTML;
      }

      // Order form submission
      document.getElementById('orderForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          if (!currentUser) {
              showNotification('Silakan masuk terlebih dahulu', true);
              return;
          }

          if (cart.length === 0) {
              showNotification('Keranjang belanja kosong', true);
              return;
          }

          const orderBtn = document.getElementById('orderBtn');
          const orderBtnText = document.getElementById('orderBtnText');
          
          orderBtn.disabled = true;
          orderBtnText.innerHTML = '<div class="loading"></div>Memproses...';

          try {
              const formData = new FormData(this);
              
              // Validate WhatsApp number
              const whatsapp = formData.get('whatsapp').trim();
              if (!/^[0-9]{10,15}$/.test(whatsapp.replace(/[\s\-\+$$$$]/g, ''))) {
                  showNotification('Nomor WhatsApp tidak valid', true);
                  return;
              }

              // Calculate totals
              const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
              let discount = 0;
              if (appliedPromo) {
                  discount = subtotal * appliedPromo.discount;
              }
              const total = subtotal - discount;

              // Create order data
              const orderData = {
                  userId: currentUser.uid,
                  customerName: formData.get('nama'),
                  whatsapp: whatsapp,
                  phone: formData.get('phone') || '',
                  address: formData.get('alamat'),
                  shipping: formData.get('pengiriman'),
                  payment: formData.get('pembayaran'),
                  notes: formData.get('catatan') || '',
                  promoCode: appliedPromo ? Object.keys(promoCodes).find(key => promoCodes[key] === appliedPromo) : '',
                  items: cart,
                  subtotal: subtotal,
                  discount: discount,
                  total: total,
                  createdAt: new Date(),
                  status: 'pending'
              };

              // Save order to Firebase
              await addDoc(collection(db, 'orders'), orderData);

              // Generate WhatsApp message
              let message = `*Pesanan Baru - FemmeiaCloth*

`;
              message += `üë§ *Nama:* ${orderData.customerName}
`;
              message += `üì± *WhatsApp:* ${orderData.whatsapp}
`;
              if (orderData.phone) {
                  message += `‚òéÔ∏è *Telepon:* ${orderData.phone}
`;
              }
              message += `üìç *Alamat:* ${orderData.address}

`;
              
              message += `üõçÔ∏è *Detail Pesanan:*
`;
              cart.forEach((item, index) => {
                  message += `${index + 1}. ${item.name}
`;
                  message += `   Warna: ${item.selectedColor}
`;
                  message += `   Qty: ${item.quantity}
`;
                  message += `   Harga: Rp ${formatPrice(item.price * item.quantity)}

`;
              });
              
              message += `üí∞ *Subtotal: Rp ${formatPrice(subtotal)}*
`;
              
              if (discount > 0) {
                  message += `üéüÔ∏è *Diskon: - Rp ${formatPrice(discount)}*
`;
              }
              
              message += `üí∞ *Total: Rp ${formatPrice(total)}*

`;
              message += `üöö *Pengiriman:* ${orderData.shipping}
`;
              message += `üí≥ *Pembayaran:* ${orderData.payment}
`;
              
              if (orderData.notes) {
                  message += `üìù *Catatan:* ${orderData.notes}
`;
              }

              // Open WhatsApp
              const whatsappNumber = "6285341899229";
              const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
              window.open(whatsappURL, '_blank');

              // Clear cart and reset promo
              cart = [];
              appliedPromo = null;
              localStorage.setItem('cart', JSON.stringify(cart));
              updateCartBadge();
              updateStickyCart();
              
              showNotification('Pesanan berhasil dikirim ke WhatsApp!');
              
              // Reset form and redirect to home
              this.reset();
              document.getElementById('promoCode').value = '';
              document.getElementById('promoStatus').textContent = '';
              setTimeout(() => {
                  showSection('home');
              }, 2000);

          } catch (error) {
              console.error('Order submission error:', error);
              showNotification('Terjadi kesalahan saat memproses pesanan', true);
          } finally {
              orderBtn.disabled = false;
              orderBtnText.textContent = 'üì± Pesan via WhatsApp';
          }
      });

      // Profile functions
      async function loadUserProfile() {
          if (!currentUser) return;
          
          try {
              const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
              if (userDoc.exists()) {
                  userProfiles.set(currentUser.uid, userDoc.data());
              }
          } catch (error) {
              console.error('Error loading user profile:', error);
          }
      }

      function loadProfile() {
          if (currentUser) {
              document.getElementById('profileEmail').textContent = currentUser.email;
              document.getElementById('editEmail').value = currentUser.email;
              
              // Load additional profile data from cache or Firestore
              const profile = userProfiles.get(currentUser.uid);
              if (profile) {
                  document.getElementById('profileUsername').textContent = profile.username || 'Pengguna';
                  document.getElementById('editUsername').value = profile.username || '';
                  document.getElementById('editPhone').value = profile.phone || '';
                  document.getElementById('editAddress').value = profile.address || '';
                  
                  if (profile.avatar) {
                      document.getElementById('profileAvatar').src = profile.avatar;
                  }
              }
          }
      }

      async function uploadProfilePhoto(event) {
          if (!currentUser) {
              showNotification('Silakan masuk terlebih dahulu', true);
              return;
          }
          
          const file = event.target.files[0];
          if (file) {
              try {
                  // Upload to Firebase Storage
                  const storageRef = ref(storage, `profile-photos/${currentUser.uid}`);
                  const snapshot = await uploadBytes(storageRef, file);
                  const downloadURL = await getDownloadURL(snapshot.ref);
                  
                  // Update profile picture in UI
                  document.getElementById('profileAvatar').src = downloadURL;
                  
                  // Update user profile in Firestore
                  await updateDoc(doc(db, 'users', currentUser.uid), {
                      avatar: downloadURL,
                      updatedAt: new Date()
                  });
                  
                  // Update local cache
                  const profile = userProfiles.get(currentUser.uid) || {};
                  profile.avatar = downloadURL;
                  userProfiles.set(currentUser.uid, profile);
                  
                  showNotification('Foto profil berhasil diperbarui');
              } catch (error) {
                  console.error('Upload error:', error);
                  showNotification('Gagal mengupload foto profil', true);
              }
          }
      }

      async function updateProfile(event) {
          event.preventDefault();
          
          if (!currentUser) {
              showNotification('Silakan masuk terlebih dahulu', true);
              return;
          }
          
          const username = document.getElementById('editUsername').value.trim();
          const phone = document.getElementById('editPhone').value.trim();
          
          if (!username) {
              showNotification('Nama pengguna wajib diisi', true);
              return;
          }

          try {
              // Check if username is already taken by another user
              if (username !== userProfiles.get(currentUser.uid)?.username) {
                  const usersRef = collection(db, 'users');
                  const q = query(usersRef, where('username', '==', username));
                  const querySnapshot = await getDocs(q);
                  
                  if (!querySnapshot.empty && querySnapshot.docs[0].id !== currentUser.uid) {
                      showNotification('Nama pengguna sudah digunakan', true);
                      return;
                  }
              }

              // Update profile in Firestore
              await updateDoc(doc(db, 'users', currentUser.uid), {
                  username: username,
                  phone: phone,
                  updatedAt: new Date()
              });
              
              // Update local cache
              const profile = userProfiles.get(currentUser.uid) || {};
              profile.username = username;
              profile.phone = phone;
              userProfiles.set(currentUser.uid, profile);
              
              loadProfile();
              showNotification('Profil berhasil diperbarui!');
          } catch (error) {
              console.error('Profile update error:', error);
              showNotification('Gagal memperbarui profil', true);
          }
      }

      async function updateAddress(event) {
          event.preventDefault();
          
          if (!currentUser) {
              showNotification('Silakan masuk terlebih dahulu', true);
              return;
          }
          
          const address = document.getElementById('editAddress').value.trim();

          try {
              // Update address in Firestore
              await updateDoc(doc(db, 'users', currentUser.uid), {
                  address: address,
                  updatedAt: new Date()
              });
              
              // Update local cache
              const profile = userProfiles.get(currentUser.uid) || {};
              profile.address = address;
              userProfiles.set(currentUser.uid, profile);
              
              showNotification('Alamat berhasil disimpan!');
          } catch (error) {
              console.error('Address update error:', error);
              showNotification('Gagal menyimpan alamat', true);
          }
      }

      async function changePassword(event) {
          event.preventDefault();
          
          if (!currentUser) {
              showNotification('Silakan masuk terlebih dahulu', true);
              return;
          }
          
          const newPassword = document.getElementById('newPassword').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          const passwordError = document.getElementById('passwordError');
          
          // Clear previous errors
          passwordError.textContent = '';
          
          if (newPassword !== confirmPassword) {
              passwordError.textContent = 'Konfirmasi password tidak cocok';
              return;
          }
          
          if (newPassword.length < 6) {
              passwordError.textContent = 'Password minimal 6 karakter';
              return;
          }

          try {
              await updatePassword(currentUser, newPassword);
              showNotification('Password berhasil diubah!');
              
              // Clear form
              document.getElementById('newPassword').value = '';
              document.getElementById('confirmPassword').value = '';
          } catch (error) {
              console.error('Password change error:', error);
              
              let errorMessage = 'Gagal mengubah password';
              if (error.code === 'auth/requires-recent-login') {
                  errorMessage = 'Silakan login ulang untuk mengubah password';
              }
              
              passwordError.textContent = errorMessage;
          }
      }

      // Notification system
      function showNotification(message, isError = false) {
          // Remove any existing notifications
          const existingNotifications = document.querySelectorAll('.notification');
          existingNotifications.forEach(notification => notification.remove());
          
          // Create new notification
          const notification = document.createElement('div');
          notification.className = 'notification';
          notification.textContent = message;
          
          if (isError) {
              notification.style.background = '#e74c3c';
          }
          
          document.body.appendChild(notification);
          
          // Remove notification after 3 seconds
          setTimeout(() => {
              notification.remove();
          }, 3000);
      }

      // Close modal when clicking outside
      window.onclick = function(event) {
          const modal = document.getElementById('productModal');
          if (event.target == modal) {
              closeProductModal();
          }
      }
  </script>
</body>
</html>
