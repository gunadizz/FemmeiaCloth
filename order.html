<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Form Pemesanan - FemmeiaCloth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> 
  <!-- Prevent zoom on mobile for inputs -->
  
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg" type="image/x-icon">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    /* --- VARIABLES (Sesuai index.html) --- */
    :root {
      --background: #f8fafc;
      --text: #1f2937;
      --text-muted: #6b7280;
      --accent-dark: #1f2937;
      --accent-mid: #374151;
      --border: rgba(55, 65, 81, 0.15);
      --success: #059669;
      --error: #e11d48;
      --warning: #fbbf24;
      --shadow: 0 8px 32px rgba(31, 41, 55, 0.06);
      --shadow-hover: 0 16px 48px rgba(31, 41, 55, 0.1);
      --glass-bg: rgba(255, 255, 255, 0.75);
      --glass-border: rgba(255, 255, 255, 0.5);
      --radius-lg: 1.25rem;
      --radius-md: 0.75rem;
      --blur: 12px;
    }

    /* --- BASE SETUP --- */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Quicksand', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      color: var(--text);
      min-height: 100vh;
      /* Adjusted Padding */
      padding-top: 60px; /* Sedikit dilebihkan dari tinggi top-bar */
      padding-bottom: 120px; /* Space for Sticky Footer */
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    /* --- BACKGROUND ANIMATION --- */
    .scattered-shapes { position: fixed; inset: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; overflow: hidden; }
    .shape { position: absolute; border-radius: 50%; filter: blur(40px); opacity: 0.6; animation: float 10s infinite alternate; }
    .shape-1 { width: 300px; height: 300px; background: #e0e7ff; top: -50px; left: -100px; }
    .shape-2 { width: 200px; height: 200px; background: #fce7f3; bottom: 10%; right: -50px; animation-duration: 15s; }
    @keyframes float { from { transform: translate(0,0); } to { transform: translate(20px, 40px); } }

    /* --- TOP BAR --- */
    .top-bar {
      position: fixed; top: 0; left: 0; width: 100%; height: 40px;
      background: var(--accent-dark); color: #fff;
      display: flex; align-items: center; z-index: 1000;
      font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .marquee { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
    @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    /* --- LAYOUT CONTAINER --- */
    .container {
      width: 94%; max-width: 550px; margin: 0 auto;
      display: flex; flex-direction: column; 
      gap: 1.5rem; /* DIUBAH: Menambah jarak antar card agar tidak terlalu rapat */
      z-index: 1;
    }

    /* --- CARDS & GLASSMORPHISM --- */
    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--blur));
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: 1.5rem; /* DIUBAH: Menambah padding dalam card agar lebih lega */
      box-shadow: var(--shadow);
      transition: transform 0.2s;
      margin-bottom: 0; /* Margin dihandle oleh gap container */
    }
    .card-header {
      display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; /* DIUBAH: Jarak header ke konten */
      padding-bottom: 0.75rem; border-bottom: 1px solid rgba(0,0,0,0.06);
      font-weight: 700; color: var(--accent-dark); font-size: 1.1rem;
    }
    .card-header i { color: var(--accent-mid); width: 20px; height: 20px; }

    /* --- FORM ELEMENTS --- */
    label { display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--accent-mid); }
    
    .input-group { margin-bottom: 1.25rem; position: relative; } /* DIUBAH: Jarak antar input */
    .input-group:last-child { margin-bottom: 0; }
    
    input, select, textarea {
      width: 100%; padding: 0.8rem 1rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.8);
      font-size: 0.95rem; color: var(--text);
      transition: all 0.2s; outline: none; appearance: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--accent-dark); background: #fff;
      box-shadow: 0 0 0 3px rgba(31, 41, 55, 0.1);
    }
    /* Custom Select Arrow */
    .select-wrapper { position: relative; }
    .select-wrapper::after {
      content: ''; position: absolute; right: 15px; top: 40%;
      border: 5px solid transparent; border-top-color: var(--text-muted); pointer-events: none;
    }

    /* Error States */
    .input-error { 
      border-color: var(--error) !important; 
      background: #fff5f5 !important; 
      animation: shake 0.3s;
    }
    @keyframes shake { 0%,100% {transform:translateX(0);} 25% {transform:translateX(-4px);} 75% {transform:translateX(4px);} }

    /* --- TOAST NOTIFICATION --- */
    .toast-container {
      position: fixed;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 90%;
      max-width: 400px;
      pointer-events: none;
    }
    .toast {
      background: #333;
      color: #fff;
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.error { background: var(--error); }
    .toast i { width: 18px; height: 18px; }


    /* --- QUANTITY STEPPER (New) --- */
    .qty-container {
      display: flex; align-items: center; gap: 0.5rem;
    }
    .qty-btn {
      width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--border);
      background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; color: var(--accent-dark); transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .qty-btn:active { transform: scale(0.92); background: #f1f5f9; }
    .qty-input {
      width: 50px; text-align: center; font-weight: 700; font-size: 1.1rem; margin: 0; padding: 0.8rem 0;
    }

    /* --- COLOR PICKER (New & Improved) --- */
    .color-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(38px, 1fr));
      gap: 8px; margin-top: 0.5rem;
    }
    .color-option {
      width: 38px; height: 38px; border-radius: 50%; cursor: pointer;
      border: 2px solid #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      position: relative; transition: transform 0.2s;
    }
    .color-option:active { transform: scale(0.9); }
    .color-option.selected {
      transform: scale(1.15); border-color: #fff;
      box-shadow: 0 0 0 2px var(--accent-dark), 0 4px 12px rgba(0,0,0,0.2);
    }
    .color-option.selected::after {
      content: '✔'; color: #fff; font-size: 12px; position: absolute;
      top: 50%; left: 50%; transform: translate(-50%, -50%); text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .selected-color-label {
      margin-top: 8px; font-size: 0.9rem; font-weight: 600; color: var(--accent-dark);
      background: rgba(255,255,255,0.6); padding: 4px 10px; border-radius: 8px; display: inline-block;
    }

    /* --- STICKY FOOTER (FAB Style) --- */
    .sticky-footer {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 94%; max-width: 550px;
      background: rgba(31, 41, 55, 0.95); /* Dark theme */
      backdrop-filter: blur(10px);
      color: #fff;
      border-radius: 16px;
      padding: 12px 20px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      z-index: 900;
      animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .total-wrapper { display: flex; flex-direction: column; }
    .total-label { font-size: 0.75rem; opacity: 0.8; }
    .total-price { font-size: 1.2rem; font-weight: 700; }
    .promo-applied { color: #4ade80; font-size: 0.75rem; font-weight: 600; display: none; }
    
    .btn-checkout {
      background: #fff; color: var(--accent-dark);
      border: none; padding: 10px 24px; border-radius: 12px;
      font-weight: 700; font-size: 1rem; cursor: pointer;
      display: flex; align-items: center; gap: 8px;
      transition: transform 0.2s;
    }
    .btn-checkout:hover { transform: scale(1.05); }
    .btn-checkout:active { transform: scale(0.95); opacity: 0.9; }

    /* --- MODAL --- */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
      z-index: 2000; display: none; align-items: center; justify-content: center;
    }
    .modal-box {
      background: #fff; width: 90%; max-width: 400px; border-radius: 20px;
      padding: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
      animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .modal-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 16px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .summary-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; }
    .summary-item strong { color: var(--text-muted); }
    .summary-total { margin-top: 15px; padding-top: 10px; border-top: 2px dashed #eee; font-weight: 700; font-size: 1.1rem; display: flex; justify-content: space-between; }
    
    .btn-wa {
      background: #25D366; color: #fff; width: 100%; padding: 14px;
      border: none; border-radius: 12px; font-weight: 700; font-size: 1rem;
      margin-top: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-back {
      background: transparent; color: var(--text-muted); width: 100%; padding: 10px;
      border: none; margin-top: 5px; font-weight: 600; cursor: pointer;
    }

    /* Animations */
    @keyframes slideUp { from { transform: translate(-50%, 100px); } to { transform: translate(-50%, 0); } }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    /* Helpers */
    .hidden { display: none !important; }
    .reset-link { text-align: center; margin-top: 10px; }
    .reset-link a { color: var(--text-muted); font-size: 0.85rem; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>

  <!-- Background Animated Shapes -->
  <div class="scattered-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Top Marquee -->
  <div class="top-bar">
    <div class="marquee">
       PROMO SPESIAL: Gunakan kode <b>FEMMEIA10</b> untuk DISKON 10% Pembelian Pertama! • Free Ongkir Makassar • Pengiriman Cepat
    </div>
  </div>

  <div class="container">
    
    <!-- Header Card -->
    <div class="card" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem;">
      <img src="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg" style="width:50px; height:50px; border-radius:50%; object-fit:cover; border:2px solid var(--accent-dark);" alt="Logo">
      <div style="flex:1;">
        <h2 style="font-size:1.1rem; font-weight:700;">Form Pemesanan</h2>
        <p style="font-size:0.85rem; color:var(--text-muted);">FemmeiaCloth Official</p>
      </div>
      <a href="index.html" style="color:var(--text-muted);"><i data-lucide="home"></i></a>
    </div>

    <form id="orderForm" novalidate style="display: flex; flex-direction: column; gap: 1.5rem;">
      
      <!-- IDENTITAS -->
      <div class="card">
        <div class="card-header"><i data-lucide="user"></i> Identitas Pembeli</div>
        
        <div class="input-group">
          <label>Nama Lengkap</label>
          <input type="text" name="nama" id="nama" placeholder="Contoh: Iftitah" required data-label="Nama Lengkap">
        </div>

        <div class="input-group">
          <label>Nomor WhatsApp</label>
          <input type="tel" name="wa" id="wa" placeholder="0812xxxx" inputmode="numeric" required data-label="Nomor WhatsApp">
        </div>

        <div class="input-group">
          <label>Alamat Lengkap</label>
          <textarea name="alamat" id="alamat" rows="3" placeholder="Jalan, No. Rumah, RT/RW, Kecamatan, Kota" required data-label="Alamat Lengkap"></textarea>
        </div>
      </div>

      <!-- PRODUK -->
      <div class="card">
        <div class="card-header"><i data-lucide="shopping-bag"></i> Detail Produk</div>
        
        <div class="input-group">
          <label>Jenis Produk</label>
          <div class="select-wrapper">
            <select name="produk" id="produk" required data-label="Jenis Produk">
              <option value="">-- Pilih Produk --</option>
              <option value="Paris Jadul - 35000">Paris Jadul - Rp35.000</option>
              <option value="Pashmina Kaos - 55000">Pashmina Kaos - Rp55.000</option>
              <option value="Premium Inner - 25000">Premium Inner - Rp25.000</option>
            </select>
          </div>
        </div>

        <div class="input-group" id="colorGroup">
          <label>Warna: <span id="warnaLabel" style="font-weight:400; color:var(--text);">Belum dipilih</span></label>
          <div id="colorGrid" class="color-grid"></div>
          <input type="hidden" name="warna" id="warnaInput" data-label="Warna Produk">
          <div id="msgSelectProduct" style="font-size:0.85rem; color:var(--text-muted; font-style:italic; margin-top:5px;">Silakan pilih produk terlebih dahulu.</div>
        </div>

        <div class="input-group">
          <label>Jumlah</label>
          <div class="qty-container">
            <button type="button" class="qty-btn" onclick="updateQty(-1)">-</button>
            <input type="number" name="jumlah" id="jumlah" class="qty-input" value="1" min="1" max="50">
            <button type="button" class="qty-btn" onclick="updateQty(1)">+</button>
          </div>
        </div>

        <div class="input-group">
          <label>Tambahan Paper Bag</label>
          <div class="select-wrapper">
            <select name="paperbag" id="paperbag">
              <option value="Tidak">Tidak</option>
              <option value="Ya">Ya (+Rp5.000)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- PENGIRIMAN & BAYAR -->
      <div class="card">
        <div class="card-header"><i data-lucide="truck"></i> Pengiriman & Pembayaran</div>
        
        <div class="input-group">
          <label>Metode Pengiriman</label>
          <div class="select-wrapper">
            <select name="pengiriman" id="pengiriman" required data-label="Metode Pengiriman">
              <option value="">-- Pilih --</option>
              <option value="SPX ID">SPX ID</option>
              <option value="J&T">J&T</option>
              <option value="Gosend">Gosend (Makassar)</option>
              <option value="Antar Langsung">Antar Langsung (Khusus Tamalanrea)</option>
              <option value="Ambil Langsung">Ambil Langsung (Ke Lokasi)</option>
            </select>
          </div>
        </div>

        <div class="input-group">
          <label>Metode Pembayaran</label>
          <div class="select-wrapper">
            <select name="pembayaran" id="pembayaran" required data-label="Metode Pembayaran">
              <option value="">-- Pilih --</option>
              <option value="Transfer Bank">Transfer Bank (BCA/BRI)</option>
              <option value="COD">COD (Bayar di Tempat)</option>
              <option value="QRIS">QRIS (Scan Barcode)</option>
              <option value="E-Wallet">DANA / OVO / GoPay</option>
            </select>
          </div>
        </div>

        <div class="input-group">
          <label>Kode Promo (Opsional)</label>
          <input type="text" name="promo" id="promo" placeholder="Punya kode promo?" style="text-transform:uppercase;">
          <div id="promoStatus" style="font-size:0.8rem; margin-top:4px;"></div>
        </div>

        <div class="input-group">
          <label>Catatan Tambahan</label>
          <textarea name="catatan" id="catatan" rows="2" placeholder="Pesan khusus untuk penjual..."></textarea>
        </div>

        <div class="reset-link">
          <a onclick="resetForm()">Reset Formulir</a>
        </div>
      </div>
      
    </form>
  </div>

  <!-- STICKY FOOTER (Total & Checkout) -->
  <div class="sticky-footer">
    <div class="total-wrapper">
      <span class="total-label">Total Pembayaran <span id="promoBadge" class="promo-applied">(Diskon 10%)</span></span>
      <span class="total-price" id="footerTotal">Rp0</span>
    </div>
    <button type="button" class="btn-checkout" onclick="validateAndOrder()">
      Pesan <i data-lucide="arrow-right" style="width:18px;"></i>
    </button>
  </div>

  <!-- MODAL KONFIRMASI -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal-box">
      <div class="modal-title">Konfirmasi Pesanan</div>
      <div id="summaryContent"></div>
      
      <button class="btn-wa" id="btnSendWa">
        <i data-lucide="message-circle"></i> Lanjut ke WhatsApp
      </button>
      <button class="btn-back" onclick="closeModal()">Periksa Lagi</button>
    </div>
  </div>

  <script>
    // Initialize Icons
    lucide.createIcons();

    // --- DATA ---
    const PRODUCT_DATA = {
      "Paris Jadul - 35000": [
        "Hitam", "Stone", "Abu Ash", "Soft Latte", "Cream", "Vanilla", 
        "Biskuit", "Dusty Rose", "Dark Blue", "Dark Choco", "Burgundy", "Maroon"
      ],
      "Pashmina Kaos - 55000": ["Hitam", "Dark Grey", "Khaky Putty", "Navy"],
      "Premium Inner - 25000": ["BW", "Oat", "Hitam", "Silver", "Dark Grey", "Khaky"]
    };

    const COLOR_HEX = {
      "Hitam": "#191919", "Stone": "#b8b6b1", "Abu Ash": "#a7a6a6", "Soft Latte": "#e5ceb8",
      "Cream": "#fff6cf", "Vanilla": "#fbe7a2", "Biskuit": "#e2c39a", "Dusty Rose": "#e4aeb1",
      "Dark Blue": "#222e50", "Dark Choco": "#513c29", "Burgundy": "#7d2636", "Maroon": "#781f29",
      "Dark Grey": "#44474b", "Silver": "#c0c0c0", "Khaky": "#bdb76b", "Oat": "#e5d1b8",
      "BW": "#f8f8f8", "Khaky Putty": "#cabfa0", "Navy": "#2a3759"
    };

    // --- ELEMENTS ---
    const form = document.getElementById('orderForm');
    const elProduk = document.getElementById('produk');
    const elColorGrid = document.getElementById('colorGrid');
    const elWarnaInput = document.getElementById('warnaInput');
    const elWarnaLabel = document.getElementById('warnaLabel');
    const elJumlah = document.getElementById('jumlah');
    const elPaperbag = document.getElementById('paperbag');
    const elPromo = document.getElementById('promo');
    const elTotalFooter = document.getElementById('footerTotal');
    const elPromoBadge = document.getElementById('promoBadge');
    const modal = document.getElementById('confirmModal');
    
    // --- STATE ---
    let totalPrice = 0;
    let discountActive = false;
    const PROMO_CODE = "FEMMEIA10";

    // --- EVENT LISTENERS ---
    
    // 1. Load Data from LocalStorage on Startup
    window.addEventListener('DOMContentLoaded', () => {
      loadFormData();
      lucide.createIcons(); // Re-init icons
    });

    // 2. Auto Save on Input
    form.addEventListener('input', (e) => {
      // Remove error styling if user starts typing/selecting
      if(e.target.classList.contains('input-error')) {
        e.target.classList.remove('input-error');
      }
      calculateTotal();
      saveFormData();
    });

    // 3. Product Change -> Update Colors
    elProduk.addEventListener('change', () => {
      renderColors();
      calculateTotal();
      saveFormData();
      elProduk.classList.remove('input-error'); // Remove error style
    });

    // --- FUNCTIONS ---

    // Toast Logic
    function showToast(message, type = 'error') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const icon = type === 'error' ? 'alert-circle' : 'check-circle';
      toast.innerHTML = `<i data-lucide="${icon}"></i> <span>${message}</span>`;
      
      container.appendChild(toast);
      lucide.createIcons();

      // Trigger animation
      requestAnimationFrame(() => {
        toast.classList.add('show');
      });

      // Remove after 3s
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Quantity Stepper Logic
    function updateQty(change) {
      let val = parseInt(elJumlah.value) || 1;
      val += change;
      if (val < 1) val = 1;
      if (val > 50) val = 50;
      elJumlah.value = val;
      calculateTotal();
      saveFormData();
    }

    // Render Colors based on Product
    function renderColors() {
      const selectedProduct = elProduk.value;
      elColorGrid.innerHTML = '';
      elWarnaInput.value = '';
      elWarnaLabel.innerText = 'Belum dipilih';
      document.getElementById('msgSelectProduct').style.display = selectedProduct ? 'none' : 'block';

      if (!selectedProduct) return;

      const colors = PRODUCT_DATA[selectedProduct] || [];
      
      colors.forEach(color => {
        const hex = COLOR_HEX[color] || '#e5e7eb';
        const div = document.createElement('div');
        div.className = 'color-option';
        div.style.backgroundColor = hex;
        div.title = color;
        div.onclick = () => selectColor(div, color);
        elColorGrid.appendChild(div);
      });
    }

    // Handle Color Selection
    function selectColor(element, colorName) {
      // Remove active class from all
      document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
      // Add to clicked
      element.classList.add('selected');
      // Update Inputs
      elWarnaInput.value = colorName;
      elWarnaLabel.innerHTML = `<span class="selected-color-label">${colorName}</span>`;
      saveFormData();
    }

    // Calculate Total Price
    function calculateTotal() {
      const productVal = elProduk.value;
      const qty = parseInt(elJumlah.value) || 1;
      const paperbag = elPaperbag.value === 'Ya';
      const promoInput = elPromo.value.trim().toUpperCase();

      let price = 0;
      if (productVal) {
        // Extract price from value string "Name - 35000"
        price = parseInt(productVal.split('-')[1].trim());
      }

      let subtotal = price * qty;
      if (paperbag) subtotal += 5000;

      // Promo Logic
      const promoStatus = document.getElementById('promoStatus');
      if (promoInput === PROMO_CODE) {
        discountActive = true;
        subtotal = subtotal * 0.9; // 10% off
        promoStatus.innerHTML = '<span style="color:var(--success)">✔ Kode promo aktif!</span>';
        elPromoBadge.style.display = 'inline';
      } else if (promoInput.length > 3) {
        discountActive = false;
        promoStatus.innerHTML = '<span style="color:var(--error)">✖ Kode tidak valid</span>';
        elPromoBadge.style.display = 'none';
      } else {
        discountActive = false;
        promoStatus.innerText = '';
        elPromoBadge.style.display = 'none';
      }

      totalPrice = Math.floor(subtotal);
      elTotalFooter.innerText = 'Rp' + totalPrice.toLocaleString('id-ID');
    }

    // Validation & Modal Trigger
    function validateAndOrder() {
      let firstErrorEl = null;
      let errorMessage = "";

      // 1. Reset Styles
      document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));

      // 2. Helper to check fields
      const checkField = (id) => {
        const el = document.getElementById(id);
        if (!el.value.trim()) {
          el.classList.add('input-error');
          if (!firstErrorEl) {
            firstErrorEl = el;
            errorMessage = `${el.getAttribute('data-label')} belum diisi`;
          }
          return false;
        }
        return true;
      };

      // 3. Run Checks Sequence
      checkField('nama');
      if(firstErrorEl) return handleError(firstErrorEl, errorMessage);

      checkField('wa');
      if(firstErrorEl) return handleError(firstErrorEl, errorMessage);

      checkField('alamat');
      if(firstErrorEl) return handleError(firstErrorEl, errorMessage);

      checkField('produk');
      if(firstErrorEl) return handleError(firstErrorEl, errorMessage);

      // Special Check for Color
      if (!elWarnaInput.value) {
        firstErrorEl = document.getElementById('colorGroup'); // Scroll to group container
        errorMessage = "Warna produk belum dipilih";
        return handleError(firstErrorEl, errorMessage);
      }

      checkField('pengiriman');
      if(firstErrorEl) return handleError(firstErrorEl, errorMessage);

      checkField('pembayaran');
      if(firstErrorEl) return handleError(firstErrorEl, errorMessage);

      // If All Valid
      showSummaryModal();
    }

    function handleError(element, message) {
      showToast(message);
      // Scroll to element with offset for Sticky Header
      const yOffset = -100; // offset for top bar
      const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
      window.scrollTo({top: y, behavior: 'smooth'});
      
      // Focus if it's an input
      if(element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
        setTimeout(() => element.focus(), 500); // Delay focus for scroll animation
      }
    }


    // Show Confirmation Modal
    function showSummaryModal() {
      const productName = elProduk.value.split('-')[0].trim();
      const color = elWarnaInput.value;
      
      const html = `
        <div class="summary-item"><strong>Nama:</strong> <span>${document.getElementById('nama').value}</span></div>
        <div class="summary-item"><strong>Alamat:</strong> <span style="text-align:right; max-width:60%;">${document.getElementById('alamat').value}</span></div>
        <div class="summary-item"><strong>Produk:</strong> <span>${productName}</span></div>
        <div class="summary-item"><strong>Warna:</strong> <span>${color}</span></div>
        <div class="summary-item"><strong>Jumlah:</strong> <span>${elJumlah.value} pcs</span></div>
        <div class="summary-item"><strong>Pengiriman:</strong> <span>${document.getElementById('pengiriman').value}</span></div>
        <div class="summary-item"><strong>Pembayaran:</strong> <span>${document.getElementById('pembayaran').value}</span></div>
        <div class="summary-total">
          <span>Total Bayar</span>
          <span>Rp${totalPrice.toLocaleString('id-ID')}</span>
        </div>
      `;
      
      document.getElementById('summaryContent').innerHTML = html;
      modal.style.display = 'flex';

      // Setup WhatsApp Button
      document.getElementById('btnSendWa').onclick = () => {
        const text = `Halo Admin FemmeiaCloth, saya ingin pesan:\n\n` +
          `• Nama: ${document.getElementById('nama').value}\n` +
          `• Produk: ${productName} (${color})\n` +
          `• Qty: ${elJumlah.value}\n` +
          `• Total: Rp${totalPrice.toLocaleString('id-ID')}\n` +
          `• Pengiriman: ${document.getElementById('pengiriman').value}\n` +
          `• Pembayaran: ${document.getElementById('pembayaran').value}\n` +
          `• Alamat: ${document.getElementById('alamat').value}\n` +
          `• Catatan: ${document.getElementById('catatan').value || '-'}`;
        
        // Clear Storage after order
        localStorage.removeItem('femmeia_order_data');
        window.open(`https://wa.me/6287777420644?text=${encodeURIComponent(text)}`, '_blank');
      };
    }

    function closeModal() {
      modal.style.display = 'none';
    }

    // --- LOCAL STORAGE LOGIC ---
    function saveFormData() {
      const data = {
        nama: document.getElementById('nama').value,
        wa: document.getElementById('wa').value,
        alamat: document.getElementById('alamat').value,
        produk: elProduk.value,
        warna: elWarnaInput.value,
        jumlah: elJumlah.value,
        paperbag: elPaperbag.value,
        pengiriman: document.getElementById('pengiriman').value,
        pembayaran: document.getElementById('pembayaran').value,
        catatan: document.getElementById('catatan').value
      };
      localStorage.setItem('femmeia_order_data', JSON.stringify(data));
    }

    function loadFormData() {
      const saved = localStorage.getItem('femmeia_order_data');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          document.getElementById('nama').value = data.nama || '';
          document.getElementById('wa').value = data.wa || '';
          document.getElementById('alamat').value = data.alamat || '';
          elJumlah.value = data.jumlah || 1;
          elPaperbag.value = data.paperbag || 'Tidak';
          document.getElementById('pengiriman').value = data.pengiriman || '';
          document.getElementById('pembayaran').value = data.pembayaran || '';
          document.getElementById('catatan').value = data.catatan || '';

          if (data.produk) {
            elProduk.value = data.produk;
            renderColors(); // Re-render circles
            
            // Restore color selection visually
            if (data.warna) {
              const colorOptions = document.querySelectorAll('.color-option');
              for (let div of colorOptions) {
                if (div.title === data.warna) {
                  selectColor(div, data.warna);
                  break;
                }
              }
            }
          }
          calculateTotal();
        } catch (e) {
          console.error("Error loading data", e);
        }
      }
    }

    function resetForm() {
      if(confirm('Hapus semua data di formulir?')) {
        form.reset();
        localStorage.removeItem('femmeia_order_data');
        elProduk.dispatchEvent(new Event('change')); // Reset colors
        calculateTotal();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

  </script>
</body>
</html>