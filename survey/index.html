<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Survey Berhadiah - Femmeia Cloth - Batch 1</title>
  <meta name="description" content="Isi survey dan dapatkan hadiah!.">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/gunadizz/FemmeiaCloth/refs/heads/main/IMG_3593.jpeg">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-card: rgba(255, 255, 255, 0.05);
      --bg-card-hover: rgba(255, 255, 255, 0.08);
      --border: rgba(255, 255, 255, 0.1);
      --border-focus: rgba(255, 255, 255, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent: #ec4899;
      --accent-secondary: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --glass-bg: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Background Effects */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1rem;
      position: relative;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .header h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .header .subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
      margin-bottom: 2rem;
    }

    /* Bento Grid Layout */
    .bento-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .bento-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      padding: 2rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .bento-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-focus), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .bento-card:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-focus);
      transform: translateY(-2px);
    }

    .bento-card:hover::before {
      opacity: 1;
    }

    /* Alert Cards */
    .alert-card {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .alert-card .icon {
      display: inline-block;
      margin-right: 0.5rem;
      font-size: 1.2rem;
    }

    /* Progress Card */
    .progress-card {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, var(--glass-bg), rgba(16, 185, 129, 0.05));
    }

    .progress-bar-container {
      background: rgba(255, 255, 255, 0.1);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
      border-radius: 4px;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .step-indicator {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .step-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .step-dot.active {
      background: var(--accent);
      transform: scale(1.2);
    }

    .step-dot.completed {
      background: var(--success);
    }

    /* Form Styles */
    .form-step {
      display: none;
      grid-column: 1 / -1;
      min-height: 400px;
    }

    .form-step.active {
      display: block;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.9rem;
    }

    .required {
      color: var(--accent);
    }

    input, select, textarea {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      padding: 0.875rem 1rem;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }

    input::placeholder, textarea::placeholder {
      color: var(--text-muted);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Checkbox Styles */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .checkbox-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: var(--border-focus);
    }

    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      accent-color: var(--accent);
    }

    .checkbox-item label {
      margin: 0;
      cursor: pointer;
      line-height: 1.5;
    }

    /* Button Styles */
    .button-group {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 2rem;
    }

    button {
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;font-family:"Quicksand";
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.15);
      border-color: var(--border-focus);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white; box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);
      border: 1px solid transparent;font-family:"Quicksand";
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 40px rgba(236, 72, 153, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /* Error Styles */
    .error {
      color: var(--error);
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }

    .error-border {
      border-color: var(--error) !important;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .bento-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .bento-card {
        padding: 1.5rem;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .bento-card {
        padding: 1rem;
      }

      .header h1 {
        font-size: 1.8rem;
      }
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Quota Info */
    .quota-info {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--success);
      padding: 1rem;
      border-radius: 0.75rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .quota-info.empty {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
      border-color: rgba(239, 68, 68, 0.2);
      color: var(--error);
    }

    /* Hide form when quota is empty */
    .form-hidden {
      display: none !important;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-focus);
      border-radius: 1.5rem;
      padding: 2rem;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
      opacity: 1;
    }

    .modal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
    }

    .modal-spinner {
      margin: 0 auto 1.5rem;
      width: 60px;
      height: 60px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: modal-spin 1s ease-in-out infinite;
    }

    @keyframes modal-spin {
      to { transform: rotate(360deg); }
    }

    .modal-content {
      margin-bottom: 1rem;
    }

    .modal h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .modal-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      margin-bottom: 1rem;
    }

    .modal-status.success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .modal-status.error {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error);
    }

    .modal-btn {
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      color: white;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);
    }

    /* Pulse animation for loading text */
    .pulse {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Survey Berhadiah</h1>
      <p class="subtitle">Femmeia Cloth - Batch 1</p>
    </div>

    <div class="bento-grid">
      <!-- Alert Card -->
      <div class="bento-card alert-card">
        <span class="icon">üéÅ</span>
        <strong>Hadiah Rp1.000 ‚Äì Rp5.000</strong> berdasarkan kualitas jawaban Anda.<br>
        Hadiah hanya dapat dikirim melalui <strong>e-wallet (OVO, DANA, GoPay, dll)
</strong>.<br>
        <span class="icon">üßæ</span> <strong>Syarat:</strong> Wajib follow Instagram 
        <a href="https://instagram.com/femmeia.cloth" target="_blank" style="color: var(--accent);">@femmeia.cloth</a> 
        dan isi username IG Anda.
      </div>

      <!-- Privacy Notice -->
      <div class="bento-card alert-card">
        <strong>Perhatian:</strong><br>
        Data yang Anda berikan akan digunakan untuk pengembangan produk dan layanan FemmeiaCloth. 
        Kami menjamin kerahasiaan data Anda dan tidak akan disebarkan kepada pihak ketiga.<br><br>
        Mohon lengkapi data dengan jujur untuk mendapatkan hadiah menarik. 
        Kami akan merespon dalam 3x24 jam.
      </div>

      <!-- Quota Info -->
      <div id="quotaInfo" class="quota-info" style="display: none;"></div>

      <!-- Progress Card -->
      <div class="bento-card progress-card">
        <div class="progress-info">
          <span id="stepTitle">Data Diri</span>
          <span id="progressText">1 / 6</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar" style="width: 16.67%"></div>
        </div>
        <div class="step-indicator" id="stepIndicator">
          <div class="step-dot active"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
        </div>
      </div>

      <!-- Form Steps -->
      <form id="surveyForm" novalidate>
        <!-- Step 1: Data Diri -->
        <div class="form-step active bento-card">
          <div class="form-grid">
            <div class="form-group">
              <label for="name">Nama <span class="required">*</span></label>
              <input type="text" id="name" name="name" required />
              <div class="error" id="nameError"></div>
            </div>
            <div class="form-group">
              <label for="age">Umur <span class="required">*</span></label>
              <input type="number" id="age" name="age" min="1" required />
              <div class="error" id="ageError"></div>
            </div>
            <div class="form-group full-width">
              <label for="city">Kota <span class="required">*</span></label>
              <input type="text" id="city" name="city" required />
              <div class="error" id="cityError"></div>
            </div>
            <div class="form-group">
              <label for="whatsapp">No. WhatsApp <span class="required">*</span></label>
              <input type="text" id="whatsapp" name="whatsapp" required />
              <div class="error" id="whatsappError"></div>
            </div>
            <div class="form-group">
              <label for="ewallet">No. E-Wallet <span class="required">*</span></label>
              <input type="text" id="ewallet" name="ewallet" required />
              <div class="error" id="ewalletError"></div>
            </div>
            <div class="form-group full-width">
              <label for="email">Email <span class="required">*</span></label>
              <input type="email" id="email" name="email" required />
              <div class="error" id="emailError"></div>
            </div>
            <div class="form-group full-width">
              <label for="instagram">Username Instagram <span class="required">*</span></label>
              <input type="text" id="instagram" name="instagram" placeholder="@username" required />
              <div class="error" id="instagramError"></div>
            </div>
          </div>
        </div>

        <!-- Step 2: Preferensi Produk -->
        <div class="form-step bento-card">
          <div class="form-grid">
            <div class="form-group">
              <label for="productType">Jenis hijab favorit <span class="required">*</span></label>
              <select id="productType" name="productType" required>
                <option value="">-- Pilih --</option>
                <option value="Paris">Paris</option>
                <option value="Pashmina">Pashmina</option>
                <option value="Inner">Inner</option>
                <option value="Lainnya">Lainnya</option>
              </select>
              <div class="error" id="productTypeError"></div>
            </div>
            <div class="form-group">
              <label for="favoriteColor">Warna yang paling disukai <span class="required">*</span></label>
              <input type="text" id="favoriteColor" name="favoriteColor" placeholder="Contoh: Hitam, Putih, Navy" required />
              <div class="error" id="favoriteColorError"></div>
            </div>
            <div class="form-group full-width">
              <label for="priceRange">Kisaran harga nyaman <span class="required">*</span></label>
              <select id="priceRange" name="priceRange" required>
                <option value="">-- Pilih --</option>
                <option value="<30k">&lt; Rp30.000</option>
                <option value="30-50k">Rp30.000 ‚Äì Rp50.000</option>
                <option value=">50k">&gt; Rp50.000</option>
              </select>
              <div class="error" id="priceRangeError"></div>
            </div>
          </div>
        </div>

        <!-- Step 3: Kepuasan Pelanggan -->
        <div class="form-step bento-card">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="hasPurchased">Pernah membeli di Femmeia? <span class="required">*</span></label>
              <select id="hasPurchased" name="hasPurchased" required>
                <option value="">-- Pilih --</option>
                <option value="Tidak">Tidak</option>
                <option value="Ya">Ya</option>
              </select>
              <div class="error" id="hasPurchasedError"></div>
            </div>
            <div class="form-group" id="ratingGroup" style="display: none;">
              <label for="rating">Rating pengalaman (1‚Äì5)</label>
              <select id="rating" name="rating">
                <option value="">-- Pilih Rating --</option>
                <option value="1">1 - Sangat Tidak Puas</option>
                <option value="2">2 - Tidak Puas</option>
                <option value="3">3 - Cukup</option>
                <option value="4">4 - Puas</option>
                <option value="5">5 - Sangat Puas</option>
              </select>
            </div>
            <div class="form-group full-width" id="feedbackGroup" style="display: none;">
              <label for="feedback">Komentar tentang layanan kami</label>
              <textarea id="feedback" name="feedback" placeholder="Ceritakan pengalaman Anda berbelanja di Femmeia..."></textarea>
            </div>
          </div>
        </div>

        <!-- Step 4: Ide Produk Baru -->
        <div class="form-step bento-card">
          <div class="form-grid">
            <div class="form-group full-width">
              <label>Produk baru apa yang kamu inginkan?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="idea1" value="Hijab Motif" class="productIdea" />
                  <label for="idea1">Hijab Motif</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="idea2" value="Inner Instan" class="productIdea" />
                  <label for="idea2">Inner Instan</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="idea3" value="Aksesoris Hijab" class="productIdea" />
                  <label for="idea3">Aksesoris Hijab</label>
                </div>
              </div>
            </div>
            <div class="form-group full-width">
              <label for="otherIdea">Ide lain (jika ada)</label>
              <input type="text" id="otherIdea" name="otherIdea" placeholder="Tuliskan ide produk lainnya..." />
            </div>
          </div>
        </div>

        <!-- Step 5: Testimoni / Komentar -->
        <div class="form-step bento-card">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="suggestion">Testimoni atau saran untuk kami <span class="required">*</span></label>
              <textarea id="suggestion" name="suggestion" placeholder="Bagikan testimoni, saran, atau masukan Anda untuk Femmeia Cloth..." required></textarea>
              <div class="error" id="suggestionError"></div>
            </div>
          </div>
        </div>

        <!-- Step 6: Persetujuan & Kirim -->
        <div class="form-step bento-card">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="jenisewallet">Konfirmasi Jenis E-Wallet <span class="required">*</span></label>
              <input type="text" id="jenisewallet" name="jenisewallet" placeholder="Contoh: GoPay, DANA, OVO, dll" required />
              <div class="error" id="jenisewalletError"></div>
            </div>
            <div class="form-group full-width">
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="agreeFollow" required />
                  <label for="agreeFollow">Saya sudah follow Instagram 
                    <a href="https://instagram.com/femmeia.cloth" target="_blank" style="color: var(--accent);">@femmeia.cloth</a>
                  </label>
                </div>
                <div class="error" id="agreeFollowError"></div>
                <div class="checkbox-item">
                  <input type="checkbox" id="agree1" required />
                  <label for="agree1">Saya bersedia datanya digunakan untuk pengembangan Femmeia Cloth</label>
                </div>
                <div class="error" id="agree1Error"></div>
                <div class="checkbox-item">
                  <input type="checkbox" id="agree2" required />
                  <label for="agree2">Saya setuju mengikuti undian berhadiah</label>
                </div>
                <div class="error" id="agree2Error"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="button-group">
          <button type="button" id="prevBtn" class="btn-secondary" disabled>
            ‚Üê Sebelumnya
          </button>
          <button type="button" id="nextBtn" class="btn-primary">
            Selanjutnya ‚Üí
          </button>
          <button type="submit" id="submitBtn" class="btn-primary" style="display: none;">
            <span id="submitText">Kirim Survey</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div id="modalContent">
        <!-- Content will be dynamically inserted here -->
      </div>
    </div>
  </div>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getFirestore, doc, getDoc, runTransaction, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
    
    // EmailJS
    emailjs.init('EgQN926d2p5Tl7keS');

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAxMT-bM6FEPrD-o3I2G-VHdZP7hxhj0uo",
      authDomain: "femmeiacloth-finance.firebaseapp.com",
      projectId: "femmeiacloth-finance",
      storageBucket: "femmeiacloth-finance.appspot.com",
      messagingSenderId: "517478386163",
      appId: "1:517478386163:web:51028f5841baa311126a86",
      measurementId: "G-K4L516Q54R"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM Elements
    const steps = document.querySelectorAll('.form-step');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submitBtn');
    const progressBar = document.getElementById('progressBar');
    const stepIndicator = document.getElementById('stepIndicator');
    const stepTitle = document.getElementById('stepTitle');
    const progressText = document.getElementById('progressText');
    const quotaInfo = document.getElementById('quotaInfo');
    const surveyForm = document.getElementById('surveyForm');
    const hasPurchased = document.getElementById('hasPurchased');
    const ratingGroup = document.getElementById('ratingGroup');
    const feedbackGroup = document.getElementById('feedbackGroup');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('modalContent');

    let currentStep = 0;
    const totalSteps = steps.length;
    let quotaCount = null;

    const stepTitles = [
      'Data Diri',
      'Preferensi Produk', 
      'Kepuasan Pelanggan',
      'Ide Produk Baru',
      'Testimoni & Saran',
      'Konfirmasi & Kirim'
    ];

    // Modal functions
    function showModal(type, title, message) {
      let content = '';
      
      if (type === 'loading') {
        content = `
          <div class="modal-spinner"></div>
          <h3>${title}</h3>
          <p class="pulse">${message}</p>
        `;
      } else if (type === 'success') {
        content = `
          <div class="modal-status success">‚úÖ Berhasil</div>
          <h3>${title}</h3>
          <p>${message}</p>
          <button class="modal-btn" onclick="document.getElementById('modalOverlay').classList.remove('active')">
            Tutup
          </button>
        `;
      } else if (type === 'error') {
        content = `
          <div class="modal-status error">‚ùå Gagal</div>
          <h3>${title}</h3>
          <p>${message}</p>
          <button class="modal-btn" onclick="document.getElementById('modalOverlay').classList.remove('active')">
            Tutup
          </button>
        `;
      }
      
      modalContent.innerHTML = content;
      modalOverlay.classList.add('active');
    }

    function hideModal() {
      modalOverlay.classList.remove('active');
    }

    // Show/hide rating and feedback based on purchase history
    hasPurchased.addEventListener('change', function() {
      if (this.value === 'Ya') {
        ratingGroup.style.display = 'block';
        feedbackGroup.style.display = 'block';
      } else {
        ratingGroup.style.display = 'none';
        feedbackGroup.style.display = 'none';
        document.getElementById('rating').value = '';
        document.getElementById('feedback').value = '';
      }
    });

    function updateProgress() {
      const progress = ((currentStep + 1) / totalSteps) * 100;
      progressBar.style.width = progress + '%';
      stepTitle.textContent = stepTitles[currentStep];
      progressText.textContent = `${currentStep + 1} / ${totalSteps}`;

      // Update step indicators
      const dots = stepIndicator.querySelectorAll('.step-dot');
      dots.forEach((dot, index) => {
        dot.classList.remove('active', 'completed');
        if (index < currentStep) {
          dot.classList.add('completed');
        } else if (index === currentStep) {
          dot.classList.add('active');
        }
      });
    }

    function showStep(n) {
      steps.forEach((step, i) => {
        step.classList.toggle('active', i === n);
      });

      prevBtn.disabled = n === 0;
      
      if (n === totalSteps - 1) {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'inline-block';
      } else {
        nextBtn.style.display = 'inline-block';
        submitBtn.style.display = 'none';
      }

      updateProgress();
    }

    function clearErrors() {
      document.querySelectorAll('.error').forEach(error => error.textContent = '');
      document.querySelectorAll('input, select, textarea').forEach(input => {
        input.classList.remove('error-border');
      });
    }

    function showError(fieldId, message) {
      const errorElement = document.getElementById(fieldId + 'Error');
      const inputElement = document.getElementById(fieldId);
      if (errorElement) errorElement.textContent = message;
      if (inputElement) inputElement.classList.add('error-border');
    }

    function validateStep(n) {
      clearErrors();
      let isValid = true;

      switch (n) {
        case 0:
          const requiredFields = ['name', 'age', 'city', 'whatsapp', 'ewallet', 'email', 'instagram'];
          requiredFields.forEach(field => {
            const input = document.getElementById(field);
            if (!input.value.trim()) {
              showError(field, 'Field ini wajib diisi');
              isValid = false;
            }
          });
          break;

        case 1:
          if (!document.getElementById('productType').value) {
            showError('productType', 'Jenis hijab favorit wajib dipilih');
            isValid = false;
          }
          if (!document.getElementById('favoriteColor').value.trim()) {
            showError('favoriteColor', 'Warna favorit wajib diisi');
            isValid = false;
          }
          if (!document.getElementById('priceRange').value) {
            showError('priceRange', 'Kisaran harga wajib dipilih');
            isValid = false;
          }
          break;

        case 2:
          if (!document.getElementById('hasPurchased').value) {
            showError('hasPurchased', 'Pilihan wajib dipilih');
            isValid = false;
          }
          break;

        case 4:
          if (!document.getElementById('suggestion').value.trim()) {
            showError('suggestion', 'Testimoni atau saran wajib diisi');
            isValid = false;
          }
          break;

        case 5:
          if (!document.getElementById('jenisewallet').value.trim()) {
            showError('jenisewallet', 'Jenis E-Wallet wajib diisi');
            isValid = false;
          }
          if (!document.getElementById('agreeFollow').checked) {
            showError('agreeFollow', 'Wajib follow Instagram @femmeia.cloth');
            isValid = false;
          }
          if (!document.getElementById('agree1').checked) {
            showError('agree1', 'Persetujuan penggunaan data wajib dicentang');
            isValid = false;
          }
          if (!document.getElementById('agree2').checked) {
            showError('agree2', 'Persetujuan undian berhadiah wajib dicentang');
            isValid = false;
          }
          break;
      }

      return isValid;
    }

    nextBtn.addEventListener('click', () => {
      if (validateStep(currentStep)) {
        if (currentStep < totalSteps - 1) {
          currentStep++;
          showStep(currentStep);
        }
      }
    });

    prevBtn.addEventListener('click', () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    });

    // Close modal when clicking outside
    modalOverlay.addEventListener('click', function(e) {
      if (e.target === modalOverlay) {
        // Only close if it's not a loading modal
        if (!modalContent.querySelector('.modal-spinner')) {
          hideModal();
        }
      }
    });

    // Check quota
    const quotaDocRef = doc(db, "survey_control", "quota");

    async function checkQuotaAndToggleForm() {
      try {
        const docSnap = await getDoc(quotaDocRef);
        if (docSnap.exists()) {
          quotaCount = docSnap.data().count;
          if (quotaCount <= 0) {
            quotaInfo.innerHTML = "üö´ Stok survey sudah habis. Terima kasih atas antusiasmenya!";
            quotaInfo.className = "quota-info empty";
            quotaInfo.style.display = "block";
            surveyForm.classList.add('form-hidden');
          } else {
            quotaInfo.innerHTML = `‚úÖ Sisa kuota survey: <strong>${quotaCount}</strong>`;
            quotaInfo.className = "quota-info";
            quotaInfo.style.display = "block";
            surveyForm.classList.remove('form-hidden');
          }
        } else {
          quotaInfo.innerHTML = "‚ö†Ô∏è Quota belum diinisialisasi di Firestore!";
          quotaInfo.className = "quota-info empty";
          quotaInfo.style.display = "block";
          surveyForm.classList.add('form-hidden');
        }
      } catch (err) {
        quotaInfo.innerHTML = "‚ùå Gagal memuat quota survey.";
        quotaInfo.className = "quota-info empty";
        quotaInfo.style.display = "block";
        surveyForm.classList.add('form-hidden');
      }
    }

    checkQuotaAndToggleForm();

    // Form submission
    surveyForm.addEventListener('submit', async function(event) {
      event.preventDefault();

      if (!validateStep(currentStep)) {
        return;
      }

      // Show loading modal
      showModal('loading', 'Mengirim Survey', 'Mohon tunggu sebentar, survey Anda sedang diproses...');

      // Collect form data
      const ideas = Array.from(document.querySelectorAll('.productIdea:checked')).map(cb => cb.value).join(', ');
      const surveyData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        age: document.getElementById('age').value,
        city: document.getElementById('city').value,
        whatsapp: document.getElementById('whatsapp').value,
        ewallet: document.getElementById('ewallet').value,
        jenisewallet: document.getElementById('jenisewallet').value,
        instagram: document.getElementById('instagram').value,
        productType: document.getElementById('productType').value,
        favoriteColor: document.getElementById('favoriteColor').value,
        priceRange: document.getElementById('priceRange').value,
        hasPurchased: document.getElementById('hasPurchased').value,
        rating: document.getElementById('rating').value,
        feedback: document.getElementById('feedback').value,
        productIdeas: ideas,
        otherIdea: document.getElementById('otherIdea').value,
        suggestion: document.getElementById('suggestion').value,
        timestamp: new Date()
      };

      try {
        await runTransaction(db, async (transaction) => {
          const quotaDoc = await transaction.get(quotaDocRef);
          if (!quotaDoc.exists()) throw "Quota tidak ditemukan!";
          let count = quotaDoc.data().count;
          if (count <= 0) throw "Stok survey sudah habis!";
          
          // Save survey
          const surveysCol = collection(db, "surveys");
          await addDoc(surveysCol, surveyData);
          
          // Update quota
          transaction.update(quotaDocRef, { count: count - 1 });
        });

        // Send email
        emailjs.send('service_00xj2ta', 'template_4i1ue1g', surveyData)
          .then(() => {
            // Show success modal
            showModal(
              'success', 
              'Survey Berhasil Dikirim', 
              'Terima kasih atas partisipasi Anda! Hadiah akan dikirimkan dalam 3x24 jam ke e-wallet yang telah Anda cantumkan.'
            );
            surveyForm.reset();
            currentStep = 0;
            showStep(currentStep);
            checkQuotaAndToggleForm();
          }, (error) => {
            // Show partial success modal
            showModal(
              'success', 
              'Survey Berhasil Disimpan', 
              'Survey Anda telah berhasil disimpan, namun pengiriman email notifikasi gagal. Kami tetap akan memproses hadiah Anda.'
            );
            console.error(error);
            checkQuotaAndToggleForm();
          });

      } catch (e) {
        // Show error modal
        if (e === "Stok survey sudah habis!") {
          showModal(
            'error', 
            'Kuota Survey Habis', 
            'Mohon maaf, kuota survey sudah habis. Terima kasih atas antusiasme Anda!'
          );
        } else {
          showModal(
            'error', 
            'Gagal Mengirim Survey', 
            'Terjadi kesalahan saat mengirim survey. Silakan coba lagi dalam beberapa saat.'
          );
        }
        console.error(e);
        checkQuotaAndToggleForm();
      }
    });

    // Initialize
    showStep(currentStep);
  </script>
</body>
</html>